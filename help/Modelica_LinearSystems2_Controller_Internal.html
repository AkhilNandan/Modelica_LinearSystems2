<HTML>
<HEAD>
<TITLE>Modelica_LinearSystems2.Controller.Internal</TITLE>
<META name="HTML-Generator" content="Dymola">
<META name="description" content="&quot;Internal blocks that are usually of no interest for the user&quot;">
<style type="text/css">
*       { font-size: 10pt; font-family: Arial,sans-serif; }
pre     { font-size:  9pt; font-family: Courier,monospace;}
h4      { font-size: 10pt; font-weight: bold; color: green; }
h3      { font-size: 11pt; font-weight: bold; color: green; }
h2      { font-size: 13pt; font-weight: bold; color: green; }
address {                  font-weight: normal} 
td      { solid #000; vertical-align:top; }
th      { solid #000; vertical-align:top; font-weight: bold; }
table   { solid #000; border-collapse: collapse;}
</style>
</HEAD>
<BODY><P>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Internal<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.Controller.Internal"></A><A HREF="Modelica_LinearSystems2_Controller.html#Modelica_LinearSystems2.Controller"
>Modelica_LinearSystems2.Controller</A>.Internal</H2>
<B>Internal blocks that are usually of no interest for the user</B>
<P>
<P><H3>Information</H3></P>
Extends from <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Icons_Library.html#Modelica.Icons.Library"
>Modelica.Icons.Library</A> (Icon for library).
<P><H3>Package Content</H3><p>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2 >
<TR><TH >Name</TH><TH>Description</TH></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Controller.Internal.AddS.png" ALT="Modelica_LinearSystems2.Controller.Internal.Add" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal.Add"
>Add</A>
</TD><TD>&nbsp;</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Controller.Internal.Add2S.png" ALT="Modelica_LinearSystems2.Controller.Internal.Add2" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal.Add2"
>Add2</A>
</TD><TD>&nbsp;</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Controller.Internal.bessel0S.png" ALT="Modelica_LinearSystems2.Controller.Internal.bessel0" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal.bessel0"
>bessel0</A>
</TD><TD>Polynomial approximation of the zeroth order modified Bessel function</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteADconverterS.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteADconverter" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal.DiscreteADconverter"
>DiscreteADconverter</A>
</TD><TD>AD converter as discrete block</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteDAconverterS.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteDAconverter" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal.DiscreteDAconverter"
>DiscreteDAconverter</A>
</TD><TD>Digital to analog converter as discrete block (including zero order hold)</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteFIRS.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteFIR" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal.DiscreteFIR"
>DiscreteFIR</A>
</TD><TD>Realization of FIR filter</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteNoiseS.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteNoise" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal.DiscreteNoise"
>DiscreteNoise</A>
</TD><TD>Uniform distributed noise for discrete blocks</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteSamplerS.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteSampler" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal.DiscreteSampler"
>DiscreteSampler</A>
</TD><TD>Sample the input signal</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteStateSpaceS.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteStateSpace" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal.DiscreteStateSpace"
>DiscreteStateSpace</A>
</TD><TD>Discrete linear time invariant state space system block parameterized with a continuous state space system</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteStateSpaceS.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteStateSpace2" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal.DiscreteStateSpace2"
>DiscreteStateSpace2</A>
</TD><TD>Discrete linear time invariant state space system block parameterized with a continuous state space system</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteUnitDelayS.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteUnitDelay" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal.DiscreteUnitDelay"
>DiscreteUnitDelay</A>
</TD><TD>Delay the input signal by one sample instant</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteInterpolatorS.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteInterpolator" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal.DiscreteInterpolator"
>DiscreteInterpolator</A>
</TD><TD>Increasing the sampling frequency with linear interpolation</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Controller.Internal.FIR_coefficientsS.png" ALT="Modelica_LinearSystems2.Controller.Internal.FIR_coefficients" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal.FIR_coefficients"
>FIR_coefficients</A>
</TD><TD>Calculates the FIR-filter coefficient vector</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Controller.Internal.FIR_coefficientsS.png" ALT="Modelica_LinearSystems2.Controller.Internal.FIR_window" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal.FIR_window"
>FIR_window</A>
</TD><TD>Calculation of n-point weighting window for FIR filter</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Controller.Internal.FIR_coefficientsS.png" ALT="Modelica_LinearSystems2.Controller.Internal.random" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal.random"
>random</A>
</TD><TD>Pseudo random number generator</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Controller.Internal.FIR_coefficientsS.png" ALT="Modelica_LinearSystems2.Controller.Internal.scaleFactor1" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal.scaleFactor1"
>scaleFactor1</A>
</TD><TD>Return scale factor for first order block</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Controller.Internal.FIR_coefficientsS.png" ALT="Modelica_LinearSystems2.Controller.Internal.scaleFactor2" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal.scaleFactor2"
>scaleFactor2</A>
</TD><TD>Return scale factor for second order block</TD></TR>
</TABLE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Add<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_LinearSystems2.Controller.Internal.AddI.png" ALT="Modelica_LinearSystems2.Controller.Internal.Add" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_LinearSystems2.Controller.Internal.Add"></A><A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal"
>Modelica_LinearSystems2.Controller.Internal</A>.Add</H2>
<IMG SRC="Modelica_LinearSystems2.Controller.Internal.AddD.png" ALT="Modelica_LinearSystems2.Controller.Internal.Add">
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>input <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>u1</TD><TD>&nbsp;</TD></TR>
<TR><TD>input <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>u2</TD><TD>&nbsp;</TD></TR>
<TR><TD>output <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>y</TD><TD>&nbsp;</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> Add

<textblock type="annotcomp" expanded="false">  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> u1;
  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> u2;
  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> y;</textblock>
<font color="blue">equation </font>
y = u1+u2;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>Add;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Add2<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_LinearSystems2.Controller.Internal.Add2I.png" ALT="Modelica_LinearSystems2.Controller.Internal.Add2" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_LinearSystems2.Controller.Internal.Add2"></A><A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal"
>Modelica_LinearSystems2.Controller.Internal</A>.Add2</H2>
<IMG SRC="Modelica_LinearSystems2.Controller.Internal.Add2D.png" ALT="Modelica_LinearSystems2.Controller.Internal.Add2">
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Boolean</TD><TD>fromLeft</TD><TD>true</TD><TD>true if second input is left (else below)</TD></TR>
<TR><TD>Integer</TD><TD>n</TD><TD>1</TD><TD>number of inputs = number of outputs</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>input <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>u1[n]</TD><TD>&nbsp;</TD></TR>
<TR><TD>input <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>u2[n]</TD><TD>&nbsp;</TD></TR>
<TR><TD>output <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>y[n]</TD><TD>&nbsp;</TD></TR>
<TR><TD>input <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>u2b[n]</TD><TD>&nbsp;</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> Add2

  <font color="blue">parameter </font>Boolean fromLeft = true <font color="darkgreen">&quot;true if second input is left (else below)&quot;</font>;
  <font color="blue">parameter </font>Integer n(min=1)=1 <font color="darkgreen">&quot;number of inputs = number of outputs&quot;</font>;

<textblock type="annotcomp" expanded="false">  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> u1[n];
  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> u2[n] <font color="blue">if </font>fromLeft;
  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> y[n];
  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> u2b[n] <font color="blue">if </font><font color="blue">not </font>fromLeft;
  <A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal.Add"
>Add</A> add[n];</textblock>
<font color="blue">equation </font>
<font color="darkgreen">//y = if fromLeft then u1+u2 else u1+u2b;</font>

<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(add.u2, u2b);
  <font color="red">connect</font>(add.u2, u2);
  <font color="red">connect</font>(add.u1, u1);
  <font color="red">connect</font>(add.y, y);</textblock>
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>Add2;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE bessel0<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.Controller.Internal.bessel0"></A><A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal"
>Modelica_LinearSystems2.Controller.Internal</A>.bessel0</H2>
<B>Polynomial approximation of the zeroth order modified Bessel function</B><p>
<P><H3>Information</H3></P>
<PRE></pre>
<p>
Polynomial approximation of the zeroth order modified Bessel function. 
The algorithm is taken from
</p>
<dl>
<dt>H. W. Press, S.A. Teukolsky, W. Vetterling:
<dd><b>Numerical Reciepes in C: The Art of Scientific Computing</b><br>
       Cambridge UP, 1988
</dl>
<p>
The function is used to calculate the Kaiser-window via
<i>calcWindow</i>.
</p>
<p><b>Release Notes:</b></p>
<ul>
<li><i>July 10, 2002</i>
       by Nico Walther<br>
       Realized.</li>
</ul>
<pre>
</PRE><P>

<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>x</TD><TD>&nbsp;</TD><TD>&nbsp;</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>y</TD><TD>&nbsp;</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">function</font> bessel0 <font color="darkgreen">
  &quot;Polynomial approximation of the zeroth order modified Bessel function&quot;</font>

  <font color="blue">input </font>Real x;
  <font color="blue">output </font>Real y;
<font color="blue">protected </font>
  Real ax;
  Real a;
<font color="blue">algorithm </font>

  ax :=<font color="red"> abs</font>(x);
  <font color="blue">if </font>ax &lt; 3.75<font color="blue"> then</font>
    a := (x/3.75)^2;
    y := 1 + a*(3.5156229 + a*(3.0899424 + a*(1.2067492 + a*(0.2659732 + a*
      (0.0360768 + a*0.0045813)))));
  <font color="blue">else</font>
    a := 3.75/ax;
    y :=<font color="red"> exp</font>(ax)/<font color="red">sqrt</font>(ax)*(0.39894228 + a*(0.01328592 + a*(0.00225319 + a*(
      -0.00157565 + a*(0.00916281 + a*(-0.02057706 + a*(0.02635537 + a*(-0.01647633
       + a*0.00392377))))))));
  <font color="blue">end if</font>;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>bessel0;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE DiscreteADconverter<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteADconverterI.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteADconverter" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_LinearSystems2.Controller.Internal.DiscreteADconverter"></A><A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal"
>Modelica_LinearSystems2.Controller.Internal</A>.DiscreteADconverter</H2>
<B>AD converter as discrete block</B><p>
<IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteADconverterD.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteADconverter">
<P><H3>Information</H3></P>
<PRE></pre>
<pre>
</PRE><P>
Extends from <A HREF="Modelica_LinearSystems2_Controller_Interfaces.html#Modelica_LinearSystems2.Controller.Interfaces.PartialDiscreteSISO_equality"
>Interfaces.PartialDiscreteSISO_equality</A> (Common discrete part of blocks extending from PartialSISO_equality).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>y_max</TD><TD>&nbsp;</TD><TD>Upper limit of output signal</TD></TR>
<TR><TD>Real</TD><TD>y_min</TD><TD>&nbsp;</TD><TD>Lower limit of output signal</TD></TR>
<TR><TD>Integer</TD><TD>bits</TD><TD>&nbsp;</TD><TD>Number of bits (=0 means no quantization error)</TD></TR>
<TR><TD>Integer</TD><TD>sampleFactor</TD><TD>1</TD><TD>Ts=sampleClock.sampleTime*sampleFactor</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>input <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>u</TD><TD>Continuous or discrete input signal of block</TD></TR>
<TR><TD>output <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>y</TD><TD>Continuous or discrete output signal of block</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">block</font> DiscreteADconverter <font color="darkgreen">&quot;AD converter as discrete block&quot;</font>
  <font color="blue">parameter </font>Real y_max <font color="darkgreen">&quot;Upper limit of output signal&quot;</font>;
  <font color="blue">parameter </font>Real y_min <font color="darkgreen">&quot;Lower limit of output signal&quot;</font>;
  <font color="blue">parameter </font>Integer bits(min=0) <font color="darkgreen">
    &quot;Number of bits (=0 means no quantization error)&quot;</font>;
  <font color="blue">extends </font><A HREF="Modelica_LinearSystems2_Controller_Interfaces.html#Modelica_LinearSystems2.Controller.Interfaces.PartialDiscreteSISO_equality"
>Interfaces.PartialDiscreteSISO_equality</A>;

<font color="blue">protected </font>
  <font color="blue">parameter </font>Real quantization=<font color="blue">if </font>bits &gt; 0<font color="blue"> then </font>((y_max - y_min)/2^bits)<font color="blue"> else </font>0;
  Real y_bound <font color="darkgreen">&quot;Bounded output&quot;</font>;
  <font color="blue">discrete </font>Real y_sampled <font color="darkgreen">&quot;Sampled output&quot;</font>;
<font color="blue">equation </font>
  <font color="blue">when </font>{<font color="red">initial</font>(), sampleTrigger}<font color="blue"> then</font>
     u_sampled = u;
     y_bound = <font color="blue">if </font>u &gt; y_max<font color="blue"> then </font>y_max<font color="blue"> else </font><font color="blue">if </font>u &lt; y_min<font color="blue"> then </font>y_min<font color="blue"> else </font>u;
     y_sampled = <font color="blue">if </font>bits &gt; 0<font color="blue"> then </font>quantization*<font color="red">floor</font>(<font color="red">abs</font>(y_bound/quantization) + 0.5)*(
                <font color="blue">if </font>y_bound &gt;= 0<font color="blue"> then </font>+1<font color="blue"> else </font>-1)<font color="blue"> else </font>y_bound;
  <font color="blue">end when</font>;
  y = y_sampled;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>DiscreteADconverter;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE DiscreteDAconverter<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteDAconverterI.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteDAconverter" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_LinearSystems2.Controller.Internal.DiscreteDAconverter"></A><A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal"
>Modelica_LinearSystems2.Controller.Internal</A>.DiscreteDAconverter</H2>
<B>Digital to analog converter as discrete block (including zero order hold)</B><p>
<IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteDAconverterD.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteDAconverter">
<P><H3>Information</H3></P>
<PRE></pre>
<pre>
</PRE><P>
Extends from <A HREF="Modelica_LinearSystems2_Controller_Interfaces.html#Modelica_LinearSystems2.Controller.Interfaces.PartialDiscreteSISO_equality"
>Interfaces.PartialDiscreteSISO_equality</A> (Common discrete part of blocks extending from PartialSISO_equality).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>y_max</TD><TD>&nbsp;</TD><TD>Upper limit of output signal</TD></TR>
<TR><TD>Real</TD><TD>y_min</TD><TD>&nbsp;</TD><TD>Lower limit of output signal</TD></TR>
<TR><TD>Integer</TD><TD>bits</TD><TD>&nbsp;</TD><TD>Number of bits (=0 means no quantization error)</TD></TR>
<TR><TD>Boolean</TD><TD>unitDelay</TD><TD>true</TD><TD>= true, if one sample period delay, = false, if computing time not modelled</TD></TR>
<TR><TD>Integer</TD><TD>sampleFactor</TD><TD>1</TD><TD>Ts=sampleClock.sampleTime*sampleFactor</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>input <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>u</TD><TD>Continuous or discrete input signal of block</TD></TR>
<TR><TD>output <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>y</TD><TD>Continuous or discrete output signal of block</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">block</font> DiscreteDAconverter <font color="darkgreen">
  &quot;Digital to analog converter as discrete block (including zero order hold)&quot;</font>
  <font color="blue">parameter </font>Real y_max <font color="darkgreen">&quot;Upper limit of output signal&quot;</font>;
  <font color="blue">parameter </font>Real y_min <font color="darkgreen">&quot;Lower limit of output signal&quot;</font>;
  <font color="blue">parameter </font>Integer bits(min=0) <font color="darkgreen">
    &quot;Number of bits (=0 means no quantization error)&quot;</font>;
  <font color="blue">parameter </font>Boolean unitDelay = true <font color="darkgreen">
    &quot;= true, if one sample period delay, = false, if computing time not modelled&quot;</font>;
  <font color="blue">extends </font><A HREF="Modelica_LinearSystems2_Controller_Interfaces.html#Modelica_LinearSystems2.Controller.Interfaces.PartialDiscreteSISO_equality"
>Interfaces.PartialDiscreteSISO_equality</A>;
<font color="blue">protected </font>
  <font color="blue">parameter </font>Real quantization=<font color="blue">if </font>bits &gt; 0<font color="blue"> then </font>((y_max - y_min)/2^bits)<font color="blue"> else </font>0;
  <font color="blue">discrete </font>Real y_bound <font color="darkgreen">&quot;Bounded output&quot;</font>;
  <font color="blue">discrete </font>Real y_sampled <font color="darkgreen">&quot;Sampled output&quot;</font>;
  <font color="blue">discrete </font>Real y_delaySampled <font color="darkgreen">
    &quot;Sampled output with a delay of one sample period&quot;</font>;
<font color="blue">equation </font>
  <font color="blue">when </font>{<font color="red">initial</font>(),sampleTrigger}<font color="blue"> then</font>
     u_sampled = u;
     y_bound = <font color="blue">if </font>u &gt; y_max<font color="blue"> then </font>y_max<font color="blue"> else </font><font color="blue">if </font>u &lt; y_min<font color="blue"> then </font>y_min<font color="blue"> else </font>u;
     y_sampled = <font color="blue">if </font>bits &gt; 0<font color="blue"> then </font>quantization*<font color="red">floor</font>(<font color="red">abs</font>(y_bound/quantization) + 0.5)
                 *(<font color="blue">if </font>y_bound &gt;= 0<font color="blue"> then </font>+1<font color="blue"> else </font>-1)<font color="blue"> else </font>y_bound;
     <font color="blue">if </font>unitDelay<font color="blue"> then</font>
        y_delaySampled = <font color="blue">if </font><font color="red">initial</font>()<font color="blue"> then </font>y_sampled<font color="blue"> else </font><font color="red">pre</font>(y_sampled);
     <font color="blue">else</font>
        y_delaySampled = y_sampled;
     <font color="blue">end if</font>;
  <font color="blue">end when</font>;

  y = y_delaySampled;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>DiscreteDAconverter;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE DiscreteFIR<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteFIRI.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteFIR" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_LinearSystems2.Controller.Internal.DiscreteFIR"></A><A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal"
>Modelica_LinearSystems2.Controller.Internal</A>.DiscreteFIR</H2>
<B>Realization of FIR filter</B><p>
<IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteFIRD.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteFIR">
<P><H3>Information</H3></P>
<PRE></pre>
<pre>
</PRE><P>
Extends from <A HREF="Modelica_LinearSystems2_Controller_Interfaces.html#Modelica_LinearSystems2.Controller.Interfaces.PartialDiscreteSISO_equality"
>Interfaces.PartialDiscreteSISO_equality</A> (Common discrete part of blocks extending from PartialSISO_equality).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Integer</TD><TD>sampleFactor</TD><TD>1</TD><TD>Ts=sampleClock.sampleTime*sampleFactor</TD></TR>
<TR><TD>Real</TD><TD>a[:]</TD><TD>{1,1}</TD><TD>Coefficients of FIR filter</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>input <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>u</TD><TD>Continuous or discrete input signal of block</TD></TR>
<TR><TD>output <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>y</TD><TD>Continuous or discrete output signal of block</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">block</font> DiscreteFIR <font color="darkgreen">&quot;Realization of FIR filter&quot;</font>
  <font color="blue">extends </font><A HREF="Modelica_LinearSystems2_Controller_Interfaces.html#Modelica_LinearSystems2.Controller.Interfaces.PartialDiscreteSISO_equality"
>Interfaces.PartialDiscreteSISO_equality</A>;
  <font color="blue">parameter </font>Real a[:]={1,1} <font color="darkgreen">&quot;Coefficients of FIR filter&quot;</font>;
<font color="blue">protected </font>
  <font color="blue">parameter </font>Integer n =<font color="red"> size</font>(a, 1) - 1;
  <font color="blue">discrete </font>Real x[n];
  <font color="blue">discrete </font>Real sum[n];
  <font color="blue">discrete </font>Real y_sampled <font color="darkgreen">&quot;Sampled output&quot;</font>;
<font color="blue">equation </font>
  <font color="blue">when </font>{<font color="red">initial</font>(), sampleTrigger}<font color="blue"> then</font>
     u_sampled = u;
     x[1] =<font color="red"> pre</font>(u);
     sum[1] = a[2]*x[1];
     x[2:n] =<font color="red"> pre</font>(x[1:n - 1]);
     sum[2:n] = a[3:n + 1]*<font color="red">diagonal</font>(x[2:n]) + sum[1:n - 1];
     y_sampled = a[1]*u + sum[n];
  <font color="blue">end when</font>;
  y = y_sampled;
<font color="blue">initial </font><font color="blue">equation </font>
  u =<font color="red"> pre</font>(u);
  x =<font color="red"> pre</font>(x);
  sum =<font color="red"> pre</font>(sum);
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>DiscreteFIR;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE DiscreteNoise<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteNoiseI.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteNoise" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_LinearSystems2.Controller.Internal.DiscreteNoise"></A><A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal"
>Modelica_LinearSystems2.Controller.Internal</A>.DiscreteNoise</H2>
<B>Uniform distributed noise for discrete blocks</B><p>
<IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteNoiseD.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteNoise">
<P><H3>Information</H3></P>
<PRE></pre>
<pre>
</PRE><P>
Extends from <A HREF="Modelica_LinearSystems2_Controller_Interfaces.html#Modelica_LinearSystems2.Controller.Interfaces.PartialBlockIcon"
>Interfaces.PartialBlockIcon</A> (Basic graphical layout of discrete/continuous block).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>y_min</TD><TD>&nbsp;</TD><TD>Lower limit of noise band</TD></TR>
<TR><TD>Real</TD><TD>y_max</TD><TD>&nbsp;</TD><TD>Upper limit of noise band</TD></TR>
<TR><TD>Integer</TD><TD>firstSeed[3]</TD><TD>{23,87,187}</TD><TD>Integer[3] defining random sequence; required element range: 0..255</TD></TR>
<TR><TD>Integer</TD><TD>sampleFactor</TD><TD>1</TD><TD>Noise sample time = sampleClock.sampleTime*sampleFactor</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>output <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>y</TD><TD>Noise output signal in the range [y_min .. y_max]</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">block</font> DiscreteNoise <font color="darkgreen">&quot;Uniform distributed noise for discrete blocks&quot;</font>
  <font color="blue">extends </font><A HREF="Modelica_LinearSystems2_Controller_Interfaces.html#Modelica_LinearSystems2.Controller.Interfaces.PartialBlockIcon"
>Interfaces.PartialBlockIcon</A>;

  <font color="blue">parameter </font>Real y_min <font color="darkgreen">&quot;Lower limit of noise band&quot;</font>;
  <font color="blue">parameter </font>Real y_max <font color="darkgreen">&quot;Upper limit of noise band&quot;</font>;
  <font color="blue">parameter </font>Integer firstSeed[3](<font color="blue">each </font>min=0, <font color="blue">each </font>max=255) = {23,87,187} <font color="darkgreen">
    &quot;Integer[3] defining random sequence; required element range: 0..255&quot;</font>;
  <font color="blue">parameter </font>Integer sampleFactor(min=1)=1 <font color="darkgreen">
    &quot;Noise sample time = sampleClock.sampleTime*sampleFactor&quot;</font>;
  <font color="blue">final </font><font color="blue">parameter </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> Ts = sampleClock.sampleTime*sampleFactor <font color="darkgreen">
    &quot;Sample time&quot;</font>;
<textblock type="annotcomp" expanded="false">  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> y <font color="darkgreen">
    &quot;Noise output signal in the range [y_min .. y_max]&quot;</font>;</textblock>

<font color="blue">protected </font>
  <font color="blue">outer </font><A HREF="Modelica_LinearSystems2_Controller.html#Modelica_LinearSystems2.Controller.SampleClock"
>SampleClock</A> sampleClock <font color="darkgreen">&quot;Global options&quot;</font>;
  Integer ticks <font color="darkgreen">
    &quot;Actual number of base samples starting from the last sample time instant&quot;</font>;
  Integer seedState[3] <font color="darkgreen">&quot;State of seed&quot;</font>;
  Boolean sampleTrigger <font color="darkgreen">&quot;Triggers next sample time&quot;</font>;
  <font color="blue">discrete </font>Real noise <font color="darkgreen">&quot;Noise in the range 0..1&quot;</font>;
  <font color="blue">discrete </font>Real y_sampled <font color="darkgreen">&quot;Sampled output&quot;</font>;
<font color="blue">equation </font>
  <font color="blue">if </font>sampleClock.blockType == Types.BlockType.Continuous<font color="blue"> then</font>
    <font color="darkgreen"> // no sampling in sampleClock</font>
     sampleTrigger =<font color="red"> sample</font>(Ts, Ts);
     ticks = 0;
  <font color="blue">else</font>
     <font color="blue">when </font>sampleClock.sampleTrigger<font color="blue"> then</font>
        ticks = <font color="blue">if </font><font color="red">pre</font>(ticks) &lt; sampleFactor<font color="blue"> then </font><font color="red">pre</font>(ticks) + 1<font color="blue"> else </font>1;
     <font color="blue">end when</font>;
     sampleTrigger = sampleClock.sampleTrigger<font color="blue"> and </font>ticks &gt;= sampleFactor;
  <font color="blue">end if</font>;

  <font color="blue">when </font>{<font color="red">initial</font>(), sampleTrigger}<font color="blue"> then</font>
     (noise,seedState) =<font color="red"> random</font>(<font color="red">pre</font>(seedState));
      y_sampled = y_min + (y_max - y_min)*noise;
  <font color="blue">end when</font>;
  y = y_sampled;

<font color="blue">initial </font><font color="blue">equation </font>
  <font color="red">pre</font>(ticks) = 0;
  <font color="red">pre</font>(seedState) = firstSeed;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>DiscreteNoise;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE DiscreteSampler<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteSamplerI.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteSampler" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_LinearSystems2.Controller.Internal.DiscreteSampler"></A><A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal"
>Modelica_LinearSystems2.Controller.Internal</A>.DiscreteSampler</H2>
<B>Sample the input signal</B><p>
<IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteSamplerD.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteSampler">
<P><H3>Information</H3></P>
<PRE></pre>
<pre>
</PRE><P>
Extends from <A HREF="Modelica_LinearSystems2_Controller_Interfaces.html#Modelica_LinearSystems2.Controller.Interfaces.PartialDiscreteSISO_equality"
>Interfaces.PartialDiscreteSISO_equality</A> (Common discrete part of blocks extending from PartialSISO_equality).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Integer</TD><TD>sampleFactor</TD><TD>1</TD><TD>Ts=sampleClock.sampleTime*sampleFactor</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>input <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>u</TD><TD>Continuous or discrete input signal of block</TD></TR>
<TR><TD>output <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>y</TD><TD>Continuous or discrete output signal of block</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">block</font> DiscreteSampler <font color="darkgreen">&quot;Sample the input signal&quot;</font>
  <font color="blue">extends </font><A HREF="Modelica_LinearSystems2_Controller_Interfaces.html#Modelica_LinearSystems2.Controller.Interfaces.PartialDiscreteSISO_equality"
>Interfaces.PartialDiscreteSISO_equality</A>;

<font color="blue">equation </font>
  <font color="blue">when </font>{<font color="red">initial</font>(), sampleTrigger}<font color="blue"> then</font>
      u_sampled = u;
  <font color="blue">end when</font>;

  y = u_sampled;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>DiscreteSampler;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE DiscreteStateSpace<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteStateSpaceI.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteStateSpace" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_LinearSystems2.Controller.Internal.DiscreteStateSpace"></A><A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal"
>Modelica_LinearSystems2.Controller.Internal</A>.DiscreteStateSpace</H2>
<B>Discrete linear time invariant state space system block parameterized with a continuous state space system</B><p>
<IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteStateSpaceD.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteStateSpace">
<P><H3>Information</H3></P>
<PRE></pre>
<pre></PRE><P>
Extends from <A HREF="Modelica_LinearSystems2_Controller_Interfaces.html#Modelica_LinearSystems2.Controller.Interfaces.PartialBlockIcon"
>Interfaces.PartialBlockIcon</A> (Basic graphical layout of discrete/continuous block).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>StateSpace</A></TD><TD>system</TD><TD>&nbsp;</TD><TD>Continuous linear time-invariant system</TD></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Controller_Types.html#Modelica_LinearSystems2.Controller.Types.MethodWithGlobalDefault"
>MethodWithGlobalDefault</A></TD><TD>methodType</TD><TD>Modelica_LinearSystems2.Cont...</TD><TD>Type of discretization</TD></TR>
<TR><TD>Integer</TD><TD>sampleFactor</TD><TD>1</TD><TD>sample time=sampleClock.sampleTime*sampleFactor</TD></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Controller_Types.html#Modelica_LinearSystems2.Controller.Types.Init"
>Init</A></TD><TD>init</TD><TD>Types.InitWithGlobalDefault....</TD><TD>Type of initialization (No init/InitialState/SteadyState/Output)</TD></TR>
<TR><TD>Real</TD><TD>x_start[nx]</TD><TD>zeros(nx)</TD><TD>Initial value of continuous state x, if init=InitialState (otherwise guess value)</TD></TR>
<TR><TD>Real</TD><TD>y_start[ny]</TD><TD>zeros(ny)</TD><TD>Initial value of continuous output y, if init=InitialOutput (otherwise guess value)</TD></TR>
<TR><TD>Boolean</TD><TD>withDelay</TD><TD>false</TD><TD>is true if a unit delay should be considered</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>input <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>u[nu]</TD><TD>Continuous or discrete input signals of block</TD></TR>
<TR><TD>output <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>y[ny]</TD><TD>Discrete output signals of block</TD></TR>
<TR><TD>output <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>x[nx]</TD><TD>State vector of continuous system at sample times</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> DiscreteStateSpace <font color="darkgreen">
  &quot;Discrete linear time invariant state space system block parameterized with a continuous state space system&quot;</font>

  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Controller_Types.html#Modelica_LinearSystems2.Controller.Types"
>Modelica_LinearSystems2.Controller.Types</A>;
  <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Math_Matrices.html#Modelica.Math.Matrices"
>Modelica.Math.Matrices</A>;

  <font color="blue">extends </font><A HREF="Modelica_LinearSystems2_Controller_Interfaces.html#Modelica_LinearSystems2.Controller.Interfaces.PartialBlockIcon"
>Interfaces.PartialBlockIcon</A>;

  <font color="blue">parameter </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A> system(
    A=<font color="red">fill</font>(0, 0, 0),
    B=<font color="red">fill</font>(0, 0, 1),
    C=<font color="red">fill</font>(0, 1, 0),
    D=<font color="red">fill</font>(0, 1, 1), uNames={&quot;u&quot;},yNames={&quot;y&quot;}) <font color="darkgreen">
    &quot;Continuous linear time-invariant system&quot;</font>;

  <font color="blue">parameter </font><A HREF="Modelica_LinearSystems2_Controller_Types.html#Modelica_LinearSystems2.Controller.Types.MethodWithGlobalDefault"
>Types.MethodWithGlobalDefault</A> methodType=Modelica_LinearSystems2.Controller.Types.MethodWithGlobalDefault.UseSampleClockOption <font color="darkgreen">
    &quot;Type of discretization&quot;</font>;
  <font color="blue">final </font><font color="blue">parameter </font><A HREF="Modelica_LinearSystems2_Controller_Types.html#Modelica_LinearSystems2.Controller.Types.Method"
>Types.Method</A> method=<font color="blue">if </font>methodType == Types.MethodWithGlobalDefault.UseSampleClockOption<font color="blue"> then </font>
            sampleClock.methodType<font color="blue"> else </font>methodType <font color="darkgreen">
    &quot;Discretization method (explicitEuler/implicitEuler/trapezoidal/stepExact/rampExact)&quot;</font>;

  <font color="blue">parameter </font>Integer sampleFactor(min=1) = 1 <font color="darkgreen">
    &quot;sample time=sampleClock.sampleTime*sampleFactor&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_LinearSystems2_Controller_Types.html#Modelica_LinearSystems2.Controller.Types.Init"
>Types.Init</A> init=Types.InitWithGlobalDefault.UseSampleClockOption <font color="darkgreen">
    &quot;Type of initialization (No init/InitialState/SteadyState/Output)&quot;</font>;
  <font color="blue">parameter </font>Real x_start[nx]=<font color="red">zeros</font>(nx) <font color="darkgreen">
    &quot;Initial value of continuous state x, if init=InitialState (otherwise guess value)&quot;</font>;
  <font color="blue">parameter </font>Real y_start[ny]=<font color="red">zeros</font>(ny) <font color="darkgreen">
    &quot;Initial value of continuous output y, if init=InitialOutput (otherwise guess value)&quot;</font>;
  <font color="blue">parameter </font>Boolean withDelay = false <font color="darkgreen">
    &quot;is true if a unit delay should be considered&quot;</font>;

  <font color="blue">final </font><font color="blue">parameter </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> Ts=sampleClock.sampleTime*sampleFactor <font color="darkgreen">
    &quot;Sample time&quot;</font>;
  <font color="blue">final </font><font color="blue">parameter </font>Integer nx=<font color="red">size</font>(system.A, 1) <font color="darkgreen">&quot;Number of states&quot;</font>;
  <font color="blue">final </font><font color="blue">parameter </font>Integer nu=<font color="red">size</font>(system.B, 2) <font color="darkgreen">&quot;Number of inputs&quot;</font>;
  <font color="blue">final </font><font color="blue">parameter </font>Integer ny=<font color="red">size</font>(system.C, 1) <font color="darkgreen">&quot;Number of outputs&quot;</font>;

<textblock type="annotcomp" expanded="false">  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> u[nu] <font color="darkgreen">
    &quot;Continuous or discrete input signals of block&quot;</font>;
  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> y[ny](start=y_start) <font color="darkgreen">
    &quot;Discrete output signals of block&quot;</font>;</textblock>
  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> x[nx](start=x_start) <font color="darkgreen">
    &quot;State vector of continuous system at sample times&quot;</font>;

<font color="blue">protected </font>
  <font color="blue">outer </font><A HREF="Modelica_LinearSystems2_Controller.html#Modelica_LinearSystems2.Controller.SampleClock"
>SampleClock</A> sampleClock <font color="darkgreen">&quot;Global options&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.DiscreteStateSpace"
>Modelica_LinearSystems2.DiscreteStateSpace</A> discreteSystem=
      <font color="red">Modelica_LinearSystems2.DiscreteStateSpace</font>(
      system,
      Ts,
      method);

 <font color="blue">discrete </font>Real xd[nx](start=x_start) <font color="darkgreen">
    &quot;State vector of discrete system (pre(xd) = x - B2*u)&quot;</font>;
  <font color="blue">discrete </font>Real new_xd[nx](start=x_start) <font color="darkgreen">&quot;Next valued of xd&quot;</font>;

<font color="darkgreen">// Derived quantities</font>
  <font color="blue">discrete </font>Real u_sampled[nu] <font color="darkgreen">&quot;Sampled continuous input signal u&quot;</font>;
  <font color="blue">discrete </font>Real pre_u_sampled[nu] <font color="darkgreen">&quot;Sampled continuous input signal u&quot;</font>;
  <font color="blue">discrete </font>Real y_sampled[ny] <font color="darkgreen">&quot;Sampled continuous output&quot;</font>;
  <font color="blue">discrete </font>Real x_sampled[nx] <font color="darkgreen">&quot;Sampled continuous state&quot;</font>;
  Integer ticks <font color="darkgreen">
    &quot;Actual number of base samples starting from the last sample time instant&quot;</font>;
  Boolean sampleTrigger <font color="darkgreen">&quot;Triggers next sample time&quot;</font>;

<font color="blue">equation </font>
  <font color="blue">if </font>sampleClock.blockType == Types.BlockType.Continuous<font color="blue"> then</font>
    <font color="darkgreen"> // no sampling in sampleClock</font>
    sampleTrigger =<font color="red"> sample</font>(Ts, Ts);
    ticks = 0;
  <font color="blue">else</font>
    <font color="blue">when </font>sampleClock.sampleTrigger<font color="blue"> then</font>
      ticks = <font color="blue">if </font><font color="red">pre</font>(ticks) &lt; sampleFactor<font color="blue"> then </font><font color="red">pre</font>(ticks) + 1<font color="blue"> else </font>1;
    <font color="blue">end when</font>;
    sampleTrigger = sampleClock.sampleTrigger<font color="blue"> and </font>ticks &gt;= sampleFactor;
  <font color="blue">end if</font>;

  <font color="blue">when </font>{<font color="red">initial</font>(),sampleTrigger}<font color="blue"> then</font>
    u_sampled = u;
    pre_u_sampled =<font color="red"> pre</font>(u_sampled);
<font color="blue">if </font>withDelay<font color="blue"> then</font>
    new_xd = discreteSystem.B*pre_u_sampled + discreteSystem.A*xd;
    y_sampled = discreteSystem.C*xd + discreteSystem.D*pre_u_sampled;
    x_sampled = xd + discreteSystem.B2*pre_u_sampled;
<font color="blue">else</font>
    new_xd = discreteSystem.B*u_sampled + discreteSystem.A*xd;
    y_sampled = discreteSystem.C*xd + discreteSystem.D*u_sampled;
    x_sampled = xd + discreteSystem.B2*u_sampled;
<font color="blue">end if</font>;
    xd =<font color="red"> pre</font>(new_xd);
  <font color="blue">end when</font>;

  y = y_sampled;
  x = x_sampled;

<font color="blue">initial </font><font color="blue">equation </font>
  <font color="red">pre</font>(ticks) = 0;

  <font color="blue">if </font>init == Types.Init.InitialState<font color="blue"> then</font>
    x = x_start;

  <font color="blue">elseif </font>init == Types.Init.SteadyState<font color="blue"> then</font>

    <font color="blue">if </font><font color="red">Matrices.isEqual</font>(
        discreteSystem.A,
        <font color="red">identity</font>(nx),
        100*Modelica.Constants.eps)<font color="blue"> then</font>
      <font color="darkgreen">  // block contains an integrator and is only possible to initialize with steady states steady state when u==0</font>
      u =<font color="red"> fill</font>(0.0, nu);
      xd[nu + 1:nx] =<font color="red"> pre</font>(x[nu + 1:nx]);
    <font color="blue">else</font>

      xd = discreteSystem.B*u_sampled + discreteSystem.A*xd;<font color="darkgreen">//new_xd;</font>

    <font color="blue">end if</font>;

  <font color="blue">elseif </font>init == Types.Init.InitialOutput<font color="blue"> then</font>
  y=y_start;
 xd[ny+1:nx]=[<font color="red">zeros</font>(nx-ny,ny),<font color="red">identity</font>(nx-ny)]*<font color="red">Modelica.Math.Matrices.solve</font>(<font color="red">identity</font>(nx)-discreteSystem.A,discreteSystem.B*u);

  <font color="blue">end if</font>;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>DiscreteStateSpace;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE DiscreteStateSpace2<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteStateSpaceI.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteStateSpace2" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_LinearSystems2.Controller.Internal.DiscreteStateSpace2"></A><A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal"
>Modelica_LinearSystems2.Controller.Internal</A>.DiscreteStateSpace2</H2>
<B>Discrete linear time invariant state space system block parameterized with a continuous state space system</B><p>
<IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteStateSpaceD.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteStateSpace2">
<P><H3>Information</H3></P>
<PRE></pre>
<pre></PRE><P>
Extends from <A HREF="Modelica_LinearSystems2_Controller_Interfaces.html#Modelica_LinearSystems2.Controller.Interfaces.PartialBlockIcon"
>Interfaces.PartialBlockIcon</A> (Basic graphical layout of discrete/continuous block).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>ABCD[:, :]</TD><TD>&nbsp;</TD><TD>Continuous linear time-invariant system</TD></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Controller_Types.html#Modelica_LinearSystems2.Controller.Types.MethodWithGlobalDefault"
>MethodWithGlobalDefault</A></TD><TD>methodType</TD><TD>Modelica_LinearSystems2.Cont...</TD><TD>Type of discretization</TD></TR>
<TR><TD>Integer</TD><TD>sampleFactor</TD><TD>1</TD><TD>sample time=sampleClock.sampleTime*sampleFactor</TD></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Controller_Types.html#Modelica_LinearSystems2.Controller.Types.Init"
>Init</A></TD><TD>init</TD><TD>Types.InitWithGlobalDefault....</TD><TD>Type of initialization (No init/InitialState/SteadyState/Output)</TD></TR>
<TR><TD>Real</TD><TD>x_start[nx]</TD><TD>zeros(nx)</TD><TD>Initial value of continuous state x, if init=InitialState (otherwise guess value)</TD></TR>
<TR><TD>Real</TD><TD>y_start[ny]</TD><TD>zeros(ny)</TD><TD>Initial value of continuous output y, if init=InitialOutput (otherwise guess value)</TD></TR>
<TR><TD>Boolean</TD><TD>withDelay</TD><TD>false</TD><TD>= true, if a unit delay should be considered</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>input <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>u[nu]</TD><TD>Continuous or discrete input signals of block</TD></TR>
<TR><TD>output <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>y[ny]</TD><TD>Discrete output signals of block</TD></TR>
<TR><TD>output <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>x[nx]</TD><TD>State vector of continuous system at sample times</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> DiscreteStateSpace2 <font color="darkgreen">
  &quot;Discrete linear time invariant state space system block parameterized with a continuous state space system&quot;</font>

  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Controller_Types.html#Modelica_LinearSystems2.Controller.Types"
>Modelica_LinearSystems2.Controller.Types</A>;
  <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Math_Matrices.html#Modelica.Math.Matrices"
>Modelica.Math.Matrices</A>;

  <font color="blue">extends </font><A HREF="Modelica_LinearSystems2_Controller_Interfaces.html#Modelica_LinearSystems2.Controller.Interfaces.PartialBlockIcon"
>Interfaces.PartialBlockIcon</A>;

  <font color="blue">parameter </font>Real ABCD[:,:] <font color="darkgreen">&quot;Continuous linear time-invariant system&quot;</font>;

<font color="blue">protected </font>
      <font color="blue">parameter </font>Real A[:,:] = ABCD[1:<font color="blue">end</font>-1,1:<font color="blue">end</font>-1];
      <font color="blue">parameter </font>Real B[:,:] = ABCD[1:<font color="blue">end</font>-1,<font color="blue">end</font>:<font color="blue">end</font>];
      <font color="blue">parameter </font>Real C[:,:] = ABCD[<font color="blue">end</font>:<font color="blue">end</font>,1:<font color="blue">end</font>-1];
      <font color="blue">parameter </font>Real D[:,:] =<font color="red"> matrix</font>(ABCD[<font color="blue">end</font>,<font color="blue">end</font>]);
<font color="blue">public </font>
  <font color="blue">final </font><font color="blue">parameter </font>Integer nx=<font color="red">size</font>(A, 1) <font color="darkgreen">&quot;Number of states&quot;</font>;
  <font color="blue">final </font><font color="blue">parameter </font>Integer nu=<font color="red">size</font>(B, 2) <font color="darkgreen">&quot;Number of inputs&quot;</font>;
  <font color="blue">final </font><font color="blue">parameter </font>Integer ny=<font color="red">size</font>(C, 1) <font color="darkgreen">&quot;Number of outputs&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_LinearSystems2_Controller_Types.html#Modelica_LinearSystems2.Controller.Types.MethodWithGlobalDefault"
>Types.MethodWithGlobalDefault</A> methodType=Modelica_LinearSystems2.Controller.Types.MethodWithGlobalDefault.UseSampleClockOption <font color="darkgreen">
    &quot;Type of discretization&quot;</font>;
  <font color="blue">final </font><font color="blue">parameter </font><A HREF="Modelica_LinearSystems2_Controller_Types.html#Modelica_LinearSystems2.Controller.Types.Method"
>Types.Method</A> method=<font color="blue">if </font>methodType == Types.MethodWithGlobalDefault.UseSampleClockOption<font color="blue"> then </font>
            sampleClock.methodType<font color="blue"> else </font>methodType <font color="darkgreen">
    &quot;Discretization method (explicitEuler/implicitEuler/trapezoidal/stepExact/rampExact)&quot;</font>;

  <font color="blue">parameter </font>Integer sampleFactor(min=1) = 1 <font color="darkgreen">
    &quot;sample time=sampleClock.sampleTime*sampleFactor&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_LinearSystems2_Controller_Types.html#Modelica_LinearSystems2.Controller.Types.Init"
>Types.Init</A> init=Types.InitWithGlobalDefault.UseSampleClockOption <font color="darkgreen">
    &quot;Type of initialization (No init/InitialState/SteadyState/Output)&quot;</font>;
  <font color="blue">parameter </font>Real x_start[nx]=<font color="red">zeros</font>(nx) <font color="darkgreen">
    &quot;Initial value of continuous state x, if init=InitialState (otherwise guess value)&quot;</font>;
  <font color="blue">parameter </font>Real y_start[ny]=<font color="red">zeros</font>(ny) <font color="darkgreen">
    &quot;Initial value of continuous output y, if init=InitialOutput (otherwise guess value)&quot;</font>;
  <font color="blue">parameter </font>Boolean withDelay = false <font color="darkgreen">
    &quot;= true, if a unit delay should be considered&quot;</font>;

  <font color="blue">final </font><font color="blue">parameter </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> Ts=sampleClock.sampleTime*sampleFactor <font color="darkgreen">
    &quot;Sample time&quot;</font>;

<textblock type="annotcomp" expanded="false">  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> u[nu] <font color="darkgreen">
    &quot;Continuous or discrete input signals of block&quot;</font>;
  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> y[ny](start=y_start) <font color="darkgreen">
    &quot;Discrete output signals of block&quot;</font>;</textblock>
  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> x[nx](start=x_start) <font color="darkgreen">
    &quot;State vector of continuous system at sample times&quot;</font>;

<font color="blue">protected </font>
  <font color="blue">outer </font><A HREF="Modelica_LinearSystems2_Controller.html#Modelica_LinearSystems2.Controller.SampleClock"
>SampleClock</A> sampleClock <font color="darkgreen">&quot;Global options&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.DiscreteStateSpace"
>Modelica_LinearSystems2.DiscreteStateSpace</A> discreteSystem=
      <font color="red">Modelica_LinearSystems2.DiscreteStateSpace</font>(
      A, B, C, D,
      Ts,
      method);

 <font color="blue">discrete </font>Real xd[nx](start=x_start) <font color="darkgreen">
    &quot;State vector of discrete system (pre(xd) = x - B2*u)&quot;</font>;
  <font color="blue">discrete </font>Real new_xd[nx](start=x_start) <font color="darkgreen">&quot;Next value of xd&quot;</font>;

<font color="darkgreen">// Derived quantities</font>
  <font color="blue">discrete </font>Real u_sampled[nu] <font color="darkgreen">&quot;Sampled continuous input signal u&quot;</font>;
  <font color="blue">discrete </font>Real pre_u_sampled[nu] <font color="darkgreen">
    &quot;Sampled continuous input signal u of previous sample interval&quot;</font>;
  <font color="blue">discrete </font>Real y_sampled[ny] <font color="darkgreen">&quot;Sampled continuous output&quot;</font>;
  <font color="blue">discrete </font>Real x_sampled[nx] <font color="darkgreen">&quot;Sampled continuous state&quot;</font>;
  Integer ticks <font color="darkgreen">
    &quot;Actual number of base samples starting from the last sample time instant&quot;</font>;
  Boolean sampleTrigger <font color="darkgreen">&quot;Triggers next sample time&quot;</font>;

<font color="blue">equation </font>
  <font color="blue">if </font>sampleClock.blockType == Types.BlockType.Continuous<font color="blue"> then</font>
    <font color="darkgreen"> // no sampling in sampleClock</font>
    sampleTrigger =<font color="red"> sample</font>(Ts, Ts);
    ticks = 0;
  <font color="blue">else</font>
    <font color="blue">when </font>sampleClock.sampleTrigger<font color="blue"> then</font>
      ticks = <font color="blue">if </font><font color="red">pre</font>(ticks) &lt; sampleFactor<font color="blue"> then </font><font color="red">pre</font>(ticks) + 1<font color="blue"> else </font>1;
    <font color="blue">end when</font>;
    sampleTrigger = sampleClock.sampleTrigger<font color="blue"> and </font>ticks &gt;= sampleFactor;
  <font color="blue">end if</font>;

  <font color="blue">when </font>{<font color="red">initial</font>(),sampleTrigger}<font color="blue"> then</font>
    u_sampled = u;
    pre_u_sampled =<font color="red"> pre</font>(u_sampled);
    <font color="blue">if </font>withDelay<font color="blue"> then</font>
       new_xd = discreteSystem.B*pre_u_sampled + discreteSystem.A*xd;
       y_sampled = discreteSystem.C*xd + discreteSystem.D*pre_u_sampled;
       x_sampled = xd + discreteSystem.B2*pre_u_sampled;
    <font color="blue">else</font>
       new_xd = discreteSystem.B*u_sampled + discreteSystem.A*xd;
       y_sampled = discreteSystem.C*xd + discreteSystem.D*u_sampled;
       x_sampled = xd + discreteSystem.B2*u_sampled;
    <font color="blue">end if</font>;
    xd =<font color="red"> pre</font>(new_xd);
  <font color="blue">end when</font>;

  y = y_sampled;
  x = x_sampled;

<font color="blue">initial </font><font color="blue">equation </font>
  <font color="red">pre</font>(ticks) = 0;
  <font color="red">pre</font>(x) = x_start;
  <font color="red">pre</font>(u_sampled) = u_sampled;

  <font color="blue">if </font>init == Types.Init.InitialState<font color="blue"> then</font>
    x = x_start;

  <font color="blue">elseif </font>init == Types.Init.SteadyState<font color="blue"> then</font>

    <font color="blue">if </font><font color="red">Matrices.isEqual</font>(
        discreteSystem.A,
        <font color="red">identity</font>(nx),
        100*Modelica.Constants.eps)<font color="blue"> then</font>
      <font color="darkgreen">  // block contains an integrator and is only possible to initialize with steady states steady state when u==0</font>
      u =<font color="red"> fill</font>(0.0, nu);
      xd[nu + 1:nx] =<font color="red"> pre</font>(x[nu + 1:nx]);
    <font color="blue">else</font>
      xd = discreteSystem.B*u_sampled + discreteSystem.A*xd;<font color="darkgreen">//new_xd;</font>
    <font color="blue">end if</font>;

  <font color="blue">elseif </font>init == Types.Init.InitialOutput<font color="blue"> then</font>
     y=y_start;
     xd[ny+1:nx]=[<font color="red">zeros</font>(nx-ny,ny),<font color="red">identity</font>(nx-ny)]*<font color="red">Modelica.Math.Matrices.solve</font>(<font color="red">identity</font>(nx)-discreteSystem.A,discreteSystem.B*u);
  <font color="blue">end if</font>;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>DiscreteStateSpace2;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE DiscreteUnitDelay<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteUnitDelayI.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteUnitDelay" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_LinearSystems2.Controller.Internal.DiscreteUnitDelay"></A><A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal"
>Modelica_LinearSystems2.Controller.Internal</A>.DiscreteUnitDelay</H2>
<B>Delay the input signal by one sample instant</B><p>
<IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteUnitDelayD.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteUnitDelay">
<P><H3>Information</H3></P>
<PRE></pre>
<pre>
</PRE><P>
Extends from <A HREF="Modelica_LinearSystems2_Controller_Interfaces.html#Modelica_LinearSystems2.Controller.Interfaces.PartialDiscreteSISO_equality"
>Interfaces.PartialDiscreteSISO_equality</A> (Common discrete part of blocks extending from PartialSISO_equality).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Integer</TD><TD>sampleFactor</TD><TD>1</TD><TD>Ts=sampleClock.sampleTime*sampleFactor</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>input <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>u</TD><TD>Continuous or discrete input signal of block</TD></TR>
<TR><TD>output <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>y</TD><TD>Continuous or discrete output signal of block</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">block</font> DiscreteUnitDelay <font color="darkgreen">
  &quot;Delay the input signal by one sample instant&quot;</font>
  <font color="blue">extends </font><A HREF="Modelica_LinearSystems2_Controller_Interfaces.html#Modelica_LinearSystems2.Controller.Interfaces.PartialDiscreteSISO_equality"
>Interfaces.PartialDiscreteSISO_equality</A>;

<font color="blue">protected </font>
  <font color="blue">discrete </font>Real y_sampled <font color="darkgreen">&quot;Sampled output&quot;</font>;
<font color="blue">equation </font>
  <font color="blue">when </font>{<font color="red">initial</font>(), sampleTrigger}<font color="blue"> then</font>
     u_sampled = u;
     y_sampled =<font color="red"> pre</font>(u_sampled);
  <font color="blue">end when</font>;
  y = y_sampled;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>DiscreteUnitDelay;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE DiscreteInterpolator<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteInterpolatorI.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteInterpolator" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_LinearSystems2.Controller.Internal.DiscreteInterpolator"></A><A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal"
>Modelica_LinearSystems2.Controller.Internal</A>.DiscreteInterpolator</H2>
<B>Increasing the sampling frequency with linear interpolation</B><p>
<IMG SRC="Modelica_LinearSystems2.Controller.Internal.DiscreteInterpolatorD.png" ALT="Modelica_LinearSystems2.Controller.Internal.DiscreteInterpolator">
<P><H3>Information</H3></P>
<PRE></pre>
<p>
</p>
<pre>
</PRE><P>
Extends from <A HREF="Modelica_LinearSystems2_Controller_Interfaces.html#Modelica_LinearSystems2.Controller.Interfaces.PartialBlockIcon"
>Interfaces.PartialBlockIcon</A> (Basic graphical layout of discrete/continuous block).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Integer</TD><TD>inputSampleFactor</TD><TD>1</TD><TD>Input sample time = inputSampleFactor * sampleClock.sampleTime</TD></TR>
<TR><TD>Integer</TD><TD>outputSampleFactor</TD><TD>1</TD><TD>Output sample time = outputSampleFactor * sampleClock.sampleTime<br>(inputSampleFactor must be an integer multiple of outputSampleFactor)</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>input <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>u</TD><TD>Continuous or discrete input signal of block</TD></TR>
<TR><TD>output <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>y</TD><TD>Continuous or discrete output signal of block</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">block</font> DiscreteInterpolator <font color="darkgreen">
  &quot;Increasing the sampling frequency with linear interpolation&quot;</font>
  <font color="blue">extends </font><A HREF="Modelica_LinearSystems2_Controller_Interfaces.html#Modelica_LinearSystems2.Controller.Interfaces.PartialBlockIcon"
>Interfaces.PartialBlockIcon</A>;
  <font color="blue">parameter </font>Integer inputSampleFactor(min=1)=1 <font color="darkgreen">
    &quot;Input sample time = inputSampleFactor * sampleClock.sampleTime&quot;</font>;
  <font color="blue">parameter </font>Integer outputSampleFactor(min=1)=1 <font color="darkgreen">
    &quot;</pre>Output sample time = outputSampleFactor * sampleClock.sampleTime<br>(inputSampleFactor must be an integer multiple of outputSampleFactor)<pre>&quot;</font>;
<textblock type="annotcomp" expanded="false">  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> u <font color="darkgreen">
    &quot;Continuous or discrete input signal of block&quot;</font>;
  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> y <font color="darkgreen">
    &quot;Continuous or discrete output signal of block&quot;</font>;</textblock>
<font color="blue">protected </font>
  Integer inputOutputSampleFactor =<font color="red"> div</font>(inputSampleFactor,outputSampleFactor);
  <font color="blue">outer </font><A HREF="Modelica_LinearSystems2_Controller.html#Modelica_LinearSystems2.Controller.SampleClock"
>SampleClock</A> sampleClock <font color="darkgreen">&quot;Global options&quot;</font>;
  Boolean outputSampleTrigger <font color="darkgreen">&quot;= true, if output sample time&quot;</font>;
  Integer outputTicks(start=0, fixed=true);
  Integer ticks(start=1, fixed=true);
  Real pre_u;
  Boolean sampleIn;
<font color="blue">equation </font>
  <font color="red">assert</font>(<font color="red">rem</font>(inputSampleFactor,outputSampleFactor) == 0,
         &quot;... Wrong parameters provided to model Modelica_LinearSystems2.Controller.Interpolator\n&quot; +
         &quot;inputSampleFactor (= &quot; +<font color="red"> String</font>(inputSampleFactor) +
         &quot;) must be an integer multiple of outputSampleFactor (= &quot; +<font color="red"> String</font>(outputSampleFactor) +
         &quot;),\nbut this is not the case&quot;);

  <font color="blue">when </font>sampleClock.sampleTrigger<font color="blue"> then</font>
      outputTicks = <font color="blue">if </font><font color="red">pre</font>(outputTicks) &lt; outputSampleFactor<font color="blue"> then </font><font color="red">pre</font>(outputTicks) + 1<font color="blue"> else </font>1;
  <font color="blue">end when</font>;
  outputSampleTrigger = sampleClock.sampleTrigger<font color="blue"> and </font>outputTicks &gt;= outputSampleFactor;

  <font color="blue">when </font>outputSampleTrigger<font color="blue"> then</font>
     ticks = <font color="blue">if </font><font color="red">pre</font>(ticks) &lt; inputOutputSampleFactor<font color="blue"> then </font><font color="red">pre</font>(ticks) + 1<font color="blue"> else </font>1;
     sampleIn = ticks == 1;
     y = <font color="blue">if </font>ticks == 1<font color="blue"> then </font>(u -<font color="red"> pre</font>(u))/inputOutputSampleFactor +<font color="red"> pre</font>(u)<font color="blue"> else </font>
                             <font color="red">pre</font>(pre_u) + ticks/inputOutputSampleFactor*(<font color="red">pre</font>(u) -<font color="red"> pre</font>(pre_u));
  <font color="blue">end when</font>;

  <font color="blue">when </font>{<font color="red">initial</font>(), sampleIn}<font color="blue"> then</font>
      pre_u =<font color="red"> pre</font>(u);
  <font color="blue">end when</font>;

<font color="blue">initial </font><font color="blue">equation </font>
  u =<font color="red"> pre</font>(u);
  pre_u =<font color="red"> pre</font>(pre_u);
  u = y;

<textblock type="annotcomp" expanded="false"><font color="blue">end </font>DiscreteInterpolator;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE FIR_coefficients<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.Controller.Internal.FIR_coefficients"></A><A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal"
>Modelica_LinearSystems2.Controller.Internal</A>.FIR_coefficients</H2>
<B>Calculates the FIR-filter coefficient vector</B><p>
<P><H3>Information</H3></P>
<PRE></pre>
<p>
The FIR-filter synthesis based on the window method. The coefficients are
calculated through a fourier series approximation of the desired amplitude
characteristic. Due to the fact that the Fourier series is truncated, there
will be discontinuities in the magnitude of the filter. Especial at the edge
of the filter the ripple is concentrated (Gibbs-effect). To counteract this,
the filter coefficients are convolved in the frequency domain with the spectrum
of a window function, thus smoothing the edge transitions at any discontinuity.
This convolution in the frequency domain is equivalent to multiplying the filter
coefficients with the window coefficients in the time domain.
</p>
<p>
The filter equation
<pre>
     y(k) = a0*u(k) + a1*u(k-1) + a2*u(k-2) + ... + an*u(k-n)
</pre>
implies that the function outputs n+1 coefficients for a n-th order filter. The
coefficients can be weightened with different kind of windows: Rectangle, Bartlett,
Hann, Hamming, Blackman, Kaiser <br>
The beta parameter is only needed by the Kaiser window.
</p>
<pre>
</PRE><P>

<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Controller_Types.html#Modelica_LinearSystems2.Controller.Types.FIRspec"
>FIRspec</A></TD><TD>specType</TD><TD>Modelica_LinearSystems2.Cont...</TD><TD>Specification type of FIR filter</TD></TR>
<TR><TD>Integer</TD><TD>L</TD><TD>2</TD><TD>Length of mean value filter</TD></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Types.html#Modelica_LinearSystems2.Types.FilterType"
>FilterType</A></TD><TD>filterType</TD><TD>Modelica_LinearSystems2.Type...</TD><TD>Type of filter</TD></TR>
<TR><TD>Integer</TD><TD>order</TD><TD>2</TD><TD>Order of filter</TD></TR>
<TR><TD><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Frequency"
>Frequency</A></TD><TD>f_cut</TD><TD>1</TD><TD>Cut-off frequency [Hz]</TD></TR>
<TR><TD><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>Ts</TD><TD>&nbsp;</TD><TD>Sampling time [s]</TD></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Controller_Types.html#Modelica_LinearSystems2.Controller.Types.Window"
>Window</A></TD><TD>window</TD><TD>Modelica_LinearSystems2.Cont...</TD><TD>Type of window</TD></TR>
<TR><TD>Real</TD><TD>beta</TD><TD>2.12</TD><TD>Beta-Parameter for Kaiser-window</TD></TR>
<TR><TD>Real</TD><TD>a_desired[:]</TD><TD>{1,1}</TD><TD>FIR filter coefficients</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>a[if specType == FIRspec.MeanValue then L else (if specType == FIRspec.Window then if mod(order, 2) &gt; 0 and filterType == FilterType.HighPass then order + 2 else order + 1 else size(a_desired, 1))]</TD><TD>Filter coefficients</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">function</font> FIR_coefficients <font color="darkgreen">
  &quot;Calculates the FIR-filter coefficient vector&quot;</font>
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Types.html#Modelica_LinearSystems2.Types.FilterType"
>Modelica_LinearSystems2.Types.FilterType</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Controller_Types.html#Modelica_LinearSystems2.Controller.Types.FIRspec"
>Modelica_LinearSystems2.Controller.Types.FIRspec</A>;

  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Controller_Types.html#Modelica_LinearSystems2.Controller.Types.FIRspec"
>FIRspec</A> specType=Modelica_LinearSystems2.Controller.Types.FIRspec.MeanValue <font color="darkgreen">
    &quot;Specification type of FIR filter&quot;</font>;
  <font color="blue">input </font>Integer L(min=2) = 2 <font color="darkgreen">&quot;Length of mean value filter&quot;</font>;
  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Types.html#Modelica_LinearSystems2.Types.FilterType"
>Modelica_LinearSystems2.Types.FilterType</A> filterType=
      Modelica_LinearSystems2.Types.FilterType.LowPass <font color="darkgreen">&quot;Type of filter&quot;</font>;
  <font color="blue">input </font>Integer order(min=1) = 2 <font color="darkgreen">&quot;Order of filter&quot;</font>;
  <font color="blue">input </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Frequency"
>Modelica.SIunits.Frequency</A> f_cut=1 <font color="darkgreen">&quot;Cut-off frequency&quot;</font>;
  <font color="blue">input </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> Ts(min=0) <font color="darkgreen">&quot;Sampling time&quot;</font>;
  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Controller_Types.html#Modelica_LinearSystems2.Controller.Types.Window"
>Types.Window</A> window=Modelica_LinearSystems2.Controller.Types.Window.Rectangle <font color="darkgreen">
    &quot;Type of window&quot;</font>;
  <font color="blue">input </font>Real beta=2.12 <font color="darkgreen">&quot;Beta-Parameter for Kaiser-window&quot;</font>;
  <font color="blue">input </font>Real a_desired[:]={1,1} <font color="darkgreen">&quot;FIR filter coefficients&quot;</font>;
  <font color="blue">output </font>Real a[<font color="blue">if </font>specType==FIRspec.MeanValue<font color="blue"> then </font>L<font color="blue"> else </font>
                     (<font color="blue">if </font>specType == FIRspec.Window<font color="blue"> then </font><font color="blue">if </font><font color="red">mod</font>(order,2)&gt;0<font color="blue"> and </font>filterType == FilterType.HighPass<font color="blue"> then </font>order+2<font color="blue"> else </font>order+1<font color="blue"> else </font>
                     <font color="red">size</font>(a_desired,1))] <font color="darkgreen">&quot;Filter coefficients&quot;</font>;

<font color="blue">protected </font>
  <font color="blue">constant </font>Real pi=Modelica.Constants.pi;
  Boolean isEven=<font color="red">mod</font>(order,2)==0;
  Integer order2 = <font color="blue">if </font><font color="blue">not </font>isEven<font color="blue"> and </font>filterType == FilterType.HighPass<font color="blue"> then </font>order+1<font color="blue"> else </font>order;
  Real Wc=2*pi*f_cut*Ts;
  Integer i;
  Real w[order2 + 1];
  Real k;
<font color="blue">algorithm </font>
<font color="red">assert</font>(f_cut&lt;=1/(2*Ts),&quot;The cut-off frequency f_cut may not be greater than half the sample frequency (Nyquist frequency), i.e. f_cut &lt;= &quot; +<font color="red"> String</font>(1/(2*Ts)) + &quot; but is &quot;+<font color="red">String</font>(f_cut));
  <font color="blue">if </font>specType == FIRspec.MeanValue<font color="blue"> then</font>
     a :=<font color="red"> fill</font>(1/L, L);
  <font color="blue">elseif </font>specType == FIRspec.Window<font color="blue"> then</font>
     w :=<font color="red"> Internal.FIR_window</font>(order2 + 1, window, beta);
     <font color="blue">for </font>i<font color="blue"> in </font>1:order2 + 1<font color="blue"> loop</font>
       k := i - 1 - order2/2;
       <font color="blue">if </font>i - 1 == order2/2<font color="blue"> then</font>
         a[i] := <font color="blue">if </font>filterType == FilterType.LowPass<font color="blue"> then </font>Wc*w[i]/pi<font color="blue"> else </font>
                 w[i] - Wc*w[i]/pi;
       <font color="blue">else</font>
         a[i] := <font color="blue">if </font>filterType == FilterType.LowPass<font color="blue"> then </font><font color="red">sin</font>(k*Wc)*
           w[i]/(k*pi)<font color="blue"> else </font>w[i]*(<font color="red">sin</font>(k*pi) -<font color="red"> sin</font>(k*Wc))/(k*pi);
       <font color="blue">end if</font>;
     <font color="blue">end for</font>;
  <font color="blue">else</font>
     a := a_desired;
       <font color="blue">end if</font>;
       <font color="blue">if </font><font color="blue">not </font>isEven<font color="blue"> and </font>filterType == FilterType.HighPass<font color="blue"> then</font>
    <font color="red">     Modelica.Utilities.Streams.print</font>(&quot;The requested order of the FIR filter in FIR_coefficients is odd and has been increased by one to get an even order filter\n&quot;);
       <font color="blue">end if</font>;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>FIR_coefficients;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE FIR_window<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.Controller.Internal.FIR_window"></A><A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal"
>Modelica_LinearSystems2.Controller.Internal</A>.FIR_window</H2>
<B>Calculation of n-point weighting window for FIR filter</B><p>
<P><H3>Information</H3></P>
<PRE></pre>
<p>
Weighting windows are used for digital filter design or spectrum estimation (e.g. DFT)
to increase the quality. In designing FIR-Filter the main role of windowing is to remove
non-ideal effects caused by the endless number of filter coefficients (Gibbs phenomenon).
Multiplying the coefficients with a window damps the coefficients at the beginning and at
the end.
</p>
<p>
The function outputs a L-point vector for a given kind of window. The parameter "beta" is
only needed by the Kaiser window. The types of windows are:
</p>
<OL>
<LI>Rectangle</LI>
<LI>Bartlett</LI>
<LI>Hann</LI>
<LI>Hamming</LI>
<LI>Blackman</LI>
<LI>Kaiser</LI>
</OL>
<pre>
</PRE><P>

<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Integer</TD><TD>L</TD><TD>&nbsp;</TD><TD>Number of Points</TD></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Controller_Types.html#Modelica_LinearSystems2.Controller.Types.Window"
>Window</A></TD><TD>window</TD><TD>&nbsp;</TD><TD>Type of window</TD></TR>
<TR><TD>Real</TD><TD>beta</TD><TD>2.12</TD><TD>Beta-Parameter for Kaiser-window</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>a[L]</TD><TD>output vector</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">function</font> FIR_window <font color="darkgreen">
  &quot;Calculation of n-point weighting window for FIR filter&quot;</font>

  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Controller_Types.html#Modelica_LinearSystems2.Controller.Types.Window"
>Modelica_LinearSystems2.Controller.Types.Window</A>;
  <font color="blue">input </font>Integer L <font color="darkgreen">&quot;Number of Points&quot;</font>;
  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Controller_Types.html#Modelica_LinearSystems2.Controller.Types.Window"
>Window</A> window <font color="darkgreen">&quot;Type of window&quot;</font>;
  <font color="blue">input </font>Real beta=2.12 <font color="darkgreen">&quot;Beta-Parameter for Kaiser-window&quot;</font>;
  <font color="blue">output </font>Real a[L] <font color="darkgreen">&quot;output vector&quot;</font>;
<font color="blue">protected </font>
  Integer i=0;
  <font color="blue">constant </font>Real pi=Modelica.Constants.pi;
  Real k;
<font color="blue">algorithm </font>
  <font color="blue">if </font>window &lt;&gt; Window.Rectangle<font color="blue"> then</font>
    <font color="blue">for </font>i<font color="blue"> in </font>1:L<font color="blue"> loop</font>
      k := i - 1 - (L - 1)/2;
      <font color="blue">if </font>window == Window.Bartlett<font color="blue"> then</font>
        a[i] := 1 - 2*<font color="red">abs</font>(k)/(L - 1);
      <font color="blue">elseif </font>window == Window.Hann<font color="blue"> then</font>
        a[i] := 0.5 + 0.5*<font color="red">cos</font>(2*pi*k/(L - 1));
      <font color="blue">elseif </font>window == Window.Hamming<font color="blue"> then</font>
        a[i] := 0.54 + 0.46*<font color="red">cos</font>(2*pi*k/(L - 1));
      <font color="blue">elseif </font>window == Window.Blackman<font color="blue"> then</font>
        a[i] := 0.42 + 0.5*<font color="red">cos</font>(2*pi*k/(L - 1)) + 0.08*<font color="red">cos</font>(4*pi*k/(L - 1));
      <font color="blue">elseif </font>window == Window.Kaiser<font color="blue"> then</font>
        k := 2*beta*<font color="red">sqrt</font>((i - 1)*(L - i))/(L - 1);
        a[i] :=<font color="red"> Internal.bessel0</font>(k)/<font color="red"> Internal.bessel0</font>(beta);
      <font color="blue">else</font>
        <font color="red">Modelica.Utilities.Streams.error</font>(&quot;window = &quot; +<font color="red"> String</font>(window) + &quot; not known&quot;);
      <font color="blue">end if</font>;
    <font color="blue">end for</font>;
  <font color="blue">else</font>
    a :=<font color="red"> ones</font>(L);
  <font color="blue">end if</font>;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>FIR_window;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE random<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.Controller.Internal.random"></A><A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal"
>Modelica_LinearSystems2.Controller.Internal</A>.random</H2>
<B>Pseudo random number generator</B><p>
<P><H3>Information</H3></P>
<PRE></pre>
<p>
<i>Random</i> generates a sequence of uniform distributed
pseudo-random numbers. The algorithm is a variant of the
multiplicative congruential algorithm, known as the
Wichmann-Hill generator:
<pre>    x(k) = (a1*x(k-1)) mod m1
    y(k) = (a2*y(k-1)) mod m2
    z(k) = (a3*z(k-1)) mod m3
    U(k) = (x(k)/m1 + y(k)/m2 + z(k)/m3) mod 1
</pre>
This generates pseudo-random numbers U(k) uniformly distributed
in the interval (0,1). There are many forms of generators depending
on the parameters m (prime numbers) and a. The sequence needs an
initial Integer vector {x,y,z} known as the seed. The use of the same
seed will lead to the same sequence of numbers. 
</p>
<p>
<b>Remarks</b>
</p>
<p>Random number generators (RNG) are pseudo-functions which are not true
functions but algorithms which deliver a fixed sequence of (usually Integer) numbers
which should have a very large period before they repeat itself and
appropriate statistic properties such that the sequence appears to be
a random draw. For real-valued random numbers, the integers are scaled to
the real interval 0.0-1.0. They result in a uniformly distributed random variate
between 0-1, which has to be tranformed to give a random variate of a wanted
distribution. There are two types of techniques for transforming random variates:
</p>
<ul>
<li>Acceptance-Rejection techniques</li>
<li>Transformation techniques</li>
</ul>
<p>Acceptance-Rejection techniques throw away some of the generated variates and are thus less efficient. They can not be avoided for all distributions. A good summary about random number generation and most of the transformation techniques used below is given in:</p>
 <address> Discrete Event Simulation <br>
 Jerry Banks and John S. Carson II<br>
 Prentice Hall Inc.<br>
 Englewood Cliffs, New Jersey<br>
 </address>
<p>Some of the other references are quoted below.</p>
<pre>
        WICHMANN-HILL RANDOM NUMBER GENERATOR
        Wichmann, B. A. & Hill, I. D. (1982)
          Algorithm AS 183:
          An efficient and portable pseudo-random number generator
          Applied Statistics 31 (1982) 188-190
        see also:
          Correction to Algorithm AS 183
          Applied Statistics 33 (1984) 123
        McLeod, A. I. (1985)
          A remark on Algorithm AS 183
          Applied Statistics 34 (1985),198-200
        In order to completely avoid external functions, all seeds are
        set via parameters. For simulation purposes this is almost
        always the desired behaviour.
        Translated by Hubertus Tummescheit from Python source provided by
        Guido van Rossum translated from C source by Adrian Baddeley.
        http://www.python.org/doc/current/lib/module-random.html
        R A N D O M   V A R I A B L E   G E N E R A T O R S
        distributions on the real line:
        ------------------------------
            normal (Gaussian) 2 versions
</pre>
<h4>Reference Literature:</h4>
<ul>
<li>function random: Wichmann, B. A. & Hill, I. D. (1982), Algorithm AS 183:
  <br>
  An efficient and portable pseudo-random number generator, Applied Statistics 31 (1982) 188-190<br>
  see also: Correction to Algorithm AS 183, Applied Statistics 33 (1984) 123 <br>
  McLeod, A. I. (1985), A remark on Algorithm AS 183, Applied Statistics 34 (1985),198-200</li>
<li>function normalvariate: Kinderman, A.J. and Monahan, J.F., 'Computer generation of random
  variables using the ratio of uniform deviates', ACM Trans Math Software, 3, (1977),
  pp257-260.</li>
<li>function gaussianvariate: Discrete Event Simulation, Jerry Banks and John S. Carson II,
<br>
  Prentice Hall Inc. Englewood Cliffs, New Jersey, page 315/316</li>
</ul>
<p>
Copyright &copy; Hubertus Tummescheit and Department of Automatic Control, Lund University, Sweden.
</p>
<p>
<i>This Modelica function is <b>free</b> software; it can be redistributed and/or modified
under the terms of the <b>Modelica license</b>, see the license conditions
and the accompanying <b>disclaimer</b> 
<a href="Modelica://Modelica.UsersGuide.ModelicaLicense">here</a>.</i>
</p>
<pre>
</PRE><P>

<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Integer</TD><TD>seedIn[3]</TD><TD>&nbsp;</TD><TD>Integer vector defining random number sequence, e.g., {23,87,187}</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>x</TD><TD>Random number between 0 and 1</TD></TR>
<TR><TD>Integer</TD><TD>seedOut[3]</TD><TD>Modified seed to be used for next call of random()</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">function</font> random <font color="darkgreen">&quot;Pseudo random number generator&quot;</font>

<textblock type="annotcomp" expanded="false">  <font color="blue">input </font>Integer seedIn[3] <font color="darkgreen">
    &quot;Integer vector defining random number sequence, e.g., {23,87,187}&quot;</font>;</textblock>
  <font color="blue">output </font>Real x <font color="darkgreen">&quot;Random number between 0 and 1&quot;</font>;
<textblock type="annotcomp" expanded="false">  <font color="blue">output </font>Integer seedOut[3] <font color="darkgreen">
    &quot;Modified seed to be used for next call of random()&quot;</font>;</textblock>
<font color="blue">algorithm </font>
  seedOut[1] :=<font color="red"> rem</font>((171*seedIn[1]), 30269);
  seedOut[2] :=<font color="red"> rem</font>((172*seedIn[2]), 30307);
  seedOut[3] :=<font color="red"> rem</font>((170*seedIn[3]), 30323);
  <font color="darkgreen">// zero is a poor seed, therfore substitute 1;</font>
  <font color="blue">if </font>seedOut[1] == 0<font color="blue"> then</font>
    seedOut[1] := 1;
  <font color="blue">end if</font>;
  <font color="blue">if </font>seedOut[2] == 0<font color="blue"> then</font>
    seedOut[2] := 1;
  <font color="blue">end if</font>;
  <font color="blue">if </font>seedOut[3] == 0<font color="blue"> then</font>
    seedOut[3] := 1;
  <font color="blue">end if</font>;
  x :=<font color="red"> rem</font>((seedOut[1]/30269.0 + seedOut[2]/30307.0 + seedOut[3]/30323.0), 1.0);
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>random;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE scaleFactor1<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.Controller.Internal.scaleFactor1"></A><A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal"
>Modelica_LinearSystems2.Controller.Internal</A>.scaleFactor1</H2>
<B>Return scale factor for first order block</B><p>
<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>n</TD><TD>&nbsp;</TD><TD>(s+n)/(s+d)</TD></TR>
<TR><TD>Real</TD><TD>d</TD><TD>&nbsp;</TD><TD>(s+n)/(s+d)</TD></TR>
<TR><TD>Real</TD><TD>small</TD><TD>100*Modelica.Constants.eps</TD><TD>&nbsp;</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>k</TD><TD>= d/n, if d,n are not zero, otherwise special cases</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">function</font> scaleFactor1 <font color="darkgreen">&quot;Return scale factor for first order block&quot;</font>

  <font color="blue">input </font>Real n <font color="darkgreen">&quot;(s+n)/(s+d)&quot;</font>;
  <font color="blue">input </font>Real d <font color="darkgreen">&quot;(s+n)/(s+d)&quot;</font>;
  <font color="blue">input </font>Real small=100*Modelica.Constants.eps;
  <font color="blue">output </font>Real k <font color="darkgreen">&quot;= d/n, if d,n are not zero, otherwise special cases&quot;</font>;
<font color="blue">algorithm </font>
  k :=(<font color="blue">if </font><font color="red">abs</font>(d) &gt; small<font color="blue"> then </font><font color="red">abs</font>(d)<font color="blue"> else </font>1)/(<font color="blue">if </font><font color="red">abs</font>(n) &gt; small<font color="blue"> then </font><font color="red">abs</font>(n)<font color="blue"> else </font>
          1);
<font color="blue">end </font>scaleFactor1;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE scaleFactor2<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.Controller.Internal.scaleFactor2"></A><A HREF="Modelica_LinearSystems2_Controller_Internal.html#Modelica_LinearSystems2.Controller.Internal"
>Modelica_LinearSystems2.Controller.Internal</A>.scaleFactor2</H2>
<B>Return scale factor for second order block</B><p>
<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>n1</TD><TD>&nbsp;</TD><TD>(s^2 + n1*s + n2)/(s^2 + d1*s + d2)</TD></TR>
<TR><TD>Real</TD><TD>n2</TD><TD>&nbsp;</TD><TD>(s^2 + n1*s + n2)/(s^2 + d1*s + d2)</TD></TR>
<TR><TD>Real</TD><TD>d1</TD><TD>&nbsp;</TD><TD>(s^2 + n1*s + n2)/(s^2 + d1*s + d2)</TD></TR>
<TR><TD>Real</TD><TD>d2</TD><TD>&nbsp;</TD><TD>(s^2 + n1*s + n2)/(s^2 + d1*s + d2)</TD></TR>
<TR><TD>Real</TD><TD>small</TD><TD>100*Modelica.Constants.eps</TD><TD>&nbsp;</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>k</TD><TD>= d2/n2, if d2,n2 are not zero, otherwise special cases</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">function</font> scaleFactor2 <font color="darkgreen">&quot;Return scale factor for second order block&quot;</font>

  <font color="blue">input </font>Real n1 <font color="darkgreen">&quot;(s^2 + n1*s + n2)/(s^2 + d1*s + d2)&quot;</font>;
  <font color="blue">input </font>Real n2 <font color="darkgreen">&quot;(s^2 + n1*s + n2)/(s^2 + d1*s + d2)&quot;</font>;
  <font color="blue">input </font>Real d1 <font color="darkgreen">&quot;(s^2 + n1*s + n2)/(s^2 + d1*s + d2)&quot;</font>;
  <font color="blue">input </font>Real d2 <font color="darkgreen">&quot;(s^2 + n1*s + n2)/(s^2 + d1*s + d2)&quot;</font>;
  <font color="blue">input </font>Real small=100*Modelica.Constants.eps;
  <font color="blue">output </font>Real k <font color="darkgreen">&quot;= d2/n2, if d2,n2 are not zero, otherwise special cases&quot;</font>;
<font color="blue">algorithm </font>
  k :=(<font color="blue">if </font><font color="red">abs</font>(d2) &gt; small<font color="blue"> then </font><font color="red">abs</font>(d2)<font color="blue"> else </font>(<font color="blue">if </font><font color="red">abs</font>(d1) &gt; small<font color="blue"> then </font><font color="red">abs</font>(d1)<font color="blue"> else </font>1)) /
      (<font color="blue">if </font><font color="red">abs</font>(n2) &gt; small<font color="blue"> then </font><font color="red">abs</font>(n2)<font color="blue"> else </font>(<font color="blue">if </font><font color="red">abs</font>(n1) &gt; small<font color="blue"> then </font><font color="red">abs</font>(n1)<font color="blue"> else </font>1));
<font color="blue">end </font>scaleFactor2;
</PRE>
<HR>
<address>HTML-documentation generated by <a href="http://www.Dymola.com/">Dymola</a> Fri Jan 15 12:28:51 2010.
</address></BODY>
</HTML>
