<HTML>
<HEAD>
<TITLE>Modelica_LinearSystems2.Math</TITLE>
<META name="HTML-Generator" content="Dymola">
<META name="description" content="&quot;Additional functions for Modelica.Math&quot;">
<style type="text/css">
*       { font-size: 10pt; font-family: Arial,sans-serif; }
pre     { font-size:  9pt; font-family: Courier,monospace;}
h4      { font-size: 10pt; font-weight: bold; color: green; }
h3      { font-size: 11pt; font-weight: bold; color: green; }
h2      { font-size: 13pt; font-weight: bold; color: green; }
address {                  font-weight: normal} 
td      { solid #000; vertical-align:top; }
th      { solid #000; vertical-align:top; font-weight: bold; }
table   { solid #000; border-collapse: collapse;}
</style>
</HEAD>
<BODY><P>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Math<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.Math"></A><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>.Math</H2>
<B>Additional functions for Modelica.Math</B>
<P>
<P><H3>Information</H3></P>
Extends from <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Icons_Library.html#Modelica.Icons.Library"
>Modelica.Icons.Library</A> (Icon for library).
<P><H3>Package Content</H3><p>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2 >
<TR><TH >Name</TH><TH>Description</TH></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Math.ComplexS.png" ALT="Modelica_LinearSystems2.Math.Complex" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A>
</TD><TD>Record defining a Complex number</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Math.ComplexS.png" ALT="Modelica_LinearSystems2.Math.Polynomial" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A>
</TD><TD>Record defining the data for a polynomial</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Math.MatricesS.png" ALT="Modelica_LinearSystems2.Math.Matrices" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Math_Matrices.html#Modelica_LinearSystems2.Math.Matrices"
>Matrices</A>
</TD><TD>Additional functions for Modelica.Math</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.Math.MatricesS.png" ALT="Modelica_LinearSystems2.Math.Vectors" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_Math_Vectors.html#Modelica_LinearSystems2.Math.Vectors"
>Vectors</A>
</TD><TD>Functions operating on vectors</TD></TR>
</TABLE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Complex<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_LinearSystems2.Math.ComplexI.png" ALT="Modelica_LinearSystems2.Math.Complex" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_LinearSystems2.Math.Complex"></A><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math"
>Modelica_LinearSystems2.Math</A>.Complex</H2>
<B>Record defining a Complex number</B><p>
<P><H3>Information</H3></P>
<PRE></pre>
<p>
This record defines a complex number consisting of a real
and an imaginary part. Additionally, various utility functions
are provided in the record to operate on instances of this record.
Example (note: "j" in the comments is defined as j=sqrt(-1)):
</p>
<pre>
   <b>import</b> Modelica.Utilities.Streams;
   <b>import</b> Modelica_LinearSystems2.Math.Complex;
   Complex c1=Complex(re=2, im=3) "= 2 + 3j";
   Complex c2=Complex(3,4) "= 3 + 4j";
 <b>algorithm</b>
   c3 := Complex.'+'(c1, c2) "= c1 + c2";
   Streams.print("c3 = " + Complex.'String'(c3));
   Streams.print("c3 = " + Complex.'String'(c3,"i"));
   // This gives the following print-out:
   c3 = 5 + 7j
   c3 = 5 + 7i
</pre>
<p>
The utility functions are written in such a way that it
is convenient to work with them, once operator overloading
is provided in Modelica and Modelica tools. Example:
</p>
<pre>
   // Assume operator overloading is available (this is not yet the case):
   Complex j  = Complex.j();
   Complex c4 = -2 + 5*j;
   // A Modelica tool will transform the statement of c4 into
   Complex c4 = Complex.'+'( Complex.(-2,0), Complex.'*'(Complex(5,0),j)));
</pre>
<p>
The utility functions are implemented so that they can be easily
inlined by a tool. In such a case, the above statement will
not lead to any overhead.
</p>
<pre></PRE><P>
Extends from <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Icons.html#Modelica.Icons.Record"
>Modelica.Icons.Record</A> (Icon for a record).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>re</TD><TD>&nbsp;</TD><TD>Real part of complex number</TD></TR>
<TR><TD>Real</TD><TD>im</TD><TD>&nbsp;</TD><TD>Imaginary part of complex number</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">record</font> Complex <font color="darkgreen">&quot;Record defining a Complex number&quot;</font>
  <font color="blue">extends </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Icons.html#Modelica.Icons.Record"
>Modelica.Icons.Record</A>;
  Real re <font color="darkgreen">&quot;Real part of complex number&quot;</font>;
  Real im <font color="darkgreen">&quot;Imaginary part of complex number&quot;</font>;

 <textblock type="packagesmall" expanded="false" path="Modelica_LinearSystems2.Math.Complex.Examples"><font color="blue">encapsulated </font><font color="blue">package</font> Examples <font color="darkgreen">
    &quot;Library demonstrating the usage of complex numbers&quot;</font>

    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
    <font color="blue">extends </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Icons_Library.html#Modelica.Icons.Library"
>Modelica.Icons.Library</A>;

    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.Examples.addTwoComplexNumbers"><font color="blue">function</font> addTwoComplexNumbers <font color="darkgreen">&quot;Show how to add 2 complex number&quot;</font>
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Utilities_Streams.html#Modelica.Utilities.Streams"
>Modelica.Utilities.Streams</A>;

      <font color="blue">output </font>Boolean ok;
    <font color="blue">protected </font>
      <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> j = <font color="red">Complex.j</font>();
      <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c1=2+3*j;
      <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c2=3+4*j;
      <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c3;
    <font color="blue">algorithm </font>

      <font color="red">Streams.print</font>(&quot;c1 = &quot; + <font color="red">String</font>(c1));
      <font color="red">Streams.print</font>(&quot;c2 = &quot; + <font color="red">String</font>(c2));

      c3 := c1 + c2;
      <font color="red">Streams.print</font>(&quot;c3 = c1 + c2 = &quot; + <font color="red">String</font>(c3));
      ok := true;
    <font color="blue">end </font>addTwoComplexNumbers</textblock>;

 <font color="blue">end </font>Examples</textblock>;

<textblock type="packagesmall" expanded="false" path="Modelica_LinearSystems2.Math.Complex.Vectors"><font color="blue">encapsulated </font><font color="blue">package</font> Vectors
 <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.Vectors.print"><font color="blue">function</font> print
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Utilities_Streams.html#Modelica.Utilities.Streams.print"
>Modelica.Utilities.Streams.print</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

  <font color="blue">input </font>String name=&quot;&quot; <font color="darkgreen">&quot;Name of complex vector&quot;</font>;
  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c[:] <font color="darkgreen">&quot;Complex vector to be printed&quot;</font>;

  <font color="blue">input </font>String fileName=&quot;&quot; <font color="darkgreen">
        &quot;Print to fileName; empty fileName prints to the log window&quot;</font>;

 <font color="blue">algorithm </font>
  <font color="red">print</font>(name + &quot; =&quot;, fileName);
  <font color="blue">for </font>i<font color="blue"> in </font>1:<font color="red">size</font>(c, 1)<font color="blue"> loop</font>
     <font color="red">print</font>(&quot;   &quot; +<font color="red"> String</font>(c[i]), fileName);
  <font color="blue">end for</font>;
 <font color="blue">end </font>print</textblock>;

<textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.Vectors.length"><font color="blue">function</font> length <font color="darkgreen">&quot;Return length of a complex vector&quot;</font>
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> v[:] <font color="darkgreen">&quot;Vector&quot;</font>;
  <font color="blue">output </font>Real result <font color="darkgreen">&quot;Length of vector v&quot;</font>;

<font color="blue">algorithm </font>
  result :=<font color="red"> sqrt</font>(<font color="red">sum</font>(v[i].re^2 + v[i].im^2 <font color="blue">for </font>i<font color="blue"> in </font>1:<font color="red">size</font>(v,1)));
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>length</textblock>;

<textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.Vectors.norm"><font color="blue">function</font> norm <font color="darkgreen">&quot;Returns the norm of a complex vector&quot;</font>
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> v[:] <font color="darkgreen">&quot;Vector&quot;</font>;
  <font color="blue">input </font>Real p(min=1) = 2 <font color="darkgreen">
        &quot;Type of p-norm (often used: 1, 2, or Modelica.Constants.inf)&quot;</font>;
  <font color="blue">output </font>Real result <font color="darkgreen">&quot;p-norm of vector v&quot;</font>;

<font color="blue">algorithm </font>
  <font color="blue">if </font>p == 2<font color="blue"> then</font>
    result:=<font color="red"> sqrt</font>(<font color="red">sum</font>(v[i].re^2 + v[i].im^2 <font color="blue">for </font>i<font color="blue"> in </font>1:<font color="red">size</font>(v,1)));
  <font color="blue">elseif </font>p == Modelica.Constants.inf<font color="blue"> then</font>
    result:=<font color="red"> Complex.&#39;max&#39;</font>(v);
  <font color="blue">elseif </font>p == 1<font color="blue"> then</font>
    result:=<font color="red"> sum</font>(<font color="red">Complex.&#39;abs&#39;</font>(v[i]) <font color="blue">for </font>i<font color="blue"> in </font>1:<font color="red">size</font>(v,1));
  <font color="blue">else</font>
    result:=(<font color="red">sum</font>(<font color="red">Complex.&#39;abs&#39;</font>(v[i])^p <font color="blue">for </font>i<font color="blue"> in </font>1:<font color="red">size</font>(v, 1)))^(1/p);
  <font color="blue">end if</font>;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>norm</textblock>;

<textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.Vectors.normalize"><font color="blue">function</font> normalize <font color="darkgreen">
      &quot;Return normalized complex vector such that length = 1 and prevent zero-division for zero vector&quot;</font>
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> v[:] <font color="darkgreen">&quot;Vector&quot;</font>;
  <font color="blue">input </font>Real eps = 100*Modelica.Constants.eps <font color="darkgreen">&quot;if |v| &lt; eps then result = v&quot;</font>;
  <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> result[<font color="red">size</font>(v, 1)] <font color="darkgreen">&quot;Input vector v normalized to length=1&quot;</font>;

    <font color="blue">protected </font>
  Real length_v =<font color="red"> Complex.Vectors.length</font>(v);
  <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> j =<font color="red"> Complex.j</font>();
<font color="blue">algorithm </font>
  <font color="blue">if </font>length_v &gt;= eps<font color="blue"> then</font>
     <font color="blue">for </font>i<font color="blue"> in </font>1:<font color="red">size</font>(v,1)<font color="blue"> loop</font>
         result[i] :=v[i].re/length_v + (v[i].im/length_v)*j;
     <font color="blue">end for</font>;
  <font color="blue">else</font>
     result :=v;
  <font color="blue">end if</font>;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>normalize</textblock>;

<textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.Vectors.sortComplex"><font color="blue">function</font> sortComplex <font color="darkgreen">&quot;Sort elements of complex vector&quot;</font>
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> v[:] <font color="darkgreen">&quot;Vector to be sorted&quot;</font>;
  <font color="blue">input </font>Boolean ascending = true <font color="darkgreen">
        &quot;= true if ascending order, otherwise descending order&quot;</font>;
  <font color="blue">input </font>Boolean sortFrequency=true <font color="darkgreen">
        &quot;= true, if sorting is first for imaginary then for real value; = false, if sorting is for absolute value&quot;</font>;
  <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> sorted_v[<font color="red">size</font>(v,1)] = v <font color="darkgreen">&quot;Sorted vector&quot;</font>;
  <font color="blue">output </font>Integer indices[<font color="red">size</font>(v,1)] = 1:<font color="red">size</font>(v,1) <font color="darkgreen">&quot;sorted_v = v[indices]&quot;</font>;

  <font color="darkgreen">/* shellsort algorithm; should be improved later */</font>
    <font color="blue">protected </font>
  Integer gap;
  Integer i;
  Integer j;
  <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> wv;
  Integer wi;
  Integer nv =<font color="red"> size</font>(v,1);
  Boolean swap;
  Integer k1;
  Integer k2;
<font color="blue">algorithm </font>
  gap :=<font color="red"> div</font>(nv,2);

  <font color="blue">while </font>gap &gt; 0<font color="blue"> loop</font>
     i := gap;
     <font color="blue">while </font>i &lt; nv<font color="blue"> loop</font>
        j := i-gap;
        <font color="blue">if </font>j&gt;=0<font color="blue"> then</font>
           k1 := j+1;
           k2 := j + gap + 1;
           <font color="blue">if </font>sortFrequency<font color="blue"> then</font>
              <font color="blue">if </font>ascending<font color="blue"> then</font>
                 swap :=<font color="red"> abs</font>(sorted_v[k1].im) &gt;<font color="red">  abs</font>(sorted_v[k2].im)<font color="blue"> or </font>
                         <font color="red">abs</font>(sorted_v[k1].im) ==<font color="red"> abs</font>(sorted_v[k2].im)<font color="blue"> and </font>
                         (sorted_v[k1].re  &gt; sorted_v[k2].re<font color="blue"> or </font>
                          sorted_v[k1].re  == sorted_v[k2].re<font color="blue"> and </font>sorted_v[k1].im &lt; sorted_v[k2].im);
              <font color="blue">else</font>
                 swap :=<font color="red"> abs</font>(sorted_v[k1].im) &lt;<font color="red">  abs</font>(sorted_v[k2].im)<font color="blue"> or </font>
                         <font color="red">abs</font>(sorted_v[k1].im) ==<font color="red"> abs</font>(sorted_v[k2].im)<font color="blue"> and </font>
                         (sorted_v[k1].re  &lt; sorted_v[k2].re<font color="blue"> or </font>
                          sorted_v[k1].re  == sorted_v[k2].re<font color="blue"> and </font>sorted_v[k1].im &lt; sorted_v[k2].im);
              <font color="blue">end if</font>;
           <font color="blue">else</font>
              <font color="blue">if </font>ascending<font color="blue"> then</font>
                 swap :=<font color="red"> Complex.&#39;abs&#39;</font>(sorted_v[k1]) &gt;<font color="red"> Complex.&#39;abs&#39;</font>(sorted_v[k2]);
              <font color="blue">else</font>
                 swap :=<font color="red"> Complex.&#39;abs&#39;</font>(sorted_v[k1]) &lt;<font color="red"> Complex.&#39;abs&#39;</font>(sorted_v[k2]);
              <font color="blue">end if</font>;
           <font color="blue">end if</font>;
        <font color="blue">else</font>
           swap := false;
        <font color="blue">end if</font>;

        <font color="blue">while </font>swap<font color="blue"> loop</font>
           wv := sorted_v[j+1];
           wi := indices[j+1];
           sorted_v[j+1] := sorted_v[j+gap+1];
           sorted_v[j+gap+1] := wv;
           indices[j+1] := indices[j+gap+1];
           indices[j+gap+1] := wi;
           j := j - gap;
           <font color="blue">if </font>j &gt;= 0<font color="blue"> then</font>
              k1 := j+1;
              k2 := j + gap + 1;
              <font color="blue">if </font>sortFrequency<font color="blue"> then</font>
                 <font color="blue">if </font>ascending<font color="blue"> then</font>
                    swap :=<font color="red"> abs</font>(sorted_v[k1].im) &gt;<font color="red">  abs</font>(sorted_v[k2].im)<font color="blue"> or </font>
                            <font color="red">abs</font>(sorted_v[k1].im) ==<font color="red"> abs</font>(sorted_v[k2].im)<font color="blue"> and </font>
                            (sorted_v[k1].re  &gt; sorted_v[k2].re<font color="blue"> or </font>
                             sorted_v[k1].re  == sorted_v[k2].re<font color="blue"> and </font>sorted_v[k1].im &lt; sorted_v[k2].im);
                 <font color="blue">else</font>
                    swap :=<font color="red"> abs</font>(sorted_v[k1].im) &lt;<font color="red">  abs</font>(sorted_v[k2].im)<font color="blue"> or </font>
                            <font color="red">abs</font>(sorted_v[k1].im) ==<font color="red"> abs</font>(sorted_v[k2].im)<font color="blue"> and </font>
                            (sorted_v[k1].re  &lt; sorted_v[k2].re<font color="blue"> or </font>
                             sorted_v[k1].re  == sorted_v[k2].re<font color="blue"> and </font>sorted_v[k1].im &lt; sorted_v[k2].im);
                 <font color="blue">end if</font>;
              <font color="blue">else</font>
                 <font color="blue">if </font>ascending<font color="blue"> then</font>
                    swap :=<font color="red"> Complex.&#39;abs&#39;</font>(sorted_v[k1]) &gt;<font color="red"> Complex.&#39;abs&#39;</font>(sorted_v[k2]);
                 <font color="blue">else</font>
                    swap :=<font color="red"> Complex.&#39;abs&#39;</font>(sorted_v[k1]) &lt;<font color="red"> Complex.&#39;abs&#39;</font>(sorted_v[k2]);
                 <font color="blue">end if</font>;
              <font color="blue">end if</font>;
           <font color="blue">else</font>
              swap := false;
           <font color="blue">end if</font>;
        <font color="blue">end while</font>;
        i := i + 1;
     <font color="blue">end while</font>;
     gap :=<font color="red"> div</font>(gap,2);
  <font color="blue">end while</font>;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>sortComplex</textblock>;

<textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.Vectors.multiply"><font color="blue">function</font> multiply <font color="darkgreen">&quot;scalar product of two complex vectors&quot;</font>
  <font color="blue">extends </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Icons.html#Modelica.Icons.Function"
>Modelica.Icons.Function</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;

  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> v1[:];
  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> v2[<font color="red">size</font>(v1,1)];
  <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> result=<font color="red">Complex</font>(0);

<font color="blue">algorithm </font>
  <font color="blue">for </font>i<font color="blue"> in </font>1:<font color="red">size</font>(v1,1)<font color="blue"> loop</font>
    result := result + v1[i]*v2[i];
  <font color="blue">end for</font>;

<font color="blue">end </font>multiply</textblock>;

    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.Vectors.reverse"><font color="blue">function</font> reverse <font color="darkgreen">
      &quot;Reverse vector elements (e.g. v[1] becomes last element)&quot;</font>
    <font color="blue">extends </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Icons.html#Modelica.Icons.Function"
>Modelica.Icons.Function</A>;

      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> v[:] <font color="darkgreen">&quot;Vector&quot;</font>;
    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> result[<font color="red">size</font>(v, 1)] <font color="darkgreen">&quot;Elements of vector v in reversed order&quot;</font>;

    <font color="blue">algorithm </font>
    result := {v[<font color="blue">end</font>-i+1] <font color="blue">for </font>i<font color="blue"> in </font>1:<font color="red">size</font>(v,1)};
<textblock type="annotcomp" expanded="false">    <font color="blue">end </font>reverse</textblock>;

<font color="blue">end </font>Vectors</textblock>;

<textblock type="packagesmall" expanded="false" path="Modelica_LinearSystems2.Math.Complex.Matrices"><font color="blue">encapsulated </font><font color="blue">package</font> Matrices
    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;

<textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.Matrices.print"><font color="blue">function</font> print <font color="darkgreen">&quot;print matrix&quot;</font>
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A>;
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Utilities_Strings.html#Modelica.Utilities.Strings"
>Modelica.Utilities.Strings</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> M[:,:];
  <font color="blue">input </font>Integer significantDigits=6 <font color="darkgreen">
        &quot;Number of significant digits that are shown&quot;</font>;
  <font color="blue">input </font>String name=&quot;M&quot; <font color="darkgreen">&quot;Independent variable name used for printing&quot;</font>;
  <font color="blue">output </font>String s=&quot;&quot;;
    <font color="blue">protected </font>
  String blanks=<font color="red">Strings.repeat</font>(significantDigits);
  String space=<font color="red">Strings.repeat</font>(8);
  String space2=<font color="red">Strings.repeat</font>(3);
  Integer r=<font color="red">size</font>(M, 1);
  Integer c=<font color="red">size</font>(M, 2);

<font color="blue">algorithm </font>
  <font color="blue">if </font>r == 0<font color="blue"> or </font>c == 0<font color="blue"> then</font>
    s := name + &quot; = []&quot;;
  <font color="blue">else</font>
    s := &quot;\n&quot; + name + &quot; = \n&quot;;
    <font color="blue">for </font>i<font color="blue"> in </font>1:r<font color="blue"> loop</font>
      s := s + space;
      <font color="blue">for </font>j<font color="blue"> in </font>1:c<font color="blue"> loop</font>
        <font color="blue">if </font><font color="red">Complex.&#39;abs&#39;</font>(M[i, j]) &gt;= 0<font color="blue"> then</font>
          s := s + &quot; &quot;;
        <font color="blue">end if</font>;
        s := s +<font color="red"> String</font>(M[i, j], significantDigits=significantDigits) +
          <font color="red">Strings.repeat</font>(significantDigits + 8 -<font color="red"> Strings.length</font>(<font color="red">String</font>(<font color="red">Complex.&#39;abs&#39;</font>(M[i,j]))));

      <font color="blue">end for</font>;
      s := s + &quot;\n&quot;;
    <font color="blue">end for</font>;

  <font color="blue">end if</font>;
<font color="blue">end </font>print</textblock>;

<textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.Matrices.matMatMul"><font color="blue">encapsulated </font><font color="blue">function</font> matMatMul <font color="darkgreen">&quot;Multiply two complex matrices&quot;</font>
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
      <font color="blue">import </font>Re = <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex.real"
>Modelica_LinearSystems2.Math.Complex.real</A>;
      <font color="blue">import </font>Im = <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex.imag"
>Modelica_LinearSystems2.Math.Complex.imag</A>;

  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> m1[:,:] <font color="darkgreen">&quot;Complex matrix 1&quot;</font>;
  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> m2[<font color="red">size</font>(m1, 2),:] <font color="darkgreen">&quot;Complex matrix 2&quot;</font>;
  <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> m3[<font color="red">size</font>(m1, 1),<font color="red">size</font>(m2, 2)] <font color="darkgreen">&quot;= m1*m2&quot;</font>;
<font color="darkgreen">//   Complex j=Complex.j();</font>
<font color="darkgreen">//   Real m1Re[size(m1,1),size(m1,2)]=Re(m1);</font>
<font color="darkgreen">//   Real m1Im[size(m1,1),size(m1,2)]=Im(m1);</font>
<font color="darkgreen">//   Real m2Re[size(m2,1),size(m2,2)]=Re(m2);</font>
<font color="darkgreen">//   Real m2Im[size(m2,1),size(m2,2)]=Im(m2);</font>
    <font color="blue">protected </font>
  Integer l1;
  Integer l2;
<font color="blue">algorithm </font>
<font color="darkgreen">//  m3 := m1[:, :].re*m2[:, :].re - m1[:, :].im*m2[:, :].im + j*(m1[:, :].re*m2[:,:].im + m1[:, :].im*m2[:, :].re);</font>
<font color="darkgreen">//  m3 :=m1Re*m2Re - m1Im*m2Im + j*(m1Re*m2Im + m1Im*m2Re);</font>

 <font color="blue">for </font>l1<font color="blue"> in </font>1:<font color="red">size</font>(m1,1)<font color="blue"> loop</font>
   <font color="blue">for </font>l2<font color="blue"> in </font>1:<font color="red">size</font>(m2,2)<font color="blue"> loop</font>
     m3[l1,l2] :=<font color="red"> Complex.Vectors.multiply</font>(m1[l1,:],m2[:,l2]);
   <font color="blue">end for</font>;
   <font color="blue">end for</font>;

<font color="blue">end </font>matMatMul</textblock>;

<textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.Matrices.matVecMul"><font color="blue">encapsulated </font><font color="blue">function</font> matVecMul <font color="darkgreen">
      &quot;Multiply a complex matrices with a complex vector&quot;</font>
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
<font color="darkgreen">//  import Re = Modelica_LinearSystems2.Math.Complex.real;</font>
<font color="darkgreen">//  import Im = Modelica_LinearSystems2.Math.Complex.imag;</font>

  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> m[:,:] <font color="darkgreen">&quot;Complex matrix&quot;</font>;
  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> vi[<font color="red">size</font>(m, 2)] <font color="darkgreen">&quot;Complex vector&quot;</font>;
  <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> vo[<font color="red">size</font>(m, 1)] <font color="darkgreen">&quot;= m*vi&quot;</font>;
<font color="darkgreen">//   Complex j=Complex.j();</font>
<font color="darkgreen">//   Real Rem[size(m, 1),size(m, 2)]=Re(m);</font>
<font color="darkgreen">//   Real Imm[size(m, 1),size(m, 2)]=Im(m);</font>
<font color="darkgreen">//   Real Revi[size(vi, 1)]=Re(vi);</font>
<font color="darkgreen">//   Real Imvi[size(vi, 1)]=Im(vi);</font>
    <font color="blue">protected </font>
  Integer l1;

<font color="blue">algorithm </font>
<font color="darkgreen">//  vo := Rem*Revi - Imm*Imvi + j*(Rem*Imvi + Imm*Revi);</font>

<font color="darkgreen">//    for l1 in 1:size(m, 1) loop</font>
<font color="darkgreen">//      vo[l1] := Complex(0);</font>
<font color="darkgreen">//      for l2 in 1:size(m, 2) loop</font>
<font color="darkgreen">//        vo[l1] := vo[l1] + m[l1, l2]*vi[l2];</font>
<font color="darkgreen">//      end for;//l2</font>
<font color="darkgreen">//    end for;  //l1</font>

<font color="blue">for </font>l1<font color="blue"> in </font>1:<font color="red">size</font>(m, 1)<font color="blue"> loop</font>
  vo[l1] :=<font color="red"> Complex.Vectors.multiply</font>(m[l1,:],vi);
<font color="blue">end for</font>;

<font color="blue">end </font>matVecMul</textblock>;

<font color="blue">end </font>Matrices</textblock>;

  <textblock type="packagesmall" expanded="false" path="Modelica_LinearSystems2.Math.Complex.'constructor'"><font color="blue">encapsulated </font><font color="blue">operator</font> &#39;constructor&#39;
    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.'constructor'.fromReal"><font color="blue">function</font> fromReal
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
      <font color="blue">input </font>Real re <font color="darkgreen">&quot;Real part of complex number&quot;</font>;
      <font color="blue">input </font>Real im=0 <font color="darkgreen">&quot;Imaginary part of complex number&quot;</font>;
      <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> result(re=re, im=im) <font color="darkgreen">&quot;Complex number&quot;</font>;
    <font color="blue">algorithm </font>

<textblock type="annotcomp" expanded="false">    <font color="blue">end </font>fromReal</textblock>;
  <font color="blue">end </font>&#39;constructor&#39;</textblock>;

  <textblock type="packagesmall" expanded="false" path="Modelica_LinearSystems2.Math.Complex.'-'"><font color="blue">encapsulated </font><font color="blue">operator</font> &#39;-&#39; <font color="darkgreen">&quot;Unary and binary minus&quot;</font>
    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.'-'.negate"><font color="blue">function</font> negate <font color="darkgreen">&quot;Unary minus (multiply complex number by -1)&quot;</font>
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>; <font color="darkgreen">// changed to Modelica_LinearSystems2</font>
      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c1 <font color="darkgreen">&quot;Complex number&quot;</font>;
      <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c2 <font color="darkgreen">&quot;= -c1&quot;</font>;
    <font color="blue">algorithm </font>
      c2 := <font color="red">Complex</font>(-c1.re, -c1.im);
<textblock type="annotcomp" expanded="false">    <font color="blue">end </font>negate</textblock>;

    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.'-'.subtract"><font color="blue">function</font> subtract <font color="darkgreen">&quot;Subtract two complex numbers&quot;</font>
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;<font color="darkgreen">// changed to Modelica_LinearSystems2</font>
      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c1 <font color="darkgreen">&quot;Complex number 1&quot;</font>;
      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c2 <font color="darkgreen">&quot;Complex number 2&quot;</font>;
      <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c3 <font color="darkgreen">&quot;= c1 - c2&quot;</font>;
    <font color="blue">algorithm </font>
      c3 := <font color="red">Complex</font>(c1.re - c2.re, c1.im - c2.im);
<textblock type="annotcomp" expanded="false">    <font color="blue">end </font>subtract</textblock>;
  <font color="blue">end </font>&#39;-&#39;</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.'+'"><font color="blue">encapsulated </font><font color="blue">operator function</font> &#39;+&#39; <font color="darkgreen">&quot;Add two complex numbers&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c1 <font color="darkgreen">&quot;Complex number 1&quot;</font>;
      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c2 <font color="darkgreen">&quot;Complex number 2&quot;</font>;
      <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c3 <font color="darkgreen">&quot;= c1 + c2&quot;</font>;
  <font color="blue">algorithm </font>
    c3 := <font color="red">Complex</font>(c1.re + c2.re, c1.im + c2.im);
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>&#39;+&#39;</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.'*'"><font color="blue">encapsulated </font><font color="blue">operator function</font> &#39;*&#39; <font color="darkgreen">&quot;Multiply two complex numbers&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c1 <font color="darkgreen">&quot;Complex number 1&quot;</font>;
      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c2 <font color="darkgreen">&quot;Complex number 2&quot;</font>;
      <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c3 <font color="darkgreen">&quot;= c1*c2&quot;</font>;
  <font color="blue">algorithm </font>
      c3 := <font color="red">Complex</font>(c1.re*c2.re - c1.im*c2.im, c1.re*c2.im + c1.im*c2.re);
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>&#39;*&#39;</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.'/'"><font color="blue">encapsulated </font><font color="blue">operator function</font> &#39;/&#39; <font color="darkgreen">&quot;Divide two complex numbers&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c1 <font color="darkgreen">&quot;Complex number 1&quot;</font>;
      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c2 <font color="darkgreen">&quot;Complex number 2&quot;</font>;
      <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c3 <font color="darkgreen">&quot;= c1/c2&quot;</font>;
  <font color="blue">algorithm </font>
      c3 := <font color="red">Complex</font>((c1.re*c2.re + c1.im*c2.im)/(c2.re^2 + c2.im^2), (-c1.re*c2.im + c1.im*c2.re)/(c2.re^2 + c2.im^2));
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>&#39;/&#39;</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.'=='"><font color="blue">encapsulated </font><font color="blue">operator function</font> &#39;==&#39; <font color="darkgreen">
    &quot;Test whether two complex numbers are identical&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c1 <font color="darkgreen">&quot;Complex number 1&quot;</font>;
      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c2 <font color="darkgreen">&quot;Complex number 2&quot;</font>;
      <font color="blue">output </font>Boolean result <font color="darkgreen">&quot;c1 == c2&quot;</font>;
  <font color="blue">algorithm </font>
      result := c1.re == c2.re<font color="blue"> and </font>c1.im == c2.im;
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>&#39;==&#39;</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.'String'"><font color="blue">encapsulated </font><font color="blue">operator function</font> &#39;String&#39; <font color="darkgreen">
    &quot;Transform Complex number into a String representation&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c <font color="darkgreen">
      &quot;Complex number to be transformed in a String representation&quot;</font>;
      <font color="blue">input </font>String name=&quot;j&quot; <font color="darkgreen">
      &quot;Name of variable representing sqrt(-1) in the string&quot;</font>;
      <font color="blue">input </font>Integer significantDigits=6 <font color="darkgreen">
      &quot;Number of significant digits that are shown&quot;</font>;
      <font color="blue">output </font>String s=&quot;&quot;;
  <font color="blue">algorithm </font>
      s := <font color="red">String</font>(c.re, significantDigits=significantDigits);
      <font color="blue">if </font>c.im &lt;&gt; 0<font color="blue"> then</font>
        <font color="blue">if </font>c.im &gt; 0<font color="blue"> then</font>
          s := s + &quot; + &quot;;
        <font color="blue">else</font>
          s := s + &quot; - &quot;;
        <font color="blue">end if</font>;
        s := s + <font color="red">String</font>(<font color="red">abs</font>(c.im), significantDigits=significantDigits) + &quot;*&quot; + name;
      <font color="blue">end if</font>;
    <font color="darkgreen">//    end toString;</font>
  <font color="blue">end </font>&#39;String&#39;</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.j"><font color="blue">encapsulated </font><font color="blue">function</font> j <font color="darkgreen">&quot;Returns sqrt(-1)&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c <font color="darkgreen">&quot;= sqrt(-1)&quot;</font>;
  <font color="blue">algorithm </font>
    c := <font color="red">Complex</font>(0,1);
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>j</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.'abs'"><font color="blue">encapsulated </font><font color="blue">function</font> &#39;abs&#39; <font color="darkgreen">&quot;Absolute value of complex number&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c <font color="darkgreen">&quot;Complex number&quot;</font>;
    <font color="blue">output </font>Real result <font color="darkgreen">&quot;= abs(c)&quot;</font>;
  <font color="blue">algorithm </font>
    result := (c.re^2 + c.im^2)^0.5; <font color="darkgreen">//changed from sqrt</font>
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>&#39;abs&#39;</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.'sqrt'"><font color="blue">encapsulated </font><font color="blue">function</font> &#39;sqrt&#39; <font color="darkgreen">&quot;Square root of complex number&quot;</font>
    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Math.html#Modelica.Math"
>Modelica.Math</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c1 <font color="darkgreen">&quot;Complex number&quot;</font>;
    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c2 <font color="darkgreen">&quot;= sqrt(c1)&quot;</font>;
  <font color="blue">algorithm </font>
    c2 := <font color="red">Complex</font>(<font color="red">sqrt</font>(<font color="red">Complex.&#39;abs&#39;</font>(c1))*<font color="red">Math.cos</font>(<font color="red">Complex.arg</font>(c1)/2), <font color="red">sqrt</font>(
      <font color="red">Complex.&#39;abs&#39;</font>(c1))*<font color="red">Math.sin</font>(<font color="red">Complex.arg</font>(c1)/2));
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>&#39;sqrt&#39;</textblock>;

<textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.'max'"><font color="blue">encapsulated </font><font color="blue">function</font> &#39;max&#39; <font color="darkgreen">
    &quot;Return maximum element of complex vector&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> v[:] <font color="darkgreen">&quot;Vector&quot;</font>;
  <font color="blue">output </font>Real result <font color="darkgreen">&quot;Element of v with largest absolute value&quot;</font>;
  <font color="blue">output </font>Integer index <font color="darkgreen">&quot;v[index] has the largest absolute value&quot;</font>;

  <font color="blue">protected </font>
  Real absv_i;
<font color="blue">algorithm </font>
  <font color="blue">if </font><font color="red">size</font>(v,1) &gt; 0<font color="blue"> then</font>
     result :=<font color="red"> Complex.&#39;abs&#39;</font>(v[1]);
     index  := 1;
     <font color="blue">for </font>i<font color="blue"> in </font>2:<font color="red">size</font>(v,1)<font color="blue"> loop</font>
        absv_i :=<font color="red">Complex.&#39;abs&#39;</font>(v[i]);
        <font color="blue">if </font>absv_i &gt; result<font color="blue"> then</font>
           result := absv_i;
           index := i;
        <font color="blue">end if</font>;
     <font color="blue">end for</font>;
  <font color="blue">else</font>
     result := 0;
     index  := 0;
  <font color="blue">end if</font>;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>&#39;max&#39;</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.exp"><font color="blue">encapsulated </font><font color="blue">function</font> exp <font color="darkgreen">&quot;Exponential of complex number&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Math.html#Modelica.Math"
>Modelica.Math</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c1 <font color="darkgreen">&quot;Complex number&quot;</font>;
    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c2 <font color="darkgreen">&quot;= exp(c1)&quot;</font>;
  <font color="blue">algorithm </font>
     c2 := <font color="red">Complex</font>(<font color="red">Math.exp</font>(c1.re)*<font color="red">Math.cos</font>(c1.im), <font color="red">Math.exp</font>(c1.re)*<font color="red">Math.sin</font>(c1.im));
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>exp</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.log"><font color="blue">encapsulated </font><font color="blue">function</font> log <font color="darkgreen">&quot;Logarithm of complex number&quot;</font>

    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c1 <font color="darkgreen">&quot;Complex number&quot;</font>;
    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c2 <font color="darkgreen">&quot;= log(c1)&quot;</font>;
  <font color="blue">algorithm </font>
    c2 := <font color="red">Complex</font>(<font color="red">Modelica.Math.log</font>(<font color="red">Complex.&#39;abs&#39;</font>(c1)), <font color="red">Complex.arg</font>(c1));
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>log</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.sin"><font color="blue">encapsulated </font><font color="blue">function</font> sin <font color="darkgreen">&quot;Sine of complex number&quot;</font>

    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c1 <font color="darkgreen">&quot;Complex number&quot;</font>;
    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c2 <font color="darkgreen">&quot;sin(c1)&quot;</font>;

  <font color="blue">algorithm </font>
     c2 := (<font color="red">Complex.exp</font>(<font color="red">Complex</font>(-c1.im, +c1.re)) - <font color="red">Complex.exp</font>(<font color="red">Complex</font>(+c1.im, -c1.re)))/
      <font color="red">Complex</font>(0, 2);

<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>sin</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.cos"><font color="blue">encapsulated </font><font color="blue">function</font> cos <font color="darkgreen">&quot;Cosine of complex number&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex.exp"
>Modelica_LinearSystems2.Math.Complex.exp</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c1 <font color="darkgreen">&quot;Complex number&quot;</font>;
    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c2 <font color="darkgreen">&quot;= cos(c1)&quot;</font>;

  <font color="blue">algorithm </font>
   c2 := (<font color="red">exp</font>(<font color="red">Complex</font>(-c1.im, +c1.re)) + <font color="red">exp</font>(<font color="red">Complex</font>(+c1.im, -c1.re)))/2;
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>cos</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.arg"><font color="blue">encapsulated </font><font color="blue">function</font> arg <font color="darkgreen">&quot;Phase angle of complex number&quot;</font>
    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math"
>Modelica_LinearSystems2.Math</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c <font color="darkgreen">&quot;Complex number&quot;</font>;
    <font color="blue">input </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>Modelica.SIunits.Angle</A> phi0=0 <font color="darkgreen">
      &quot;phase angle phi shall be in the range: -pi &lt; phi-phi0 &lt; pi&quot;</font>;
    <font color="blue">output </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>Modelica.SIunits.Angle</A> phi <font color="darkgreen">&quot;= phase angle of c&quot;</font>;

  <font color="blue">algorithm </font>
    phi := <font color="red">Modelica.Math.atan3</font>(
        c.im,
        c.re,
        phi0);
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>arg</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.conj"><font color="blue">encapsulated </font><font color="blue">function</font> conj <font color="darkgreen">&quot;Conjugate of complex number&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c1 <font color="darkgreen">&quot;Complex number&quot;</font>;
    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c2 <font color="darkgreen">&quot;= c1.re - j*c1.im&quot;</font>;
  <font color="blue">algorithm </font>
    c2 := <font color="red">Complex</font>(c1.re, -c1.im);
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>conj</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.real"><font color="blue">encapsulated </font><font color="blue">function</font> real <font color="darkgreen">&quot;Real part of complex number&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c <font color="darkgreen">&quot;Complex number&quot;</font>;
    <font color="blue">output </font>Real r <font color="darkgreen">&quot;= c.re &quot;</font>;
  <font color="blue">algorithm </font>
    r := c.re;
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>real</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.imag"><font color="blue">encapsulated </font><font color="blue">function</font> imag <font color="darkgreen">&quot;imaginary part of complex number&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c <font color="darkgreen">&quot;Complex number&quot;</font>;
    <font color="blue">output </font>Real r <font color="darkgreen">&quot;= c.im &quot;</font>;
  <font color="blue">algorithm </font>
    r := c.im;
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>imag</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.eigenValues"><font color="blue">encapsulated </font><font color="blue">function</font> eigenValues <font color="darkgreen">
    &quot;compute eingenvalues of a matrix A, using lapack routine dgeevx&quot;</font>

    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math_Matrices_LAPACK.html#Modelica_LinearSystems2.Math.Matrices.LAPACK"
>Modelica_LinearSystems2.Math.Matrices.LAPACK</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math_Matrices_LAPACK.html#Modelica_LinearSystems2.Math.Matrices.LAPACK.dgeevx"
>Modelica_LinearSystems2.Math.Matrices.LAPACK.dgeevx</A>;

    <font color="blue">input </font>Real A[:,<font color="red">size</font>(A, 1)] <font color="darkgreen">&quot;Real matrix&quot;</font>;
    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> eigval[<font color="red">size</font>(A, 1)] <font color="darkgreen">
      &quot;Finite, invariant zeros of ss; size(Zeros,1) &lt;= size(ss.A,1)&quot;</font>;

  <font color="blue">protected </font>
    Integer nx=<font color="red">size</font>(A, 1) <font color="darkgreen">&quot;Number of states&quot;</font>;

    Real alphaReal[nx];
    Real alphaImag[nx];

    Integer info;

  <font color="blue">algorithm </font>
   <font color="darkgreen">// Compute eigenvalues</font>

    (alphaReal,alphaImag,,,,info) := <font color="red">dgeevx</font>(A);
    <font color="red">assert</font>(info == 0,
      &quot;Failed to compute eigenvalues with function eigenValues_dgeevx(..)&quot;);

    <font color="blue">for </font>i<font color="blue"> in </font>1:nx<font color="blue"> loop</font>
      eigval[i].re := alphaReal[i];
      eigval[i].im := alphaImag[i];
    <font color="blue">end for</font>;

<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>eigenValues</textblock>;

<textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.eigenVectors"><font color="blue">encapsulated </font><font color="blue">function</font> eigenVectors <font color="darkgreen">
    &quot;Calculate the rigth eigenvectors of a linear state space system and write them columnwise in a matrix.&quot;</font>
    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Math_Matrices_LAPACK.html#Modelica.Math.Matrices.LAPACK"
>Modelica.Math.Matrices.LAPACK</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
    <font color="blue">import </font>Re = <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex.real"
>Modelica_LinearSystems2.Math.Complex.real</A>;
    <font color="blue">import </font>Im = <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex.imag"
>Modelica_LinearSystems2.Math.Complex.imag</A>;

  <font color="blue">input </font>Real A[:,<font color="red">size</font>(A, 1)] <font color="darkgreen">&quot;real square matrix&quot;</font>;
  <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> eigvec[<font color="red">size</font>(A, 1),<font color="red">size</font>(A, 2)] <font color="darkgreen">&quot;eigen values of the system&quot;</font>;
  <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> eigval[<font color="red">size</font>(A, 1)]=<font color="red">fill</font>(<font color="red">Complex</font>(0),<font color="red"> size</font>(A, 1)) <font color="darkgreen">
      &quot;eigen values of the system&quot;</font>;
  <font color="blue">protected </font>
  Integer info;
  Real eigvecRe[<font color="red">size</font>(A, 1),<font color="red">size</font>(A, 2)];
  Real eigvalRe[<font color="red">size</font>(A, 1)]=<font color="red">fill</font>(0,<font color="red"> size</font>(A, 1));
  Real eigvalIm[<font color="red">size</font>(A, 1)]=<font color="red">fill</font>(0,<font color="red"> size</font>(A, 1));
  Integer n=<font color="red">size</font>(A, 1);
  Integer i;
  <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> j=<font color="red">Complex.j</font>();
<font color="blue">algorithm </font>
  <font color="blue">if </font><font color="red">size</font>(A, 1) &gt; 0<font color="blue"> then</font>

    (eigvalRe,eigvalIm,eigvecRe,info) :=<font color="red"> LAPACK.dgeev</font>(A);
    <font color="blue">for </font>i<font color="blue"> in </font>1:<font color="red">size</font>(A, 1)<font color="blue"> loop</font>
      eigval[i].re := eigvalRe[i];
      eigval[i].im := eigvalIm[i];
    <font color="blue">end for</font>;

    <font color="red">assert</font>(info == 0, &quot;Calculating the eigen values with function
\&quot;StateSpace.Analysis.eigenVectors\&quot; is not possible, since the
numerical algorithm does not converge.&quot;);

    i := 1;
    <font color="blue">while </font>i &lt; n<font color="blue"> loop</font>
      <font color="blue">if </font><font color="red">abs</font>(eigvalIm[i]) &gt; 0<font color="blue"> then</font>
        <font color="blue">for </font>ii<font color="blue"> in </font>1:n<font color="blue"> loop</font>
          eigvec[ii, i] := eigvecRe[ii, i] + j*eigvecRe[ii, i + 1];
          eigvec[ii, i + 1] := eigvecRe[ii, i] - j*eigvecRe[ii, i + 1];
        <font color="blue">end for</font>;
        i := i + 2;
      <font color="blue">else</font>
        <font color="blue">for </font>ii<font color="blue"> in </font>1:n<font color="blue"> loop</font>
          eigvec[ii, i] :=<font color="red"> Complex</font>(1)*eigvecRe[ii, i];
        <font color="blue">end for</font>;
        i := i + 1;
      <font color="blue">end if</font>;
    <font color="blue">end while</font>;

  <font color="blue">end if</font>;

<textblock type="annotcomp" expanded="false"><font color="blue">end </font>eigenVectors</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.frequency"><font color="blue">encapsulated </font><font color="blue">function</font> frequency <font color="darkgreen">
    &quot;Frequency and damping of conjugated complex pole pair&quot;</font>
    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math"
>Modelica_LinearSystems2.Math</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c <font color="darkgreen">&quot;Complex number&quot;</font>;
    <font color="blue">output </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Frequency"
>Modelica.SIunits.Frequency</A> f <font color="darkgreen">&quot;Frequency of c (= c.im in Hz)&quot;</font>;
    <font color="blue">output </font>Real damping <font color="darkgreen">&quot;Damping of c (= c.re/c.im)&quot;</font>;

  <font color="blue">protected </font>
    Real abs_ev=(c.re^2 + c.im^2)^0.5;
  <font color="blue">algorithm </font>
    f := <font color="blue">if </font><font color="red">abs</font>(c.im) &gt; 10*Modelica.Constants.eps<font color="blue"> then </font>abs_ev/(2*Modelica.Constants.pi)<font color="blue"> else </font>0;
    damping := <font color="blue">if </font><font color="red">abs</font>(c.im) &gt; 10*Modelica.Constants.eps<font color="blue"> then </font><font color="blue">if </font>abs_ev &gt; Modelica.Constants.eps<font color="blue"> then </font>-c.re/abs_ev<font color="blue"> else </font>0.0<font color="blue"> else </font>
      1.0;
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>frequency</textblock>;

<textblock type="packagesmall" expanded="false" path="Modelica_LinearSystems2.Math.Complex.Internal"><font color="blue">encapsulated </font><font color="blue">package</font> Internal
    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
 <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.Internal.eigenValues_dhseqr"><font color="blue">function</font> eigenValues_dhseqr <font color="darkgreen">
      &quot;compute eingenvalues of a upper Hessenberg matrix using lapack routine DHSEQR&quot;</font>

      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math_Matrices_Internal.html#Modelica_LinearSystems2.Math.Matrices.Internal.eigenvaluesHessenberg"
>Modelica_LinearSystems2.Math.Matrices.Internal.eigenvaluesHessenberg</A>;

  <font color="blue">input </font>Real H[:,<font color="red">size</font>(H, 1)] <font color="darkgreen">&quot;Real upper Hessenberg matrix&quot;</font>;
  <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> zeros[<font color="red">size</font>(H, 1)] <font color="darkgreen">
        &quot;Finite, invariant zeros of ss; size(Zeros,1) &lt;= size(ss.A,1)&quot;</font>;

    <font color="blue">protected </font>
  Integer nx=<font color="red">size</font>(H, 1) <font color="darkgreen">&quot;Number of states&quot;</font>;
  Real alphaReal[nx];
  Real alphaImag[nx];
  Integer info;

 <font color="blue">algorithm </font>
  (alphaReal,alphaImag,info) :=<font color="red"> eigenvaluesHessenberg</font>(H);
  <font color="red">assert</font>(info == 0,
    &quot;Failed to compute eigenvalues with function Internal.eigenValues_dhseqr(..)&quot;);

  <font color="blue">for </font>i<font color="blue"> in </font>1:nx<font color="blue"> loop</font>
    zeros[i].re := alphaReal[i];
    zeros[i].im := alphaImag[i];
  <font color="blue">end for</font>;

 <font color="blue">end </font>eigenValues_dhseqr</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.Internal.C_transpose"><font color="blue">function</font> C_transpose <font color="darkgreen">
      &quot;Computes the transposed matrix of a complex matrix&quot;</font>
    <font color="blue">extends </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Icons.html#Modelica.Icons.Function"
>Modelica.Icons.Function</A>;

      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
      <font color="blue">import </font>Re = <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex.real"
>Modelica_LinearSystems2.Math.Complex.real</A>;
      <font color="blue">import </font>Im = <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex.imag"
>Modelica_LinearSystems2.Math.Complex.imag</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> C[:,:];
    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> CT[<font color="red">size</font>(C, 2),<font color="red">size</font>(C, 1)];
    <font color="blue">protected </font>
    <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> j=<font color="red">Complex.j</font>();
    Integer l1;
    Integer l2;
  <font color="blue">algorithm </font>
  <font color="darkgreen">//  CT := Complex(1)*transpose(C[:,:].re)-j*transpose(C[:,:].im);// too slow</font>
    <font color="blue">for </font>l1<font color="blue"> in </font>1:<font color="red">size</font>(C, 1)<font color="blue"> loop</font>
      <font color="blue">for </font>l2<font color="blue"> in </font>1:<font color="red">size</font>(C, 2)<font color="blue"> loop</font>
  <font color="darkgreen">//      CT[l2, l1] := Re(C[l1, l2]) - j*Im(C[l1, l2]);</font>
        CT[l2, l1] := <font color="red">Complex.conj</font>(C[l1,l2]);
      <font color="blue">end for</font>;
    <font color="blue">end for</font>;

  <font color="blue">end </font>C_transpose</textblock>;

<textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Complex.Internal.frobeniusNorm"><font color="blue">function</font> frobeniusNorm <font color="darkgreen">&quot;Return the Frobenius norm of a matrix&quot;</font>
  <font color="blue">extends </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Icons.html#Modelica.Icons.Function"
>Modelica.Icons.Function</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> A[:,:] <font color="darkgreen">&quot;Input matrix&quot;</font>;
  <font color="blue">output </font>Real result=0.0 <font color="darkgreen">&quot;frobenius norm of matrix A&quot;</font>;
<font color="blue">algorithm </font>
  <font color="blue">for </font>i1<font color="blue"> in </font>1:<font color="red">size</font>(A, 1)<font color="blue"> loop</font>
    <font color="blue">for </font>i2<font color="blue"> in </font>1:<font color="red">size</font>(A, 2)<font color="blue"> loop</font>
      result := result +<font color="red"> Complex.real</font>(A[i1, i2]*<font color="red">Complex.conj</font>(A[i1, i2]));
    <font color="blue">end for</font>;
  <font color="blue">end for</font>;
  result :=<font color="red"> sqrt</font>(result);
<font color="blue">end </font>frobeniusNorm</textblock>;

<font color="blue">end </font>Internal</textblock>;

<textblock type="annotcomp" expanded="false"><font color="blue">end </font>Complex;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Polynomial<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_LinearSystems2.Math.ComplexI.png" ALT="Modelica_LinearSystems2.Math.Polynomial" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_LinearSystems2.Math.Polynomial"></A><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math"
>Modelica_LinearSystems2.Math</A>.Polynomial</H2>
<B>Record defining the data for a polynomial</B><p>
<P><H3>Information</H3></P>
<PRE></pre>
<p>
This record defines a polynomial, e.g., y = 2*x^2 + 3*x + 1. The general form is:
</p>
<pre>
   y = c[1]*x^n + c[2]*x^(n-1) + ... + c[n]*x + c[n+1];
</pre>
<p>
In the record, the coefficients c[i] are stored. Usually, the record is not directly accessed. Instead, a polynomial is generated with the functions provided in the record such as Polynomial.base(..), 
Polynomial.fitting(..). 
Several functions are provided that operate on polynomials.
</p> 
<pre></PRE><P>
Extends from <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Icons.html#Modelica.Icons.Record"
>Modelica.Icons.Record</A> (Icon for a record).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>c[:]</TD><TD>&nbsp;</TD><TD>Polynomial coefficients (c[1]*x^n + ... c[n]*x + c[n+1])</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">record</font> Polynomial <font color="darkgreen">&quot;Record defining the data for a polynomial&quot;</font>
  <font color="blue">extends </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Icons.html#Modelica.Icons.Record"
>Modelica.Icons.Record</A>;
  Real c[:] <font color="darkgreen">&quot;Polynomial coefficients (c[1]*x^n + ... c[n]*x + c[n+1])&quot;</font>;

  <textblock type="packagesmall" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.Examples"><font color="blue">encapsulated </font><font color="blue">package</font> Examples <font color="darkgreen">
    &quot;Examples demonstrating the usage of Polynomials&quot;</font>
    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;

    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.Examples.polynomialOperations1"><font color="blue">function</font> polynomialOperations1 <font color="darkgreen">
      &quot;Demonstrate basic algebraic operations on polynomials&quot;</font>
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Utilities_Streams.html#Modelica.Utilities.Streams.print"
>Modelica.Utilities.Streams.print</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>.*;

      <font color="blue">output </font>Boolean ok;

    <font color="blue">protected </font>
      <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> t=<font color="red">Polynomial.x</font>();
      <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p;
    <font color="blue">algorithm </font>
      p := t^2 + 8*t + 16;

      <font color="red">print</font>(&quot;y1 = &quot; + <font color="red">String</font>(p, name=&quot;t&quot;));
      <font color="red">print</font>(&quot;y2 = &quot; + <font color="red">String</font>(p*p, name=&quot;t&quot;));
      ok := true;
    <font color="blue">end </font>polynomialOperations1</textblock>;

    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.Examples.polynomialOperations2"><font color="blue">function</font> polynomialOperations2 <font color="darkgreen">
      &quot;Demonstrate differentiation and integration of polynomials&quot;</font>
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>.*;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.TransferFunction"
>Modelica_LinearSystems2.TransferFunction</A>;
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Utilities_Streams.html#Modelica.Utilities.Streams.print"
>Modelica.Utilities.Streams.print</A>;

      <font color="blue">output </font>Boolean ok;
    <font color="blue">protected </font>
      <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p=<font color="red">Polynomial</font>({6,4,-3}) <font color="darkgreen">&quot;6*x^2 + 4*x - 3&quot;</font>;
      <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> int_p;
      <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> der_p;
      <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.TransferFunction"
>TransferFunction</A> tf;
      Real x;
      Real int_val1;
      Real int_val2;
      Real der_val1;
      Real der_val2;
      Real der_val3;
      Real der_val4;
    <font color="blue">algorithm </font>
      <font color="red">print</font>(&quot;Show integration and differentation of y = &quot; + <font color="red">String</font>(p));
      int_p := <font color="red">integral</font>(p);
      der_p := <font color="red">derivative</font>(p);

      <font color="red">print</font>(&quot;  Integral of polynomial  : &quot; + <font color="red">String</font>(int_p));
      <font color="red">print</font>(&quot;  Derivative of polynomial: &quot; + <font color="red">String</font>(der_p));

      <font color="red">print</font>(
        &quot;Compute derivatives and integral directly and via polynomials above (for p(x=2)):&quot;);
      x := 2;
      int_val1 := <font color="red">integralValue</font>(p, x);
      int_val2 := <font color="red">evaluate</font>(int_p, x);
      <font color="red">print</font>(&quot;      integralValue(p,x) = &quot; + <font color="red">String</font>(int_val1) +
        &quot;, evaluate(integral(p),x) = &quot; + <font color="red">String</font>(int_val2));

      der_val1 := <font color="red">derivativeValue</font>(p, x);
      der_val2 := <font color="red">evaluate</font>(der_p, x);
      <font color="red">print</font>(&quot;    derivativeValue(p,x) = &quot; + <font color="red">String</font>(der_val1) +
        &quot;, evaluate(derivative(p),x) = &quot; + <font color="red">String</font>(der_val2));
      der_val3 := <font color="red">derivativeValue</font>(
            p,
            x,
            2);
      der_val4 := <font color="red">evaluate</font>(<font color="red">derivative</font>(der_p), x);
      <font color="red">print</font>(&quot;  derivativeValue(p,x,2) = &quot; + <font color="red">String</font>(der_val3) +
        &quot;, evaluate(derivative(derivative(p)),x) = &quot; + <font color="red">String</font>(der_val4));
      tf := der_p/int_p;
      <font color="red">print</font>(&quot;  derivative/integral of polynomial = &quot; + <font color="red">String</font>(tf, name=&quot;x&quot;));
      ok := true;
    <font color="blue">end </font>polynomialOperations2</textblock>;

    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.Examples.PascalTriangle"><font color="blue">function</font> PascalTriangle <font color="darkgreen">&quot;Generate and print Pascals triangle&quot;</font>
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>.*;
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Utilities_Streams.html#Modelica.Utilities.Streams.print"
>Modelica.Utilities.Streams.print</A>;

      <font color="blue">output </font>Boolean ok;
    <font color="blue">protected </font>
      <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p=<font color="red">Polynomial.x</font>();
      <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p1;
    <font color="blue">algorithm </font>
      p1 := p + 1;
      <font color="red">print</font>(&quot;Pascals triangle up to order 20:&quot;);
      <font color="blue">for </font>i<font color="blue"> in </font>0:20<font color="blue"> loop</font>
        <font color="red">print</font>(&quot;  &quot; + <font color="red">String</font>(p1^i));
      <font color="blue">end for</font>;
      ok := true;
    <font color="blue">end </font>PascalTriangle</textblock>;

    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.Examples.plotPolynomial"><font color="blue">function</font> plotPolynomial <font color="darkgreen">
      &quot;Demonstrate plotting of polynomial with automatic range and legend determination&quot;</font>
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math"
>Modelica_LinearSystems2.Math</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

      <font color="blue">output </font>Boolean ok;

    <font color="blue">protected </font>
      <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> j = <font color="red">Modelica_LinearSystems2.Math.Complex.j</font>();
      <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c[:]={-2+0*j,<font color="red">Complex</font>(0),2+0*j,7+j,7-j};
      <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p=<font color="red">Polynomial</font>(c);
    <font color="blue">algorithm </font>
      <font color="red">Polynomial.plot</font>(p);
      ok := true;
<textblock type="annotcomp" expanded="false">    <font color="blue">end </font>plotPolynomial</textblock>;
  <font color="blue">end </font>Examples</textblock>;

  <textblock type="packagesmall" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.'constructor'"><font color="blue">encapsulated </font><font color="blue">operator</font> &#39;constructor&#39;
    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.'constructor'.fromVector"><font color="blue">function</font> fromVector <font color="darkgreen">
      &quot;Constructor for a polynomial by providing a vector of coefficients&quot;</font>
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

      <font color="blue">input </font>Real c[:] <font color="darkgreen">&quot;Coefficients of polynomial in descending order&quot;</font>;
      <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p(<font color="blue">redeclare </font>Real c[<font color="red">size</font>(c, 1)]) <font color="darkgreen">&quot;Polynomial&quot;</font>;
    <font color="blue">algorithm </font>
      p.c := c;
    <font color="blue">end </font>fromVector</textblock>;

    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.'constructor'.fromReal"><font color="blue">function</font> fromReal <font color="darkgreen">
      &quot;Generate a Polynomial data record from a Real value&quot;</font>
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

      <font color="blue">input </font>Real r <font color="darkgreen">&quot;Value of Real variable&quot;</font>;
      <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p(<font color="blue">redeclare </font>Real c[1]);
    <font color="blue">algorithm </font>
      p.c := {r};
<textblock type="annotcomp" expanded="false">    <font color="blue">end </font>fromReal</textblock>;

    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.'constructor'.fromZeros"><font color="blue">function</font> fromZeros <font color="darkgreen">&quot;Generate a polynomial from given zeros&quot;</font>
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Utilities_Streams.html#Modelica.Utilities.Streams"
>Modelica.Utilities.Streams</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> roots[:] <font color="darkgreen">
        &quot;Zeros of polynomial (must be real or conjugate complex pairs)&quot;</font>;
      <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p(<font color="blue">redeclare </font>Real c[<font color="red">size</font>(roots, 1) + 1]) <font color="darkgreen">
        &quot;Polynomial that corresponds to the zeros&quot;</font>;

    <font color="blue">protected </font>
      Integer nr=<font color="red">size</font>(roots, 1) <font color="darkgreen">&quot;Number of roots&quot;</font>;
      Integer nc=nr + 1 <font color="darkgreen">&quot;Length of coefficent vector&quot;</font>;
      Integer nn;
      Integer i;
    <font color="blue">algorithm </font>
      p.c[nc] := 1;
      i := 1;
      nn := 1;
      <font color="blue">while </font>i &lt;= nr<font color="blue"> loop</font>
         <font color="darkgreen">// Determine whether zero is real or conjugate complex</font>
        <font color="blue">if </font>roots[i].im == 0.0<font color="blue"> then</font>
            <font color="darkgreen">// real root</font>
          p.c := <font color="red">Polynomial.Internal.mult</font>(p.c, nn, {1,-roots[i].re}, nc);

          i := i + 1;
          nn := nn + 1;
        <font color="blue">else</font>
            <font color="darkgreen">// complex root; check that it is a conjugate complex pair</font>
          <font color="red">assert</font>(i &lt; nr, &quot;Roots do not define a real valued polynomial\n&quot; +
            &quot;(roots[&quot; + <font color="red">String</font>(nr) + &quot;] is complex without complex conjugate)&quot;);
          <font color="red">assert</font>(roots[i].re == roots[i + 1].re,
            &quot;No conjugate complex zero pair\n&quot; + &quot;  roots[&quot; + <font color="red">String</font>(i) +
            &quot;].re = &quot; + <font color="red">String</font>(roots[i].re) + &quot;\n&quot; + &quot;  roots[&quot; + <font color="red">String</font>(i + 1)
             + &quot;].re = &quot; + <font color="red">String</font>(roots[i].re) + &quot;\n&quot; +
            &quot;and the two values should be identical since conjugate complex pair required.&quot;);
          <font color="red">assert</font>(roots[i].im == -roots[i + 1].im,
            &quot;No conjugate complex zero pair\n&quot; + &quot;  roots[&quot; + <font color="red">String</font>(i) +
            &quot;].im = &quot; + <font color="red">String</font>(roots[i].im) + &quot;\n&quot; + &quot;  roots[&quot; + <font color="red">String</font>(i + 1)
             + &quot;].im = &quot; + <font color="red">String</font>(roots[i + 1].im) + &quot;\n&quot; +
            &quot;and the two values should be identical with opposite sign, since conjugate complex pair required.&quot;);
          p.c := <font color="red">Polynomial.Internal.mult</font>(
                p.c,
                nn,
                {1,-2*roots[i].re,roots[i].re^2 + roots[i].im^2},
                nc);
          i := i + 2;
          nn := nn + 2;
        <font color="blue">end if</font>;
      <font color="blue">end while</font>;
<textblock type="annotcomp" expanded="false">    <font color="blue">end </font>fromZeros</textblock>;

  <font color="blue">end </font>&#39;constructor&#39;</textblock>;

  <textblock type="packagesmall" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.'-'"><font color="blue">encapsulated </font><font color="blue">operator</font> &#39;-&#39;
    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.'-'.negate"><font color="blue">encapsulated </font><font color="blue">function</font> negate <font color="darkgreen">
      &quot;Unary minus (multiply polynomial by -1)&quot;</font>

      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;
      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p;
      <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> result(<font color="blue">redeclare </font>Real c[<font color="red">size</font>(p.c, 1)]) <font color="darkgreen">&quot;= -p&quot;</font>;
    <font color="blue">algorithm </font>
      result.c := -p.c;
    <font color="blue">end </font>negate</textblock>;

    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.'-'.subtract"><font color="blue">encapsulated </font><font color="blue">function</font> subtract <font color="darkgreen">
      &quot;Subtract two polynomials (p1 - p2)&quot;</font>
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p1;
      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p2;
      <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> result(<font color="blue">redeclare </font>Real c[<font color="red">max</font>(<font color="red">size</font>(p1.c, 1), <font color="red">size</font>(p2.c, 1))]) <font color="darkgreen">
        &quot;= p1 - p2&quot;</font>;
    <font color="blue">algorithm </font>
    <font color="darkgreen">// Auxiliary variables not used, to enforce function inlining</font>
      result.c := <font color="red">cat</font>(
            1,
            <font color="red">zeros</font>(<font color="red">max</font>(<font color="red">size</font>(p1.c, 1), <font color="red">size</font>(p2.c, 1)) - <font color="red">size</font>(p1.c, 1)),
            p1.c) - <font color="red">cat</font>(
            1,
            <font color="red">zeros</font>(<font color="red">max</font>(<font color="red">size</font>(p1.c, 1), <font color="red">size</font>(p2.c, 1)) - <font color="red">size</font>(p2.c, 1)),
            p2.c);
    <font color="blue">end </font>subtract</textblock>;
  <font color="blue">end </font>&#39;-&#39;</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.'+'"><font color="blue">encapsulated </font><font color="blue">operator function</font> &#39;+&#39; <font color="darkgreen">&quot;Add two polynomials (p1 + p2)&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

     <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p1;
     <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p2;
     <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> result(<font color="blue">redeclare </font>Real c[<font color="red">max</font>(<font color="red">size</font>(p1.c, 1), <font color="red">size</font>(p2.c, 1))]) <font color="darkgreen">
      &quot;= p1 + p2&quot;</font>;
  <font color="blue">algorithm </font>
    <font color="darkgreen">// Auxiliary variables not used, to enforce function inlining</font>
      result.c := <font color="red">cat</font>(
            1,
            <font color="red">zeros</font>(<font color="red">max</font>(<font color="red">size</font>(p1.c, 1), <font color="red">size</font>(p2.c, 1)) - <font color="red">size</font>(p1.c, 1)),
            p1.c) + <font color="red">cat</font>(
            1,
            <font color="red">zeros</font>(<font color="red">max</font>(<font color="red">size</font>(p1.c, 1), <font color="red">size</font>(p2.c, 1)) - <font color="red">size</font>(p2.c, 1)),
            p2.c);
  <font color="blue">end </font>&#39;+&#39;</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.'*'"><font color="blue">encapsulated </font><font color="blue">operator function</font> &#39;*&#39; <font color="darkgreen">
    &quot;Multiply two polynomials (p1 * p2)&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p1;
      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p2;
      <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> result(<font color="blue">redeclare </font>Real c[<font color="red">size</font>(p1.c, 1) + <font color="red">size</font>(p2.c, 1)
           - 1]) <font color="darkgreen">&quot;= p1 * p2&quot;</font>;
  <font color="blue">protected </font>
      Integer n1=<font color="red">size</font>(p1.c, 1);
      Integer n2=<font color="red">size</font>(p2.c, 1);
      Integer n3=n1 + n2 - 1;
      Real ck;
  <font color="blue">algorithm </font>
      <font color="blue">for </font>k<font color="blue"> in </font>1:n3<font color="blue"> loop</font>
        ck := 0.0;
        <font color="blue">for </font>j<font color="blue"> in </font><font color="red">max</font>(1, k + 1 - n2):<font color="red">min</font>(k, n1)<font color="blue"> loop</font>
          ck := ck + p1.c[j]*p2.c[k + 1 - j];
        <font color="blue">end for</font>;
        result.c[k] := ck;
      <font color="blue">end for</font>;
  <font color="blue">end </font>&#39;*&#39;</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.'/'"><font color="blue">encapsulated </font><font color="blue">operator function</font> &#39;/&#39;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.TransferFunction"
>Modelica_LinearSystems2.TransferFunction</A>;

      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p1;
      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p2;

      <font color="blue">output </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.TransferFunction"
>TransferFunction</A> tf(n=p1.c, d=p2.c);<font color="darkgreen">//only for tfpoly</font>
  <font color="blue">algorithm </font>

    <font color="red">  assert</font>(<font color="red">size</font>(p2.c, 1) &gt; 0,
        &quot;Denominator polynomial p2 must have at least one element, however\n&quot;
         + &quot;denominator is an empty polynomial. This is not allowed for p1/p2.&quot;);

  <font color="blue">end </font>&#39;/&#39;</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.'^'"><font color="blue">encapsulated </font><font color="blue">operator function</font> &#39;^&#39;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;
    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Utilities_Streams.html#Modelica.Utilities.Streams.print"
>Modelica.Utilities.Streams.print</A>;

      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p;
      <font color="blue">input </font>Integer n(min=0) = 1 <font color="darkgreen">&quot;p^n shall be computed&quot;</font>;
      <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> result(<font color="blue">redeclare </font>Real c[<font color="red">max</font>((<font color="red">size</font>(p.c, 1) - 1)*n + 1, 1)]) <font color="darkgreen">
      &quot;= p^n&quot;</font>;
  <font color="blue">protected </font>
      Integer n_p=<font color="red">size</font>(p.c, 1);
      Integer n_power_p=<font color="red">max</font>((n_p - 1)*n + 1, 1);
  <font color="blue">algorithm </font>
      <font color="blue">if </font>n == 0<font color="blue"> then</font>
        result.c := {1};
      <font color="blue">else</font>
        result.c[n_power_p - n_p + 1:n_power_p] := p.c;
        <font color="blue">for </font>i<font color="blue"> in </font>2:n<font color="blue"> loop</font>
          result.c := <font color="red">Polynomial.Internal.mult</font>(
                result.c,
                (n_p - 1)*(i - 1) + 1,
                p.c,
                n_power_p);
        <font color="blue">end for</font>;
      <font color="blue">end if</font>;
  <font color="blue">end </font>&#39;^&#39;</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.'=='"><font color="blue">encapsulated </font><font color="blue">operator function</font> &#39;==&#39; <font color="darkgreen">
    &quot;Check whether two polynomials are identical&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p1;
      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p2;
      <font color="blue">input </font>Real eps(min=0) = 0 <font color="darkgreen">
      &quot;Two coefficients c1 and c2 of the two polynomials are identical if abs(c1-c2) &lt;= eps&quot;</font>;
      <font color="blue">output </font>Boolean same <font color="darkgreen">&quot;=true, if identical&quot;</font>;
  <font color="blue">protected </font>
      Integer n1=<font color="red">size</font>(p1.c, 1);
      Integer n2=<font color="red">size</font>(p2.c, 1);
  <font color="blue">algorithm </font>
      <font color="blue">if </font>n1 == n2<font color="blue"> then</font>
        same := true;
        <font color="blue">for </font>i<font color="blue"> in </font>1:n1<font color="blue"> loop</font>
          <font color="blue">if </font><font color="red">abs</font>(p1.c[i] - p2.c[i]) &gt; eps<font color="blue"> then</font>
            same := false;
          <font color="blue">end if</font>;
        <font color="blue">end for</font>;
      <font color="blue">else</font>
        same := false;
      <font color="blue">end if</font>;
  <font color="blue">end </font>&#39;==&#39;</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.'String'"><font color="blue">encapsulated </font><font color="blue">operator function</font> &#39;String&#39; <font color="darkgreen">
    &quot;Transform Polynomial into a String representation&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p <font color="darkgreen">
      &quot;Polynomial to be transformed in a String representation&quot;</font>;
      <font color="blue">input </font>Integer significantDigits=6 <font color="darkgreen">
      &quot;Number of significant digits that are shown&quot;</font>;
      <font color="blue">input </font>String name=&quot;x&quot; <font color="darkgreen">&quot;Independent variable name used for printing&quot;</font>;
      <font color="blue">output </font>String s=&quot;&quot;;
  <font color="blue">protected </font>
      Boolean outputCoefficient;
      Integer power;
      Real ci;
      String v;
      Integer n=<font color="red">size</font>(p.c, 1);
      Boolean printZero=true;
  <font color="blue">algorithm </font>
      <font color="blue">if </font>n == 0<font color="blue"> then</font>
        s := &quot;0&quot;;
      <font color="blue">else</font>
        <font color="blue">for </font>i<font color="blue"> in </font>1:n<font color="blue"> loop</font>
          <font color="blue">if </font>p.c[i] &lt;&gt; 0<font color="blue"> and </font>printZero<font color="blue"> then</font>
            printZero := false;
          <font color="blue">end if</font>;

          <font color="blue">if </font>p.c[i] &lt;&gt; 0<font color="blue"> or </font>printZero<font color="blue"> then</font>
            power := n - i;
            ci := p.c[i];
            <font color="blue">if </font>i &gt; 1<font color="blue"> then</font>
              <font color="blue">if </font>ci &gt; 0<font color="blue"> then</font>
                s := s + &quot; + &quot;;
              <font color="blue">elseif </font>ci &lt; 0<font color="blue"> then</font>
                s := s + &quot; - &quot;;
                ci := <font color="red">abs</font>(ci);
              <font color="blue">end if</font>;
            <font color="blue">end if</font>;

            outputCoefficient := power == 0<font color="blue"> or </font>ci &lt;&gt; 1;
            <font color="blue">if </font>outputCoefficient<font color="blue"> then</font>
              s := s + <font color="red">String</font>(ci, significantDigits=significantDigits);
            <font color="blue">end if</font>;
            <font color="blue">if </font>outputCoefficient<font color="blue"> and </font>power &gt;= 1<font color="blue"> then</font>
              s := s + &quot;*&quot;;
            <font color="blue">end if</font>;
            <font color="blue">if </font>name == &quot;&quot;<font color="blue"> then</font>
              v := &quot;?&quot;;
            <font color="blue">else</font>
              v := name;
            <font color="blue">end if</font>;
            <font color="blue">if </font>power &gt;= 2<font color="blue"> then</font>
              s := s + v + &quot;^&quot; + <font color="red">String</font>(power);
            <font color="blue">elseif </font>power == 1<font color="blue"> then</font>
              s := s + v;
            <font color="blue">end if</font>;
          <font color="blue">end if</font>;
        <font color="blue">end for</font>;
      <font color="blue">end if</font>;
  <font color="blue">end </font>&#39;String&#39;</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.x"><font color="blue">encapsulated </font><font color="blue">function</font> x <font color="darkgreen">&quot;Generate a base polynomial y=x&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p(<font color="blue">redeclare </font>Real c[2]) <font color="darkgreen">&quot;Polynomial&quot;</font>;
  <font color="blue">algorithm </font>
    p.c := {1,0};
  <font color="blue">end </font>x</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.fitting"><font color="blue">encapsulated </font><font color="blue">function</font> fitting <font color="darkgreen">
    &quot;Computes a Polynomial that fits a set of data points in a least-squares sense&quot;</font>
    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

    <font color="blue">input </font>Real x[:] <font color="darkgreen">&quot;Abscissa data values&quot;</font>;
    <font color="blue">input </font>Real y[<font color="red">size</font>(x, 1)] <font color="darkgreen">&quot;Ordinate data values&quot;</font>;
    <font color="blue">input </font>Integer order(min=1) <font color="darkgreen">
      &quot;Order of desired polynomial that fits the data points (x,y)&quot;</font>;
    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p(<font color="blue">redeclare </font>Real c[order + 1]) <font color="darkgreen">
      &quot;Polynomial that fits the date points in a least squares sense&quot;</font>;

  <font color="blue">protected </font>
    Real V[<font color="red">size</font>(x, 1),order + 1] <font color="darkgreen">&quot;Vandermonde matrix&quot;</font>;
  <font color="blue">algorithm </font>
    <font color="darkgreen">  // Construct Vandermonde matrix</font>
    V[:, order + 1] := <font color="red">ones</font>(<font color="red">size</font>(x, 1));
    <font color="blue">for </font>j<font color="blue"> in </font>order:-1:1<font color="blue"> loop</font>
      V[:, j] := {x[i]*V[i, j + 1] <font color="blue">for </font>i<font color="blue"> in </font>1:<font color="red">size</font>(x, 1)};
    <font color="blue">end for</font>;

    <font color="darkgreen">  // Solve least squares problem</font>
    p.c := <font color="red">Modelica.Math.Matrices.leastSquares</font>(V, y);
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>fitting</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.degree"><font color="blue">encapsulated </font><font color="blue">function</font> degree <font color="darkgreen">&quot;Return degree of polynomial&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p;
    <font color="blue">output </font>Integer result <font color="darkgreen">&quot;Degree of polynomial p&quot;</font>;

  <font color="blue">algorithm </font>
    result := <font color="red">size</font>(p.c, 1) - 1;
  <font color="blue">end </font>degree</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.degree2"><font color="blue">encapsulated </font><font color="blue">function</font> degree2 <font color="darkgreen">&quot;Return degree of polynomial&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p;
    <font color="blue">output </font>Integer result <font color="darkgreen">&quot;Degree of polynomial p&quot;</font>;
  <font color="blue">protected </font>
    Integer s;
  <font color="blue">algorithm </font>
    s := <font color="red">size</font>(p.c, 1);
    <font color="blue">for </font>i<font color="blue"> in </font>1:s<font color="blue"> loop</font>
      <font color="darkgreen">                // added correct code for degree calculation</font>
      <font color="blue">if </font>p.c[i] &lt;&gt; 0<font color="blue"> then</font>
        result := s - i;
        break;
      <font color="blue">end if</font>;
    <font color="blue">end for</font>;
  <font color="blue">end </font>degree2</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.plot"><font color="blue">encapsulated </font><font color="blue">function</font> plot <font color="darkgreen">&quot;Plot polynomial y=p(x)&quot;</font>

    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;
    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Utilities_Strings.html#Modelica.Utilities.Strings"
>Modelica.Utilities.Strings</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p <font color="darkgreen">&quot;Polynomial to be plotted&quot;</font>;
    <font color="blue">input </font>Integer nPoints(min=2) = 200 <font color="darkgreen">&quot;Number of points&quot;</font>;
    <font color="blue">input </font>Boolean autoLabel=true <font color="darkgreen">&quot;= true, if automatically selected labels&quot;</font>;
    <font color="blue">input </font>String xLabel=&quot;&quot; <font color="darkgreen">&quot;Abszissa description, if autoLabel = false&quot;</font>;
    <font color="blue">input </font>String yLabel=&quot;&quot; <font color="darkgreen">&quot;Ordinate description, if autoLabel = false&quot;</font>;
    <font color="blue">input </font>Boolean autoRange=true <font color="darkgreen">
      &quot;= true, if abszissa range is automatically determined&quot;</font>;
    <font color="blue">input </font>Real x_min=-1.0 <font color="darkgreen">&quot;Minimum abszissa value, if autoRange = false&quot;</font>;
    <font color="blue">input </font>Real x_max=1.0 <font color="darkgreen">&quot;Maximum abszissa value, if autoRange = false&quot;</font>;
  <font color="blue">protected </font>
    Real x_min2;
    Real x_max2;
    Real dx;
    Real x[nPoints];
    Real y[nPoints];
    Boolean OK;
    String yLabel2;
    <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> p_zeros[:];
    <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> pd_zeros[:];
    <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> points[:];
    String argument=&quot;x&quot;;
  <font color="blue">algorithm </font>
  <font color="darkgreen">/* Determine suitable x_min and x_max:
        Plotted range should contain roots and extrema
     */</font>

    <font color="blue">if </font>autoRange<font color="blue"> then</font>

      x_min2 := -1;
      x_max2 := +1;
      <font color="blue">if </font><font color="red">size</font>(p.c, 1) &gt; 1<font color="blue"> then</font>
        p_zeros := <font color="red">Polynomial.roots</font>(p);
        pd_zeros := <font color="red">Polynomial.roots</font>(<font color="red">Polynomial.derivative</font>(p));
        points := <font color="red">cat</font>(
            1,
            p_zeros[:],
            pd_zeros[:]);

        x_min2 := points[1].re;
        x_max2 := points[1].re;
        <font color="blue">for </font>i<font color="blue"> in </font>2:<font color="red">size</font>(points, 1)<font color="blue"> loop</font>
          x_min2 := <font color="red">min</font>(x_min2, points[i].re);
          x_max2 := <font color="red">max</font>(x_max2, points[i].re);
        <font color="blue">end for</font>;

        <font color="blue">if </font>x_max2 &gt; x_min2<font color="blue"> then</font>
          x_min2 := x_min2 - 0.1*(x_max2 - x_min2);
          x_max2 := x_max2 + 0.1*(x_max2 - x_min2);
        <font color="blue">else</font>
          x_min2 := x_min2 - 1;
          x_max2 := x_max2 + 1;
        <font color="blue">end if</font>;
      <font color="blue">end if</font>;
    <font color="blue">else</font>
      x_min2 := x_min;
      x_max2 := x_max;
    <font color="blue">end if</font>;

    <font color="darkgreen">// Compute polynomial values</font>
    dx := (x_max2 - x_min2)/(nPoints - 1);
    x := x_min2:dx:x_max2;
    y := <font color="red">Polynomial.evaluate</font>(p, x);

    <font color="darkgreen">// Determine labels</font>
    <font color="blue">if </font>autoLabel<font color="blue"> then</font>
        yLabel2 := <font color="red">String</font>(p);
       <font color="blue">if </font><font color="red">Strings.length</font>(yLabel2) &gt;= 100<font color="blue"> then</font>
        yLabel2 := <font color="red">Strings.substring</font>(
            yLabel2,
            1,
            96) + &quot; ...&quot;;
      <font color="blue">end if</font>;
    <font color="blue">else</font>
      yLabel2 := yLabel;
    <font color="blue">end if</font>;

    <font color="darkgreen">// Plot Polynomial</font>
    OK := <font color="red">plotArray</font>(
        x,
        y,
        legend=yLabel2);

  <font color="blue">equation </font>

<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>plot</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.derivative"><font color="blue">encapsulated </font><font color="blue">function</font> derivative <font color="darkgreen">&quot;Derivative of Polynomial&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p;
    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> der_p(<font color="blue">redeclare </font>Real c[<font color="red">size</font>(p.c, 1) - 1]) <font color="darkgreen">
      &quot;Derivative of Polynomial p&quot;</font>;
  <font color="blue">protected </font>
    Integer n=<font color="red">size</font>(p.c, 1);
  <font color="blue">algorithm </font>
    <font color="blue">for </font>j<font color="blue"> in </font>1:n - 1<font color="blue"> loop</font>
      der_p.c[j] := p.c[j]*(n - j);
    <font color="blue">end for</font>;
  <font color="blue">end </font>derivative</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.integral"><font color="blue">encapsulated </font><font color="blue">function</font> integral <font color="darkgreen">&quot;Indefinite integral of Polynomial&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p <font color="darkgreen">&quot;Polynomial&quot;</font>;
    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> integral_p(<font color="blue">redeclare </font>Real c[<font color="red">size</font>(p.c, 1) + 1]) <font color="darkgreen">
      &quot;Indefinite integral of polynomial p&quot;</font>;
  <font color="blue">protected </font>
    Integer n=<font color="red">size</font>(p.c, 1) + 1 <font color="darkgreen">&quot;Number of coefficients of integral&quot;</font>;
  <font color="blue">algorithm </font>
    <font color="blue">for </font>j<font color="blue"> in </font>1:n - 1<font color="blue"> loop</font>
      integral_p.c[j] := p.c[j]/(n - j);
    <font color="blue">end for</font>;
    integral_p.c[n] := 0;
  <font color="blue">end </font>integral</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.evaluate"><font color="blue">encapsulated </font><font color="blue">function</font> evaluate <font color="darkgreen">
    &quot;Evaluate a Polynomial at a given (Real) abszissa value&quot;</font>
  annotation(derivative=<A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial.evaluate_der"
>Polynomial.evaluate_der</A>);
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p <font color="darkgreen">&quot;Polynomial to be evaluated&quot;</font>;
    <font color="blue">input </font>Real x <font color="darkgreen">&quot;Abszissa value&quot;</font>;
    <font color="blue">output </font>Real y <font color="darkgreen">&quot;Value of polynomial at x&quot;</font>;

  <font color="blue">protected </font>
    Integer n=<font color="red">size</font>(p.c, 1);
  <font color="blue">algorithm </font>
    y := p.c[1];
    <font color="blue">for </font>j<font color="blue"> in </font>2:n<font color="blue"> loop</font>
      y := p.c[j] + x*y;
    <font color="blue">end for</font>;
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>evaluate</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.evaluateMatrix"><font color="blue">encapsulated </font><font color="blue">function</font> evaluateMatrix <font color="darkgreen">
    &quot;Evaluate a Polynomial with a matrix argument&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p <font color="darkgreen">&quot;Polynomial to be evaluated&quot;</font>;
    <font color="blue">input </font>Real X[:,<font color="red">size</font>(X, 1)] <font color="darkgreen">&quot;Square matrix argument&quot;</font>;
    <font color="blue">output </font>Real Y[<font color="red">size</font>(X, 1),<font color="red">size</font>(X, 2)] <font color="darkgreen">&quot;Value of polynomial at X&quot;</font>;

  <font color="blue">protected </font>
    Integer n=<font color="red">size</font>(p.c, 1);
  <font color="blue">algorithm </font>
    Y := <font color="red">zeros</font>(<font color="red">size</font>(X, 1), <font color="red">size</font>(X, 2));
    <font color="blue">for </font>j<font color="blue"> in </font>1:n<font color="blue"> loop</font>
      Y := X*Y + <font color="red">diagonal</font>(p.c[j]*<font color="red">ones</font>(<font color="red">size</font>(X, 1)));
    <font color="blue">end for</font>;
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>evaluateMatrix</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.evaluateComplex"><font color="blue">encapsulated </font><font color="blue">function</font> evaluateComplex <font color="darkgreen">
    &quot;Evaluate a Polynomial at a given (Complex) abszissa value&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p <font color="darkgreen">&quot;Polynomial to be evaluated&quot;</font>;
    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> x <font color="darkgreen">&quot;Complex abszissa value&quot;</font>;
    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> y <font color="darkgreen">&quot;Complex value of polynomial at x&quot;</font>;
  <font color="blue">protected </font>
    Integer n=<font color="red">size</font>(p.c, 1);
  <font color="blue">algorithm </font>
    <font color="darkgreen">// Horners scheme for complex numbers</font>
    y := <font color="red">Complex</font>(p.c[1], 0);
    <font color="blue">for </font>j<font color="blue"> in </font>2:n<font color="blue"> loop</font>
      y := <font color="red">Complex</font>(p.c[j], 0) + x*y;
    <font color="blue">end for</font>;
  <font color="blue">end </font>evaluateComplex</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.derivativeValue"><font color="blue">encapsulated </font><font color="blue">function</font> derivativeValue <font color="darkgreen">
    &quot;Integral of polynomial p(x) from x_low to x_high&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;
    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Utilities_Streams.html#Modelica.Utilities.Streams.print"
>Modelica.Utilities.Streams.print</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p <font color="darkgreen">&quot;Polynomial&quot;</font>;
    <font color="blue">input </font>Real x <font color="darkgreen">&quot;Abszissa value&quot;</font>;
    <font color="blue">input </font>Integer i(min=1) = 1 <font color="darkgreen">
      &quot;i-th derivative to be evaluated; i=1 is first derivative&quot;</font>;
    <font color="blue">output </font>Real der_y <font color="darkgreen">&quot;Value of i-th derivative of polynomial at x&quot;</font>;
    <font color="darkgreen">// annotation(derivative(zeroDerivative=p, zeroDerivative=i)=Polynomial.Internal.derivativeValue_der);</font>
  <font color="blue">protected </font>
    Integer n=<font color="red">size</font>(p.c, 1);
  <font color="blue">algorithm </font>
    <font color="blue">if </font>i &gt; n - 1<font color="blue"> then</font>
      der_y := 0.0;
    <font color="blue">else</font>
      der_y := p.c[1]*<font color="red">product</font>(n - k <font color="blue">for </font>k<font color="blue"> in </font>1:i);
      <font color="blue">for </font>j<font color="blue"> in </font>2:n - i<font color="blue"> loop</font>
        der_y := p.c[j]*<font color="red">product</font>(n - j + 1 - k <font color="blue">for </font>k<font color="blue"> in </font>1:i) + x*der_y;
      <font color="blue">end for</font>;
    <font color="blue">end if</font>;
  <font color="blue">end </font>derivativeValue</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.integralValue"><font color="blue">encapsulated </font><font color="blue">function</font> integralValue <font color="darkgreen">
    &quot;Integral of polynomial p(x) from x_low to x_high&quot;</font>
  annotation(derivative=<A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial.integralValue_der"
>Polynomial.integralValue_der</A>);
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p <font color="darkgreen">&quot;Polynomial to be integrated&quot;</font>;
    <font color="blue">input </font>Real x_high <font color="darkgreen">&quot;High integrand value&quot;</font>;
    <font color="blue">input </font>Real x_low=0 <font color="darkgreen">&quot;Low integrand value, default 0&quot;</font>;
    <font color="blue">output </font>Real integral=0.0 <font color="darkgreen">&quot;Integral of polynomial p from x_low to x_high&quot;</font>;

  <font color="blue">protected </font>
    Integer n=<font color="red">size</font>(p.c, 1) <font color="darkgreen">&quot;Order of integrated polynomial&quot;</font>;
    Real y_low=0 <font color="darkgreen">&quot;value at lower integrand&quot;</font>;
  <font color="blue">algorithm </font>
    <font color="blue">for </font>j<font color="blue"> in </font>1:n<font color="blue"> loop</font>
      integral := x_high*(p.c[j]/(n - j + 1) + integral);
      y_low := x_low*(p.c[j]/(n - j + 1) + y_low);
    <font color="blue">end for</font>;
    integral := integral - y_low;
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>integralValue</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.roots"><font color="blue">encapsulated </font><font color="blue">function</font> roots <font color="darkgreen">
    &quot;Determine zeros of polynomial, i.e., points x with p(x)=0&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p <font color="darkgreen">&quot;Polynomial&quot;</font>;
    <font color="blue">input </font>Boolean printRoots=false <font color="darkgreen">&quot;= true, if roots shall be pretty printed&quot;</font>;
    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> result[:]=<font color="red">fill</font>(<font color="red">Complex</font>(0, 0),
        <font color="red">Polynomial.numberOfRoots</font>(p)) <font color="darkgreen">&quot;Roots of polynomial&quot;</font>;

  <font color="blue">algorithm </font>
    result := <font color="red">Polynomial.rootsOfNonZeroHighestCoefficientPolynomial</font>(p,
      <font color="red">Polynomial.numberOfRoots</font>(p));
    <font color="blue">if </font>printRoots<font color="blue"> then</font>
      <font color="red">Complex.Vectors.print</font>(&quot;&quot;, result);
    <font color="blue">end if</font>;
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>roots</textblock>;

    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.numberOfRoots"><font color="blue">encapsulated </font><font color="blue">function</font> numberOfRoots <font color="darkgreen">
    &quot;Determine number of roots of polynomial&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;
       <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p <font color="darkgreen">&quot;Polynomial&quot;</font>;
       <font color="blue">output </font>Integer result <font color="darkgreen">&quot;Number of roots of p&quot;</font>;
  <font color="blue">protected </font>
       Integer nc=<font color="red">size</font>(p.c, 1);
       Integer i;
    <font color="blue">algorithm </font>
    <font color="blue">if </font>nc &lt;= 1<font color="blue"> then</font>
         <font color="darkgreen">// no roots</font>
      result := 0;
    <font color="blue">else</font>
         <font color="darkgreen">// Remove all leading zero coefficients</font>
      i := 1;
      result := 0;
      <font color="blue">while </font>i &lt;= nc - 1<font color="blue"> loop</font>
        <font color="blue">if </font>p.c[i] &lt;&gt; 0.0<font color="blue"> then</font>
          result := nc - i;
          i := nc;
        <font color="blue">else</font>
          i := i + 1;
        <font color="blue">end if</font>;
      <font color="blue">end while</font>;
    <font color="blue">end if</font>;
    <font color="blue">end </font>numberOfRoots</textblock>;

    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.rootsOfNonZeroHighestCoefficientPolynomial"><font color="blue">encapsulated </font><font color="blue">function</font> rootsOfNonZeroHighestCoefficientPolynomial <font color="darkgreen">
    &quot;Determine zeros of polynomial where highest coefficient of polynomial is not zero&quot;</font>
    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Math_Matrices.html#Modelica.Math.Matrices"
>Modelica.Math.Matrices</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p <font color="darkgreen">&quot;Polynomial&quot;</font>;
      <font color="blue">input </font>Integer numberOfRoots <font color="darkgreen">&quot;Number of roots of polynomial&quot;</font>;
      <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> result[:]=<font color="red">fill</font>(<font color="red">Complex</font>(0, 0), numberOfRoots) <font color="darkgreen">
      &quot;Roots of polynomial&quot;</font>;
  <font color="blue">protected </font>
      Integer nc=<font color="red">size</font>(p.c, 1);
      Integer i_start=nc - numberOfRoots;
      Integer n=numberOfRoots;
      Real A[n,n] <font color="darkgreen">&quot;Companion matrix&quot;</font>;
      Real ev[n,2] <font color="darkgreen">&quot;Eigen values&quot;</font>;
                                            <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> j = <font color="red">Modelica_LinearSystems2.Math.Complex.j</font>();
    <font color="blue">algorithm </font>
      <font color="red">assert</font>(numberOfRoots &gt;= 0<font color="blue"> and </font>numberOfRoots &lt; nc,
        &quot;Argument numberOfRoots (= &quot; + <font color="red">String</font>(numberOfRoots) +
        &quot;) is not in the range\n&quot; + &quot;0 &lt;= numberOfRoots &lt;= &quot; + <font color="red">String</font>(nc - 1));
      <font color="red">assert</font>(p.c[i_start] &lt;&gt; 0, &quot;p.c[&quot; + <font color="red">String</font>(i_start) +
        &quot;] = 0. Probably wrong argument numberOfRoots (=&quot; + <font color="red">String</font>(
        numberOfRoots) + &quot;)&quot;);

      <font color="blue">if </font>numberOfRoots &gt; 0<font color="blue"> then</font>
        <font color="darkgreen">// companion matrix</font>
        A[1, :] := -p.c[i_start + 1:nc]/p.c[i_start];
        A[2:n, :] := [<font color="red">identity</font>(n - 1),<font color="red">zeros</font>(n - 1)];

        <font color="darkgreen">// roots are eigenvalues of companion matrix</font>
        ev := <font color="red">Matrices.eigenValues</font>(A);
        <font color="blue">for </font>i<font color="blue"> in </font>1:n<font color="blue"> loop</font>
          result[i] := ev[i, 1]+ j*ev[i, 2];
        <font color="blue">end for</font>;
      <font color="blue">end if</font>;
    <font color="blue">end </font>rootsOfNonZeroHighestCoefficientPolynomial</textblock>;

    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.evaluate_der"><font color="blue">encapsulated </font><font color="blue">function</font> evaluate_der <font color="darkgreen">
    &quot;Evaluate derivative of polynomial at a given abszissa value&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p <font color="darkgreen">&quot;Polynomial&quot;</font>;
      <font color="blue">input </font>Real x <font color="darkgreen">&quot;Abszissa value&quot;</font>;
      <font color="blue">input </font>Real dx <font color="darkgreen">&quot;Derivative of abszissa value, der(x)&quot;</font>;
      <font color="blue">output </font>Real dy <font color="darkgreen">&quot;Derivative value of polynomial at x&quot;</font>;
  <font color="blue">protected </font>
      Integer n=<font color="red">size</font>(p.c, 1);
    <font color="blue">algorithm </font>
      dy := p.c[1]*(n - 1);
      <font color="blue">for </font>j<font color="blue"> in </font>2:n - 1<font color="blue"> loop</font>
        dy := p.c[j]*(n - j) + x*dy;
      <font color="blue">end for</font>;
      dy := dy*dx;
    <font color="blue">end </font>evaluate_der</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.integralValue_der"><font color="blue">encapsulated </font><font color="blue">function</font> integralValue_der <font color="darkgreen">
    &quot;Evaluate derivative of integral of polynomial p(x) from x_low to x_high, assuming only x_high as time-dependent (Leibnitz rule)&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p <font color="darkgreen">&quot;Polynomial&quot;</font>;
    <font color="blue">input </font>Real x_high <font color="darkgreen">&quot;High integrand value&quot;</font>;
    <font color="blue">input </font>Real x_low=0 <font color="darkgreen">&quot;Low integrand value, default 0&quot;</font>;
    <font color="blue">input </font>Real dx_high <font color="darkgreen">&quot;High integrand value&quot;</font>;
    <font color="blue">input </font>Real dx_low=0 <font color="darkgreen">&quot;Low integrand value, default 0&quot;</font>;
    <font color="blue">output </font>Real dintegral=0.0 <font color="darkgreen">&quot;Integral of polynomial p from u_low to u_high&quot;</font>;
  <font color="blue">algorithm </font>
    dintegral := <font color="red">Polynomial.evaluate</font>(p, x_high)*dx_high;
  <font color="blue">end </font>integralValue_der</textblock>;

  <textblock type="packagesmall" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.Internal"><font color="blue">encapsulated </font><font color="blue">package</font> Internal <font color="darkgreen">
    &quot;Internal library of record Polynomial (should not be directly used by user)&quot;</font>
    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;
    <font color="blue">extends </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Icons_Library.html#Modelica.Icons.Library"
>Modelica.Icons.Library</A>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.Math.Polynomial.Internal.mult"><font color="blue">function</font> mult <font color="darkgreen">
      &quot;Multiply two polynomials (polynomials are defined by vectors)&quot;</font>
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Utilities_Streams.html#Modelica.Utilities.Streams.print"
>Modelica.Utilities.Streams.print</A>;

    <font color="blue">input </font>Real p1[:];
    <font color="blue">input </font>Integer n1 <font color="darkgreen">
        &quot;Number of coefficients of p1 to be used, i.e., (end-n1+1:end)&quot;</font>;
    <font color="blue">input </font>Real p2[:];
    <font color="blue">input </font>Integer n3_max <font color="darkgreen">&quot;Dimension of output vector&quot;</font>;
    <font color="blue">output </font>Real p3[n3_max];
    <font color="blue">protected </font>
    Integer n1_max = <font color="red">size</font>(p1,1);
    Integer n2=<font color="red">size</font>(p2,1);
    Integer n3=n1+n2-1;
    Real ck;
  <font color="blue">algorithm </font>
    <font color="blue">for </font>k<font color="blue"> in </font>1:n3<font color="blue"> loop</font>
       ck := 0.0;
       <font color="blue">for </font>j<font color="blue"> in </font><font color="red">max</font>(1,k+1-n2):<font color="red">min</font>(k,n1)<font color="blue"> loop</font>
         ck := ck + p1[n1_max - n1 + j]*p2[k + 1 - j];
       <font color="blue">end for</font>;
       p3[n3_max-n3+k] := ck;
    <font color="blue">end for</font>;
  <font color="blue">end </font>mult</textblock>;
  <font color="blue">end </font>Internal</textblock>;

<textblock type="annotcomp" expanded="false"><font color="blue">end </font>Polynomial;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE real<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.Math.Complex.real"></A><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>.real</H2>
<B>Real part of complex number</B><p>
<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A></TD><TD>c</TD><TD>&nbsp;</TD><TD>Complex number</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>r</TD><TD>= c.re </TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">encapsulated </font><font color="blue">function</font> real <font color="darkgreen">&quot;Real part of complex number&quot;</font>
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c <font color="darkgreen">&quot;Complex number&quot;</font>;
  <font color="blue">output </font>Real r <font color="darkgreen">&quot;= c.re &quot;</font>;
<font color="blue">algorithm </font>
  r := c.re;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>real;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE imag<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.Math.Complex.imag"></A><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>.imag</H2>
<B>imaginary part of complex number</B><p>
<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A></TD><TD>c</TD><TD>&nbsp;</TD><TD>Complex number</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>r</TD><TD>= c.im </TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">encapsulated </font><font color="blue">function</font> imag <font color="darkgreen">&quot;imaginary part of complex number&quot;</font>
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c <font color="darkgreen">&quot;Complex number&quot;</font>;
  <font color="blue">output </font>Real r <font color="darkgreen">&quot;= c.im &quot;</font>;
<font color="blue">algorithm </font>
  r := c.im;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>imag;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE exp<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.Math.Complex.exp"></A><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>.exp</H2>
<B>Exponential of complex number</B><p>
<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A></TD><TD>c1</TD><TD>&nbsp;</TD><TD>Complex number</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A></TD><TD>c2</TD><TD>= exp(c1)</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">encapsulated </font><font color="blue">function</font> exp <font color="darkgreen">&quot;Exponential of complex number&quot;</font>
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
  <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Math.html#Modelica.Math"
>Modelica.Math</A>;

  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c1 <font color="darkgreen">&quot;Complex number&quot;</font>;
  <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c2 <font color="darkgreen">&quot;= exp(c1)&quot;</font>;
<font color="blue">algorithm </font>
   c2 :=<font color="red"> Complex</font>(<font color="red">Math.exp</font>(c1.re)*<font color="red">Math.cos</font>(c1.im),<font color="red"> Math.exp</font>(c1.re)*<font color="red">Math.sin</font>(c1.im));
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>exp;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE evaluate_der<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.Math.Polynomial.evaluate_der"></A><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>.evaluate_der</H2>
<B>Evaluate derivative of polynomial at a given abszissa value</B><p>
<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A></TD><TD>p</TD><TD>&nbsp;</TD><TD>Polynomial</TD></TR>
<TR><TD>Real</TD><TD>x</TD><TD>&nbsp;</TD><TD>Abszissa value</TD></TR>
<TR><TD>Real</TD><TD>dx</TD><TD>&nbsp;</TD><TD>Derivative of abszissa value, der(x)</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>dy</TD><TD>Derivative value of polynomial at x</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">encapsulated </font><font color="blue">function</font> evaluate_der <font color="darkgreen">
  &quot;Evaluate derivative of polynomial at a given abszissa value&quot;</font>
<font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p <font color="darkgreen">&quot;Polynomial&quot;</font>;
  <font color="blue">input </font>Real x <font color="darkgreen">&quot;Abszissa value&quot;</font>;
  <font color="blue">input </font>Real dx <font color="darkgreen">&quot;Derivative of abszissa value, der(x)&quot;</font>;
  <font color="blue">output </font>Real dy <font color="darkgreen">&quot;Derivative value of polynomial at x&quot;</font>;
<font color="blue">protected </font>
  Integer n=<font color="red">size</font>(p.c, 1);
<font color="blue">algorithm </font>
  dy := p.c[1]*(n - 1);
  <font color="blue">for </font>j<font color="blue"> in </font>2:n - 1<font color="blue"> loop</font>
    dy := p.c[j]*(n - j) + x*dy;
  <font color="blue">end for</font>;
  dy := dy*dx;
<font color="blue">end </font>evaluate_der;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE integralValue_der<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.Math.Polynomial.integralValue_der"></A><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>.integralValue_der</H2>
<B>Evaluate derivative of integral of polynomial p(x) from x_low to x_high, assuming only x_high as time-dependent (Leibnitz rule)</B><p>
<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A></TD><TD>p</TD><TD>&nbsp;</TD><TD>Polynomial</TD></TR>
<TR><TD>Real</TD><TD>x_high</TD><TD>&nbsp;</TD><TD>High integrand value</TD></TR>
<TR><TD>Real</TD><TD>x_low</TD><TD>0</TD><TD>Low integrand value, default 0</TD></TR>
<TR><TD>Real</TD><TD>dx_high</TD><TD>&nbsp;</TD><TD>High integrand value</TD></TR>
<TR><TD>Real</TD><TD>dx_low</TD><TD>0</TD><TD>Low integrand value, default 0</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>dintegral</TD><TD>Integral of polynomial p from u_low to u_high</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">encapsulated </font><font color="blue">function</font> integralValue_der <font color="darkgreen">
  &quot;Evaluate derivative of integral of polynomial p(x) from x_low to x_high, assuming only x_high as time-dependent (Leibnitz rule)&quot;</font>
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> p <font color="darkgreen">&quot;Polynomial&quot;</font>;
  <font color="blue">input </font>Real x_high <font color="darkgreen">&quot;High integrand value&quot;</font>;
  <font color="blue">input </font>Real x_low=0 <font color="darkgreen">&quot;Low integrand value, default 0&quot;</font>;
  <font color="blue">input </font>Real dx_high <font color="darkgreen">&quot;High integrand value&quot;</font>;
  <font color="blue">input </font>Real dx_low=0 <font color="darkgreen">&quot;Low integrand value, default 0&quot;</font>;
  <font color="blue">output </font>Real dintegral=0.0 <font color="darkgreen">&quot;Integral of polynomial p from u_low to u_high&quot;</font>;
<font color="blue">algorithm </font>
  dintegral :=<font color="red"> Polynomial.evaluate</font>(p, x_high)*dx_high;
<font color="blue">end </font>integralValue_der;
</PRE>
<HR>
<address>HTML-documentation generated by <a href="http://www.Dymola.com/">Dymola</a> Fri Jan 15 12:28:53 2010.
</address></BODY>
</HTML>
