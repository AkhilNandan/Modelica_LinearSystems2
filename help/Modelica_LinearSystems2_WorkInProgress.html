<HTML>
<HEAD>
<TITLE>Modelica_LinearSystems2.WorkInProgress</TITLE>
<META name="HTML-Generator" content="Dymola">
<META name="description" content="&quot;Package for developments and internal models&quot;">
<style type="text/css">
*       { font-size: 10pt; font-family: Arial,sans-serif; }
pre     { font-size:  9pt; font-family: Courier,monospace;}
h4      { font-size: 10pt; font-weight: bold; color: green; }
h3      { font-size: 11pt; font-weight: bold; color: green; }
h2      { font-size: 13pt; font-weight: bold; color: green; }
address {                  font-weight: normal} 
td      { solid #000; vertical-align:top; }
th      { solid #000; vertical-align:top; font-weight: bold; }
table   { solid #000; border-collapse: collapse;}
</style>
</HEAD>
<BODY><P>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE WorkInProgress<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.WorkInProgress"></A><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>.WorkInProgress</H2>
<B>Package for developments and internal models</B>
<P>
<P><H3>Package Content</H3><p>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2 >
<TR><TH >Name</TH><TH>Description</TH></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.WorkInProgress.StateSpace2S.png" ALT="Modelica_LinearSystems2.WorkInProgress.StateSpace2" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>StateSpace2</A>
</TD><TD>Continuous state space description of a linear, time invariant differential equation system (data + operations)</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.WorkInProgress.StateSpace2S.png" ALT="Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace"
>DiscreteStateSpace</A>
</TD><TD>Discrete state space description of a linear, time invariant difference equation system (data + operations)</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.WorkInProgress.StateSpace2S.png" ALT="Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction"
>DiscreteTransferFunction</A>
</TD><TD>Discrete transfer function description of a single input, single output system (data + operations)</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.WorkInProgress.StateSpaceS.png" ALT="Modelica_LinearSystems2.WorkInProgress.StateSpace" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_WorkInProgress_StateSpace.html#Modelica_LinearSystems2.WorkInProgress.StateSpace"
>StateSpace</A>
</TD><TD>State space functions</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.WorkInProgress.StateSpaceS.png" ALT="Modelica_LinearSystems2.WorkInProgress.TransferFunction" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_WorkInProgress_TransferFunction.html#Modelica_LinearSystems2.WorkInProgress.TransferFunction"
>TransferFunction</A>
</TD><TD>&nbsp;</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.WorkInProgress.StateSpaceS.png" ALT="Modelica_LinearSystems2.WorkInProgress.Math" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_WorkInProgress_Math.html#Modelica_LinearSystems2.WorkInProgress.Math"
>Math</A>
</TD><TD>&nbsp;</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.WorkInProgress.StateSpaceS.png" ALT="Modelica_LinearSystems2.WorkInProgress.Icons" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_WorkInProgress_Icons.html#Modelica_LinearSystems2.WorkInProgress.Icons"
>Icons</A>
</TD><TD>Icons used in the Linear Systems library</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.WorkInProgress.StateSpaceS.png" ALT="Modelica_LinearSystems2.WorkInProgress.Controller" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_WorkInProgress_Controller.html#Modelica_LinearSystems2.WorkInProgress.Controller"
>Controller</A>
</TD><TD>&nbsp;</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.WorkInProgress.StateSpaceS.png" ALT="Modelica_LinearSystems2.WorkInProgress.Tests" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_WorkInProgress_Tests.html#Modelica_LinearSystems2.WorkInProgress.Tests"
>Tests</A>
</TD><TD>Functions to test the LinearSystems functions </TD></TR>
</TABLE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE StateSpace2<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_LinearSystems2.WorkInProgress.StateSpace2I.png" ALT="Modelica_LinearSystems2.WorkInProgress.StateSpace2" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_LinearSystems2.WorkInProgress.StateSpace2"></A><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress"
>Modelica_LinearSystems2.WorkInProgress</A>.StateSpace2</H2>
<B>Continuous state space description of a linear, time invariant differential equation system (data + operations)</B><p>
<P><H3>Information</H3></P>
<PRE></pre>
<p>
This record defines a linear time invariant differential
equation system in state space form:
</p>
<pre>    <b>der</b>(x) = A * x + B * u
        y  = C * x + D * u
</pre>
<p>
with
</p>
<ul>
<li> u - the input vector</li>
<li> y - the output vector</li>
<li> x - the state vector</li>
<li> A,B,C,D - matrices of appropriate dimensions</li>
</ul>
<pre></PRE><P>
Extends from <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Icons.html#Modelica.Icons.Record"
>Modelica.Icons.Record</A> (Icon for a record).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>der(x) = A*x + B*u;  y = C*x + D*u</TD></TR>
<TR><TD>Real</TD><TD>A[:, size(A, 1)]</TD><TD>&nbsp;</TD><TD>&nbsp;</TD></TR>
<TR><TD>Real</TD><TD>B[size(A, 1), :]</TD><TD>&nbsp;</TD><TD>&nbsp;</TD></TR>
<TR><TD>Real</TD><TD>C[:, size(A, 1)]</TD><TD>&nbsp;</TD><TD>&nbsp;</TD></TR>
<TR><TD>Real</TD><TD>D[size(C, 1), size(B, 2)]</TD><TD>&nbsp;</TD><TD>&nbsp;</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">record</font> StateSpace2 <font color="darkgreen">
  &quot;Continuous state space description of a linear, time invariant differential equation system (data + operations)&quot;</font>

  <font color="blue">extends </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Icons.html#Modelica.Icons.Record"
>Modelica.Icons.Record</A>;

  Real A[:,<font color="red">size</font>(A, 1)];
  Real B[<font color="red">size</font>(A, 1),:];
  Real C[:,<font color="red">size</font>(A, 1)];
  Real D[<font color="red">size</font>(C, 1),<font color="red">size</font>(B, 2)];

<font color="darkgreen">//   String uNames[size(B, 2)]=fill(&quot;&quot;, size(B, 2))  annotation(Dialog(group=&quot;Signal names&quot;));</font>
<font color="darkgreen">//   String yNames[size(C, 1)]=fill(&quot;&quot;, size(C, 1)) annotation(Dialog(group=&quot;Signal names&quot;));</font>
<font color="darkgreen">//   String xNames[size(A, 1)]=fill(&quot;&quot;, size(A, 1))  annotation(Dialog(group=&quot;Signal names&quot;));</font>

<textblock type="packagesmall" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.StateSpace2.'constructor'"><font color="blue">encapsulated </font><font color="blue">operator</font> &#39;constructor&#39; <font color="darkgreen">
    &quot;Default constructors for a StateSpace record&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.StateSpace2.'constructor'.fromABCDMatrices"><font color="blue">function</font> fromABCDMatrices <font color="darkgreen">
      &quot;Default constructor for a StateSpace record&quot;</font>
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>Modelica_LinearSystems2.WorkInProgress.StateSpace2</A>;

    <font color="blue">input </font>Real A[:,<font color="red">size</font>(A, 1)];
    <font color="blue">input </font>Real B[<font color="red">size</font>(A, 1),:];
    <font color="blue">input </font>Real C[:,<font color="red">size</font>(A, 1)];
    <font color="blue">input </font>Real D[<font color="red">size</font>(C, 1),<font color="red">size</font>(B, 2)];

      <font color="darkgreen">//     input String uNames[size(B, 2)]=fill(&quot;&quot;, size(B, 2));</font>
      <font color="darkgreen">//     input String yNames[size(C, 1)]=fill(&quot;&quot;, size(C, 1));</font>
      <font color="darkgreen">//     input String xNames[size(A, 2)]=fill(&quot;&quot;, size(A, 2));</font>

     <font color="blue">output </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>StateSpace2</A> result(
      <font color="blue">redeclare </font>Real A[<font color="red">size</font>(A, 1),<font color="red">size</font>(A, 2)],
      <font color="blue">redeclare </font>Real B[<font color="red">size</font>(B, 1),<font color="red">size</font>(B, 2)],
      <font color="blue">redeclare </font>Real C[<font color="red">size</font>(C, 1),<font color="red">size</font>(C, 2)],
      <font color="blue">redeclare </font>Real D[<font color="red">size</font>(D, 1),<font color="red">size</font>(D, 2)]);

      <font color="darkgreen">//       redeclare String uNames[size(B, 2)],</font>
      <font color="darkgreen">//       redeclare String yNames[size(C, 1)],</font>
      <font color="darkgreen">//       redeclare String xNames[size(A, 2)]);</font>

  <font color="blue">algorithm </font>
    result.A := A;
    result.B := B;
    result.C := C;
    result.D := D;
      <font color="darkgreen">//      result.uNames := uNames;</font>
      <font color="darkgreen">//      result.yNames := yNames;</font>
      <font color="darkgreen">//      result.xNames := xNames;</font>

<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>fromABCDMatrices</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.StateSpace2.'constructor'.fromReal"><font color="blue">function</font> fromReal <font color="darkgreen">
      &quot;Generate a StateSpace data record from a Real value&quot;</font>

      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>Modelica_LinearSystems2.WorkInProgress.StateSpace2</A>;

    <font color="blue">input </font>Real r <font color="darkgreen">&quot;Value of Real variable&quot;</font>;
    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>StateSpace2</A> ss(
      <font color="blue">redeclare </font>Real A[0,0],
      <font color="blue">redeclare </font>Real B[0,1],
      <font color="blue">redeclare </font>Real C[1,0],
      <font color="blue">redeclare </font>Real D[1,1]) <font color="darkgreen">&quot;= r&quot;</font>;

  <font color="blue">algorithm </font>
    ss.D[1, 1] := r;
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>fromReal</textblock>;

<font color="darkgreen">// algorithm</font>
<font color="darkgreen">//            // this is the contructor algorithm</font>
<font color="darkgreen">//   result.A := A;</font>
<font color="darkgreen">//   result.B := B;</font>
<font color="darkgreen">//   result.C := C;</font>
<font color="darkgreen">//   result.D := D;</font>
<font color="darkgreen">//   //end constructor;</font>

  <font color="blue">function</font> fromTransferFunction = 
      <A HREF="Modelica_LinearSystems2_Conversion.html#Modelica_LinearSystems2.TransferFunction.Conversion.toStateSpace"
>Modelica_LinearSystems2.TransferFunction.Conversion.toStateSpace</A>;
  <font color="blue">function</font> fromZerosAndPoles = 
      <A HREF="Modelica_LinearSystems2_Conversion.html#Modelica_LinearSystems2.ZerosAndPoles.Conversion.toStateSpace"
>Modelica_LinearSystems2.ZerosAndPoles.Conversion.toStateSpace</A>;

<textblock type="annotcomp" expanded="false"><font color="blue">end </font>&#39;constructor&#39;</textblock>;

<textblock type="packagesmall" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.StateSpace2.'-'"><font color="blue">encapsulated </font><font color="blue">operator</font> &#39;-&#39; <font color="darkgreen">
    &quot;Contains operators for subtraction of state space systems&quot;</font>

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.StateSpace2.'-'.subtract"><font color="blue">function</font> subtract <font color="darkgreen">
      &quot;Subtraction of two state space systems connected in parallel (= inputs are the same, outputs of the two systems are subtracted)&quot;</font>

      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>Modelica_LinearSystems2.WorkInProgress.StateSpace2</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>StateSpace2</A> ss1 <font color="darkgreen">&quot;State space system 1&quot;</font>;
    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>StateSpace2</A> ss2 <font color="darkgreen">&quot;State Space system 2 is subtracted from system 1&quot;</font>;
    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>StateSpace2</A> result(
      <font color="blue">redeclare </font>Real A[<font color="red">size</font>(ss1.A, 1) + <font color="red">size</font>(ss2.A, 1),<font color="red">size</font>(ss1.A, 2) + <font color="red">size</font>(
        ss2.A, 2)],
      <font color="blue">redeclare </font>Real B[<font color="red">size</font>(ss1.B, 1) + <font color="red">size</font>(ss2.B, 1),<font color="red">size</font>(ss1.B, 2)],
      <font color="blue">redeclare </font>Real C[<font color="red">size</font>(ss1.C, 1),<font color="red">size</font>(ss1.C, 2) + <font color="red">size</font>(ss2.C, 2)],
      <font color="blue">redeclare </font>Real D[<font color="red">size</font>(ss1.D, 1),<font color="red">size</font>(ss1.D, 2)]) <font color="darkgreen">&quot;= ss1 - ss2&quot;</font>;
    <font color="blue">protected </font>
    Integer nx1=<font color="red">size</font>(ss1.A, 1);
    Integer nx2=<font color="red">size</font>(ss2.A, 1);
  <font color="blue">algorithm </font>
    result.A := [ss1.A,<font color="red">zeros</font>(nx1, nx2); <font color="red">zeros</font>(nx2, nx1),ss2.A];
    result.B := [ss1.B; ss2.B];
    result.C := [ss1.C,-ss2.C];
    result.D := ss1.D - ss2.D;
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>subtract</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.StateSpace2.'-'.negate"><font color="blue">function</font> negate <font color="darkgreen">
      &quot;Unary minus (state space system where the output is multiplied by a gain of -1)&quot;</font>
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font>StateSpace = <A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>Modelica_LinearSystems2.WorkInProgress.StateSpace2</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>StateSpace</A> ss;
    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>StateSpace</A> result(
      <font color="blue">redeclare </font>Real A[<font color="red">size</font>(ss.A, 1),<font color="red">size</font>(ss.A, 2)],
      <font color="blue">redeclare </font>Real B[<font color="red">size</font>(ss.B, 1),<font color="red">size</font>(ss.B, 2)],
      <font color="blue">redeclare </font>Real C[<font color="red">size</font>(ss.C, 1),<font color="red">size</font>(ss.C, 2)],
      <font color="blue">redeclare </font>Real D[<font color="red">size</font>(ss.D, 1),<font color="red">size</font>(ss.D, 2)]) <font color="darkgreen">&quot;= -ss&quot;</font>;
  <font color="blue">algorithm </font>
    result.A := ss.A;
    result.B := ss.B;
    result.C := -ss.C;
    result.D := -ss.D;
  <font color="blue">end </font>negate</textblock>;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>&#39;-&#39;</textblock>;

<textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.StateSpace2.'+'"><font color="blue">encapsulated </font><font color="blue">operator function</font> &#39;+&#39; <font color="darkgreen">
    &quot;Parallel connection of two state space systems (= inputs are the same, outputs of the two systems are added)&quot;</font>
    <font color="blue">import </font>StateSpace = <A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>Modelica_LinearSystems2.WorkInProgress.StateSpace2</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>StateSpace</A> ss1 <font color="darkgreen">&quot;System 1&quot;</font>;
    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>StateSpace</A> ss2 <font color="darkgreen">&quot;System 2 is added in parallel to system 1&quot;</font>;
    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>StateSpace</A> result(
      <font color="blue">redeclare </font>Real A[<font color="red">size</font>(ss1.A, 1) +<font color="red"> size</font>(ss2.A, 1),<font color="red">size</font>(ss1.A, 2) +<font color="red"> size</font>(
        ss2.A, 2)],
      <font color="blue">redeclare </font>Real B[<font color="red">size</font>(ss1.B, 1) +<font color="red"> size</font>(ss2.B, 1),<font color="red">size</font>(ss1.B, 2)],
      <font color="blue">redeclare </font>Real C[<font color="red">size</font>(ss1.C, 1),<font color="red">size</font>(ss1.C, 2) +<font color="red"> size</font>(ss2.C, 2)],
      <font color="blue">redeclare </font>Real D[<font color="red">size</font>(ss1.D, 1),<font color="red">size</font>(ss1.D, 2)]) <font color="darkgreen">&quot;= ss1 + ss2&quot;</font>;
  <font color="blue">protected </font>
    Integer nx1=<font color="red">size</font>(ss1.A, 1);
    Integer nx2=<font color="red">size</font>(ss2.A, 1);
<font color="blue">algorithm </font>
    result.A := [ss1.A,<font color="red">zeros</font>(nx1, nx2);<font color="red"> zeros</font>(nx2, nx1),ss2.A];
    result.B := [ss1.B; ss2.B];
    result.C := [ss1.C,ss2.C];
    result.D := ss1.D + ss2.D;
  <font color="darkgreen">//end &#39;+&#39;;</font>
<font color="darkgreen">//  end add;</font>

<font color="blue">end </font>&#39;+&#39;</textblock>;

<textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.StateSpace2.'*'"><font color="blue">encapsulated </font><font color="blue">operator function</font> &#39;*&#39; <font color="darkgreen">
    &quot;Series connection of two state space systems&quot;</font>
    <font color="blue">import </font>StateSpace = <A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>Modelica_LinearSystems2.WorkInProgress.StateSpace2</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>StateSpace</A> ss1 <font color="darkgreen">&quot;System 1&quot;</font>;
    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>StateSpace</A> ss2 <font color="darkgreen">&quot;System 2&quot;</font>;
    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>StateSpace</A> result(
      <font color="blue">redeclare </font>Real A[<font color="red">size</font>(ss1.A, 1) +<font color="red"> size</font>(ss2.A, 1),<font color="red">size</font>(ss1.A, 2) +<font color="red"> size</font>(
        ss2.A, 2)],
      <font color="blue">redeclare </font>Real B[<font color="red">size</font>(ss1.B, 1) +<font color="red"> size</font>(ss2.B, 1),<font color="red">size</font>(ss2.B, 2)],
      <font color="blue">redeclare </font>Real C[<font color="red">size</font>(ss1.C, 1),<font color="red">size</font>(ss1.C, 2) +<font color="red"> size</font>(ss2.C, 2)],
      <font color="blue">redeclare </font>Real D[<font color="red">size</font>(ss1.D, 1),<font color="red">size</font>(ss2.D, 2)]) <font color="darkgreen">
      &quot;y = G(s)*u = G(ss1)*G(ss2)*u&quot;</font>;
  <font color="blue">protected </font>
    Integer nx1=<font color="red">size</font>(ss1.A, 1);
    Integer nx2=<font color="red">size</font>(ss2.A, 1);
<font color="blue">algorithm </font>
    result.A := [ss1.A,ss1.B*ss2.C;<font color="red"> zeros</font>(nx2, nx1),ss2.A];
    result.B := [ss1.B*ss2.D; ss2.B];
    result.C := [ss1.C,ss1.D*ss2.C];
    result.D := ss1.D*ss2.D;
<font color="darkgreen">//  end multiply;</font>

<font color="blue">end </font>&#39;*&#39;</textblock>;

<textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.StateSpace2.'=='"><font color="blue">encapsulated </font><font color="blue">operator function</font> &#39;==&#39; <font color="darkgreen">
    &quot;Check whether two linear systems have identical matrices&quot;</font>
    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Math_Matrices.html#Modelica.Math.Matrices.isEqual"
>Modelica.Math.Matrices.isEqual</A>;
    <font color="blue">import </font>StateSpace = <A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>Modelica_LinearSystems2.WorkInProgress.StateSpace2</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>StateSpace</A> ss1 <font color="darkgreen">&quot;System 1&quot;</font>;
    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>StateSpace</A> ss2 <font color="darkgreen">&quot;System 2&quot;</font>;
    <font color="blue">input </font>Real eps(min=0) = 0 <font color="darkgreen">
      &quot;Two elements e1 and e2 of the two systems are identical if abs(e1-e2) &lt;= eps&quot;</font>;
    <font color="blue">output </font>Boolean same <font color="darkgreen">&quot;=true, if the two systems are identical&quot;</font>;
<font color="blue">algorithm </font>
    same :=<font color="red"> isEqual</font>(
          ss1.A,
          ss2.A,
          eps)<font color="blue"> and </font><font color="red">isEqual</font>(
          ss1.B,
          ss2.B,
          eps)<font color="blue"> and </font><font color="red">isEqual</font>(
          ss1.C,
          ss2.C,
          eps)<font color="blue"> and </font><font color="red">isEqual</font>(
          ss1.D,
          ss2.D,
          eps);
<font color="blue">end </font>&#39;==&#39;</textblock>;

<textblock type="packagesmall" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.StateSpace2.Import"><font color="blue">encapsulated </font><font color="blue">package</font> Import <font color="darkgreen">
    &quot;Utilitiy functions to import StaeSpace representations&quot;</font>

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.StateSpace2.Import.fromFile"><font color="blue">encapsulated </font><font color="blue">function</font> fromFile <font color="darkgreen">
      &quot;Read a StateSpace data record from mat-file&quot;</font>

      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>Modelica_LinearSystems2.WorkInProgress.StateSpace2</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;

    <font color="blue">input </font>String fileName=&quot;dslin.mat&quot; <font color="darkgreen">
        &quot;Name of the state space system data file&quot;</font>;
    <font color="blue">input </font>String matrixName=&quot;ABCD&quot; <font color="darkgreen">&quot;Name of the state space system matrix&quot;</font>;
    <font color="blue">protected </font>
    <font color="blue">input </font>Integer xuy[3]=<font color="red">Modelica_LinearSystems2.StateSpace.Internal.readSystemDimension</font>(fileName, matrixName);
    <font color="blue">input </font>Integer nx=xuy[1];
    <font color="blue">input </font>Integer nu=xuy[2];
    <font color="blue">input </font>Integer ny=xuy[3];

    <font color="blue">public </font>
    <font color="blue">output </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.StateSpace2"
>StateSpace2</A> result(
      <font color="blue">redeclare </font>Real A[nx,nx],
      <font color="blue">redeclare </font>Real B[nx,nu],
      <font color="blue">redeclare </font>Real C[ny,nx],
      <font color="blue">redeclare </font>Real D[ny,nu]) <font color="darkgreen">&quot;= model linearized at initial point&quot;</font>;

    <font color="blue">protected </font>
    Real ABCD[nx + ny,nx + nu]=<font color="red">Modelica_LinearSystems2.Internal.Streams.readMatrixInternal</font>(
          fileName,
          matrixName,
          nx + ny,
          nx + nu);

  <font color="blue">algorithm </font>
    result.A := ABCD[1:nx, 1:nx];
    result.B := ABCD[1:nx, nx + 1:nx + nu];
    result.C := ABCD[nx + 1:nx + ny, 1:nx];
    result.D := ABCD[nx + 1:nx + ny, nx + 1:nx + nu];
    <font color="red">Modelica.Utilities.Streams.print</font>(&quot;StateSpace record loaded from file: \&quot;&quot;
       + fileName + &quot;\&quot;&quot;);

<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>fromFile</textblock>;

<textblock type="annotcomp" expanded="false">
<font color="blue">end </font>Import</textblock>;

<textblock type="annotcomp" expanded="false"><font color="blue">end </font>StateSpace2;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE DiscreteStateSpace<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_LinearSystems2.WorkInProgress.StateSpace2I.png" ALT="Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace"></A><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress"
>Modelica_LinearSystems2.WorkInProgress</A>.DiscreteStateSpace</H2>
<B>Discrete state space description of a linear, time invariant difference equation system (data + operations)</B><p>
<P><H3>Information</H3></P>
<PRE></pre>
<p>
This record defines a linear time invariant difference
equation system in state space form:
</p>
<pre>     <b>x</b>(Ts*(k+1)) = <b>A</b> * <b>x</b>(Ts*k) + <b>B</b> * <b>u</b>(Ts*k)
     <b>y</b>(Ts*k)     = <b>C</b> * <b>x</b>(Ts*k) + <b>D</b> * <b>u</b>(Ts*k)
     <b>x</b>_continuous(Ts*k) = <b>x</b>(Ts*k) + <b>B2</b> * <b>u</b>(Ts*k) 
</pre>
<p>
with
</p>
<ul>
<li> <b>Ts</b> - the sample time</li>
<li> <b>k</b> - the index of the actual sample instance (k=0,1,2,3,...)</li>
<li> <b>t</b> - the time</li>
<li> <b>u</b>(t) - the input vector,</li>
<li> <b>y</b>(t) - the output vector,</li>
<li> <b>x</b>(t) - the discrete state vector (x(t=Ts*0) is the initial state),</li>
<li> <b>x</b>_continuous(t) - the state vector of the continuous system
     from which the discrete block has been derived (details see below),</li>
<li> <b>A,B,C,D,B2</b> - matrices of appropriate dimensions.</li>
</ul>
<p>
A discrete system is usually derived by discretization from a 
continuous block, e.g., by function
LinearSystems.DiscreteStateSpace.fromStateSpace.
If the discretization method, e.g., the trapezoidal method,
accesses <b>actual and past</b> values of the input <b>u</b> 
(e.g. <b>u</b>(Ts*k), <b>u</b>(Ts*(k-1), <b>u</b>(Ts*(k-2))), 
a state transformation is needed to get the difference equation 
above where only the actual value <b>u</b>(Ts*k) is accessed. 
</p>
<p>
If the original continuous state vector should be computed
from the sampled data system above, the matrices of this 
transformation have to be known. For simplicity and efficiency,
here only the specific transformation used by function
LinearSystems.DiscreteStateSpace.fromStateSpace is stored in 
the data record of the discrete system via matrix <b>B2</b>.
Therefore, the state vector of the underlying continuous
system can be calculated by adding the term <b>B2</b>*<b>u</b> to the
state vector of the discretized system.
</p>
<p>
In Modelica notation, the difference equation above
can be implemented as:
</p>
<pre>
     <b>when</b> {<b>initial</b>(), <b>sample</b>(Ts,Ts)} <b>then</b>
        new_x = A * x + B * u;
            y = C * x + D * u;
            x = <b>pre</b>(new_x);
        x_continuous = x + B2 * u;
     <b>end when</b>;
</pre>
<p>
Since no "next value" operator is available in Modelica, an
auxiliary variable new_x stores the value of x for the
next sampling instant. The relationship between new_x and x
is defined via equation "x = <b>pre</b>(new_x)".
</p>
<p>
The body of the when-clause is active during initialization and at the
next sample instant t=Ts. Note, the when-equation is not
active after the initialization at t=0 (due to <b>sample</b>(Ts,Ts)), 
since the state x of the initialization has to be used also at t=0.
</p>
<p>
In library Blocks.<b>Controller</b> additional equations are
added for the initialization to uniquely compute the
initial vector x:
</p>
<pre>
  <b>initial equation</b> 
     <b>if</b> init == InitialState <b>then</b>
        x = x_start;
     <b>elseif</b> init == SteadyState <b>then</b>
        x = new_x;
     <b>end if</b>;
</pre>
<p>
Optionally, x is set to a given start vector x_start.
As <b>default initialization</b>, the equation "x = new_x" is
added that defines steady state initialization for the
discrete system. As a consequence, the output y(Ts*k), k=0,1,2,..,
remains constant after this initialization, 
provided the input vector u(Ts*k) remains constant.
</p>
<pre></PRE><P>
Extends from <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Icons.html#Modelica.Icons.Record"
>Modelica.Icons.Record</A> (Icon for a record).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>new_x = A*x + B*u;  y = C*x + D*u;  x_cont = x + B2*u</TD></TR>
<TR><TD>Real</TD><TD>A[:, size(A, 1)]</TD><TD>&nbsp;</TD><TD>&nbsp;</TD></TR>
<TR><TD>Real</TD><TD>B[size(A, 1), :]</TD><TD>&nbsp;</TD><TD>&nbsp;</TD></TR>
<TR><TD>Real</TD><TD>C[:, size(A, 1)]</TD><TD>&nbsp;</TD><TD>&nbsp;</TD></TR>
<TR><TD>Real</TD><TD>D[size(C, 1), size(B, 2)]</TD><TD>&nbsp;</TD><TD>&nbsp;</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Data used to construct discrete from continuous system</TD></TR>
<TR><TD><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>Ts</TD><TD>1</TD><TD>Sample time [s]</TD></TR>
<TR><TD>Real</TD><TD>B2[size(B, 1), size(B, 2)]</TD><TD>fill(0, size(B, 1), size(B, ...</TD><TD>Reconstruct continuous state</TD></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Types.html#Modelica_LinearSystems2.Types.Method"
>Method</A></TD><TD>method</TD><TD>Modelica_LinearSystems2.Type...</TD><TD>Discretization method</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">record</font> DiscreteStateSpace <font color="darkgreen">
  &quot;Discrete state space description of a linear, time invariant difference equation system (data + operations)&quot;</font>
  <font color="blue">extends </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Icons.html#Modelica.Icons.Record"
>Modelica.Icons.Record</A>;

  Real A[:,<font color="red">size</font>(A, 1)];
  Real B[<font color="red">size</font>(A, 1),:];
  Real C[:,<font color="red">size</font>(A, 1)];
  Real D[<font color="red">size</font>(C, 1),<font color="red">size</font>(B, 2)];

  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> Ts=1 <font color="darkgreen">&quot;Sample time&quot;</font>;
  Real B2[<font color="red">size</font>(B, 1),<font color="red">size</font>(B, 2)]=<font color="red">fill</font>(0,<font color="red">size</font>(B,1),<font color="red">size</font>(B,2)) <font color="darkgreen">
    &quot;Reconstruct continuous state&quot;</font>;
  <A HREF="Modelica_LinearSystems2_Types.html#Modelica_LinearSystems2.Types.Method"
>Modelica_LinearSystems2.Types.Method</A> method=Modelica_LinearSystems2.Types.Method.Trapezoidal <font color="darkgreen">
    &quot;Discretization method&quot;</font>;

  <textblock type="packagesmall" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace.'constructor'"><font color="blue">encapsulated </font><font color="blue">operator</font> &#39;constructor&#39;
    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace.'constructor'.fromMatrices"><font color="blue">function</font> fromMatrices <font color="darkgreen">
      &quot;Default constructor for a DiscreteStateSpace record&quot;</font>
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace"
>Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace</A>;

      <font color="blue">input </font>Real A[:,<font color="red">size</font>(A, 1)];
      <font color="blue">input </font>Real B[<font color="red">size</font>(A, 1),:];
      <font color="blue">input </font>Real C[:,<font color="red">size</font>(A, 1)];
      <font color="blue">input </font>Real D[<font color="red">size</font>(C, 1),<font color="red">size</font>(B, 2)];

      <font color="blue">input </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> Ts=1 <font color="darkgreen">&quot;Sample time&quot;</font>;
      <font color="blue">input </font>Real B2[:,:]=<font color="red">zeros</font>(<font color="red">size</font>(B, 1), <font color="red">size</font>(B, 2));
      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Types.html#Modelica_LinearSystems2.Types.Method"
>Modelica_LinearSystems2.Types.Method</A> method=Modelica_LinearSystems2.Types.Method.Trapezoidal <font color="darkgreen">
        &quot;Discretization methodDiscretization method&quot;</font>;
      <font color="blue">output </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace"
>DiscreteStateSpace</A> result(
        <font color="blue">redeclare </font>Real A[<font color="red">size</font>(A, 1),<font color="red">size</font>(A, 2)],
        <font color="blue">redeclare </font>Real B[<font color="red">size</font>(B, 1),<font color="red">size</font>(B, 2)],
        <font color="blue">redeclare </font>Real C[<font color="red">size</font>(C, 1),<font color="red">size</font>(C, 2)],
        <font color="blue">redeclare </font>Real D[<font color="red">size</font>(D, 1),<font color="red">size</font>(D, 2)],
        <font color="blue">redeclare </font>Real B2[<font color="red">size</font>(B2, 1),<font color="red">size</font>(B2, 2)]);
    <font color="blue">algorithm </font>
      result.A := A;
      result.B := B;
      result.C := C;
      result.D := D;

      result.B2 := B2;
      result.Ts := Ts;
      result.method := method;
    <font color="blue">end </font>fromMatrices</textblock>;

    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace.'constructor'.fromStateSpace"><font color="blue">function</font> fromStateSpace <font color="darkgreen">
      &quot;Transform a continuous into a discrete linear state space system&quot;</font>
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Types.html#Modelica_LinearSystems2.Types.Method"
>Modelica_LinearSystems2.Types.Method</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math_Matrices.html#Modelica_LinearSystems2.Math.Matrices.LU_solve2"
>Modelica_LinearSystems2.Math.Matrices.LU_solve2</A>;

      <font color="blue">input </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A> sc <font color="darkgreen">
        &quot;Continuous linear state space system&quot;</font>;
      <font color="blue">input </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> Ts <font color="darkgreen">&quot;Sample time&quot;</font>;
      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Types.html#Modelica_LinearSystems2.Types.Method"
>Modelica_LinearSystems2.Types.Method</A> method=Modelica_LinearSystems2.Types.Method.Trapezoidal <font color="darkgreen">
        &quot;Discretization method&quot;</font>;
      <font color="blue">output </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace"
>Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace</A> sd(
        <font color="blue">redeclare </font>Real A[<font color="red">size</font>(sc.A, 1),<font color="red">size</font>(sc.A, 2)],
        <font color="blue">redeclare </font>Real B[<font color="red">size</font>(sc.B, 1),<font color="red">size</font>(sc.B, 2)],
        <font color="blue">redeclare </font>Real C[<font color="red">size</font>(sc.C, 1),<font color="red">size</font>(sc.C, 2)],
        <font color="blue">redeclare </font>Real D[<font color="red">size</font>(sc.D, 1),<font color="red">size</font>(sc.D, 2)],
        <font color="blue">redeclare </font>Real B2[<font color="red">size</font>(sc.B, 1),<font color="red">size</font>(sc.B, 2)]) <font color="darkgreen">
        &quot;Discrete state space system&quot;</font>;

    <font color="blue">protected </font>
      Integer nx=<font color="red">size</font>(sc.A, 1) <font color="darkgreen">&quot;Number of states&quot;</font>;
      Integer nu=<font color="red">size</font>(sc.B, 2) <font color="darkgreen">&quot;Number of input signals&quot;</font>;
      Real LU[nx,nx] <font color="darkgreen">&quot;LU decomposition&quot;</font>;
      Integer pivots[nx] <font color="darkgreen">&quot;Pivots of LU decomposition&quot;</font>;
    <font color="blue">algorithm </font>
      sd.Ts := Ts;
      sd.method := method;

      <font color="blue">if </font>method == Method.ExplicitEuler<font color="blue"> then</font>
        <font color="darkgreen">    /*  der_x = A*x + B*u
             x = pre(x) + Ts*pre(der_x)
     */</font>
        sd.A := <font color="red">identity</font>(nx) + Ts*sc.A;
        sd.B := Ts*sc.B;
        sd.C := sc.C;
        sd.D := sc.D;
        sd.B2 := <font color="red">zeros</font>(nx, nu);

      <font color="blue">elseif </font>method == Method.ImplicitEuler<font color="blue"> then</font>
        <font color="darkgreen">    /*  der_x = A*x + B*u
             x = pre(x) + Ts*der_x 
     */</font>
        (LU,pivots) := <font color="red">Modelica_LinearSystems2.Math.Matrices.LU</font>(<font color="red">identity</font>(nx) -
          Ts*sc.A);
        sd.B2 := <font color="red">LU_solve2</font>(
              LU,
              pivots,
              Ts*sc.B);
        sd.A := <font color="red">LU_solve2</font>(
              LU,
              pivots,
              <font color="red">identity</font>(nx));
        sd.B := sd.A*sd.B2;
        sd.C := sc.C;
        sd.D := sd.C*sd.B2 + sc.D;

      <font color="blue">elseif </font>method == Method.Trapezoidal<font color="blue"> then</font>
        <font color="darkgreen">    /*  der_x = A*x + B*u
             x = pre_x + (Ts/2)*(pre_der_x + der_x); 
     */</font>
        (LU,pivots) := <font color="red">Modelica_LinearSystems2.Math.Matrices.LU</font>(<font color="red">identity</font>(nx) -
          (Ts/2)*sc.A);
        sd.B2 := <font color="red">LU_solve2</font>(
              LU,
              pivots,
              (Ts/2)*sc.B);
        sd.A := <font color="red">LU_solve2</font>(
              LU,
              pivots,
              <font color="red">identity</font>(nx) + (Ts/2)*sc.A);
        sd.B := sd.A*sd.B2 + sd.B2;
        sd.C := sc.C;
        sd.D := sd.C*sd.B2 + sc.D;

      <font color="blue">elseif </font>method == Method.StepExact<font color="blue"> then</font>
           <font color="darkgreen">/* x = phi*pre(x) + gamma*pre(u);
       y = C*x + D*u
    */</font>
        (sd.A,sd.B) := <font color="red">Modelica.Math.Matrices.integralExp</font>(
              sc.A,
              sc.B,
              Ts);
        sd.C := sc.C;
        sd.D := sc.D;
        sd.B2 := <font color="red">zeros</font>(nx, nu);

      <font color="blue">elseif </font>method == Method.RampExact<font color="blue"> then</font>
           <font color="darkgreen">/* x = phi*pre(x) + gamma*pre(u) + gamma1/Ts*(u - pre_u);
        -&gt; x = phi*pre(x) + (gamma - gamma1/Ts)*pre(u) + gamma1/Ts*u;
  z = x - gamma1/Ts*u
      leads to
        z = phi*pre(z) + phi*gamma1/Ts*pre(u) +gamma*pre(u) - gamma1/Ts*pre(u) 
       y = C*x + D*u
      -&gt; y = C*z + (D + C*gamma1/Ts)*u
      x = z + gamma1/Ts*u
    
    */</font>
        (sd.A,sd.B,sd.B2) := <font color="red">Modelica.Math.Matrices.integralExpT</font>(
              sc.A,
              sc.B,
              Ts);
        sd.B2 := sd.B2/Ts;
        sd.B := sd.A*sd.B2 + sd.B - sd.B2;
        sd.C := sc.C;
        sd.D := sd.C*sd.B2 + sc.D;

      <font color="blue">elseif </font>method == Method.ImpulseExact<font color="blue"> then</font>
           <font color="darkgreen">/* x = phi*pre(x) + phi*B*u;
        y = C*x
        (u = [1,0,1,1,0..,0])
      Limitations: The infinit impulses at t = kT is ignored in the mapping
    */</font>

        sd.A := <font color="red">Modelica.Math.Matrices.exp</font>(sc.A, Ts);
        sd.B := sd.A*sc.B;
        sd.C := sc.C;
        sd.D := sc.C*sc.B;
        sd.B2 := sc.B;

      <font color="blue">else</font>
        <font color="red">assert</font>(false, &quot;Argument method (= &quot; + <font color="red">String</font>(method) +
          &quot;) of makeDiscrete is wrong.&quot;);
      <font color="blue">end if</font>;
<textblock type="annotcomp" expanded="false">    <font color="blue">end </font>fromStateSpace</textblock>;

    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace.'constructor'.fromMatrices2"><font color="blue">encapsulated </font><font color="blue">function</font> fromMatrices2 <font color="darkgreen">
      &quot;Transform a continuous into a discrete linear state space system&quot;</font>
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Types.html#Modelica_LinearSystems2.Types.Method"
>Modelica_LinearSystems2.Types.Method</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math_Matrices.html#Modelica_LinearSystems2.Math.Matrices.LU_solve2"
>Modelica_LinearSystems2.Math.Matrices.LU_solve2</A>;

      <font color="blue">input </font>Real A[:,<font color="red">size</font>(A, 1)];
      <font color="blue">input </font>Real B[<font color="red">size</font>(A, 1),:];
      <font color="blue">input </font>Real C[:,<font color="red">size</font>(A, 1)];
      <font color="blue">input </font>Real D[<font color="red">size</font>(C, 1),<font color="red">size</font>(B, 2)];
      <font color="blue">input </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> Ts <font color="darkgreen">&quot;Sample time&quot;</font>;
      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Types.html#Modelica_LinearSystems2.Types.Method"
>Modelica_LinearSystems2.Types.Method</A> method=Modelica_LinearSystems2.Types.Method.Trapezoidal <font color="darkgreen">
        &quot;Discretization method&quot;</font>;
    <font color="darkgreen">//  input Modelica_LinearSystems2.Types method=Modelica_LinearSystems2.Types.Method.Trapezoidal</font>
      <font color="blue">output </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace"
>Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace</A> sd(
        <font color="blue">redeclare </font>Real A[<font color="red">size</font>(A, 1),<font color="red">size</font>(A, 2)],
        <font color="blue">redeclare </font>Real B[<font color="red">size</font>(B, 1),<font color="red">size</font>(B, 2)],
        <font color="blue">redeclare </font>Real C[<font color="red">size</font>(C, 1),<font color="red">size</font>(C, 2)],
        <font color="blue">redeclare </font>Real D[<font color="red">size</font>(D, 1),<font color="red">size</font>(D, 2)],
        <font color="blue">redeclare </font>Real B2[<font color="red">size</font>(B, 1),<font color="red">size</font>(B, 2)]) <font color="darkgreen">&quot;Discrete state space system&quot;</font>;

    <font color="blue">protected </font>
      Integer nx=<font color="red">size</font>(A, 1) <font color="darkgreen">&quot;Number of states&quot;</font>;
      Integer nu=<font color="red">size</font>(B, 2) <font color="darkgreen">&quot;Number of input signals&quot;</font>;
      Real LU[nx,nx] <font color="darkgreen">&quot;LU decomposition&quot;</font>;
      Integer pivots[nx] <font color="darkgreen">&quot;Pivots of LU decomposition&quot;</font>;
    <font color="blue">algorithm </font>
      sd.Ts := Ts;
      sd.method := method;

      <font color="blue">if </font>method == Method.ExplicitEuler<font color="blue"> then</font>
        <font color="darkgreen">    /*  der_x = A*x + B*u
             x = pre(x) + Ts*pre(der_x)
     */</font>
        sd.A := <font color="red">identity</font>(nx) + Ts*A;
        sd.B := Ts*B;
        sd.C := C;
        sd.D := D;
        sd.B2 := <font color="red">zeros</font>(nx, nu);

      <font color="blue">elseif </font>method == Method.ImplicitEuler<font color="blue"> then</font>
        <font color="darkgreen">    /*  der_x = A*x + B*u
             x = pre(x) + Ts*der_x 
     */</font>
        (LU,pivots) := <font color="red">Modelica_LinearSystems2.Math.Matrices.LU</font>(<font color="red">identity</font>(nx) -
          Ts*A);
        sd.B2 := <font color="red">LU_solve2</font>(
              LU,
              pivots,
              Ts*B);
        sd.A := <font color="red">LU_solve2</font>(
              LU,
              pivots,
              <font color="red">identity</font>(nx));
        sd.B := sd.A*sd.B2;
        sd.C := C;
        sd.D := sd.C*sd.B2 + D;

      <font color="blue">elseif </font>method == Method.Trapezoidal<font color="blue"> then</font>
        <font color="darkgreen">    /*  der_x = A*x + B*u
             x = pre_x + (Ts/2)*(pre_der_x + der_x); 
     */</font>
        (LU,pivots) := <font color="red">Modelica_LinearSystems2.Math.Matrices.LU</font>(<font color="red">identity</font>(nx) -
          (Ts/2)*A);
        sd.B2 := <font color="red">LU_solve2</font>(
              LU,
              pivots,
              (Ts/2)*B);
        sd.A := <font color="red">LU_solve2</font>(
              LU,
              pivots,
              <font color="red">identity</font>(nx) + (Ts/2)*A);
        sd.B := sd.A*sd.B2 + sd.B2;
        sd.C := C;
        sd.D := sd.C*sd.B2 + D;

      <font color="blue">elseif </font>method == Method.StepExact<font color="blue"> then</font>
           <font color="darkgreen">/* x = phi*pre(x) + gamma*pre(u);
       y = C*x + D*u
    */</font>
        (sd.A,sd.B) := <font color="red">Modelica.Math.Matrices.integralExp</font>(
              A,
              B,
              Ts);
        sd.C := C;
        sd.D := D;
        sd.B2 := <font color="red">zeros</font>(nx, nu);

      <font color="blue">elseif </font>method == Method.RampExact<font color="blue"> then</font>
           <font color="darkgreen">/* x = phi*pre(x) + gamma*pre(u) + gamma1/Ts*(u - pre_u);
        -&gt; x = phi*pre(x) + (gamma - gamma1/Ts)*pre(u) + gamma1/Ts*u;
  z = x - gamma1/Ts*u
      leads to
        z = phi*pre(z) + phi*gamma1/Ts*pre(u) +gamma*pre(u) - gamma1/Ts*pre(u) 
       y = C*x + D*u
      -&gt; y = C*z + (D + C*gamma1/Ts)*u
      x = z + gamma1/Ts*u
    
    */</font>
        (sd.A,sd.B,sd.B2) := <font color="red">Modelica.Math.Matrices.integralExpT</font>(
              A,
              B,
              Ts);
        sd.B2 := sd.B2/Ts;
        sd.B := sd.A*sd.B2 + sd.B - sd.B2;
        sd.C := C;
        sd.D := sd.C*sd.B2 + D;

      <font color="blue">elseif </font>method == Method.ImpulseExact<font color="blue"> then</font>
           <font color="darkgreen">/* x = phi*pre(x) + phi*B*u;
        y = C*x
        (u = [1,0,1,1,0..,0])
      Limitations: The infinit impulses at t = kT is ignored in the mapping
    */</font>

        sd.A := <font color="red">Modelica.Math.Matrices.exp</font>(A, Ts);
        sd.B := sd.A*B;
        sd.C := C;
        sd.D := C*B;
        sd.B2 := B;

      <font color="blue">else</font>
        <font color="red">assert</font>(false, &quot;Argument method (= &quot; + <font color="red">String</font>(method) +
          &quot;) of makeDiscrete is wrong.&quot;);
      <font color="blue">end if</font>;
<textblock type="annotcomp" expanded="false">    <font color="blue">end </font>fromMatrices2</textblock>;
  <font color="blue">end </font>&#39;constructor&#39;</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace.timeResponse"><font color="blue">encapsulated </font><font color="blue">function</font> timeResponse <font color="darkgreen">
    &quot;Compute time response of DiscreteStateSpace system&quot;</font>
    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace"
>Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace"
>DiscreteStateSpace</A> sd <font color="darkgreen">&quot;Linear system in discrete state space form&quot;</font>;
    <font color="blue">input </font>Real u[:,<font color="red">size</font>(sd.B, 2)]=<font color="red">ones</font>(3, <font color="red">size</font>(sd.B, 2)) <font color="darkgreen">
      &quot;System input (dimension: (input samples) x (number of inputs))&quot;</font>;
    <font color="blue">input </font>Real x0[<font color="red">size</font>(sd.A, 1)]=<font color="red">zeros</font>(<font color="red">size</font>(sd.A, 1)) <font color="darkgreen">&quot;Initial system state&quot;</font>;
    <font color="blue">output </font>Real y[<font color="red">size</font>(u, 1),<font color="red">size</font>(sd.C, 1)] <font color="darkgreen">
      &quot;System response (dimension: (input samples) x (number of outputs))&quot;</font>;
    <font color="blue">output </font>Real x_continuous[<font color="red">size</font>(u, 1),<font color="red">size</font>(sd.A, 1)] <font color="darkgreen">
      &quot;State trajectories (dimension: (input samples) x (number of states)&quot;</font>;

  <font color="blue">protected </font>
    Integer samples=<font color="red">size</font>(u, 1);
    Integer i;
    Real new_x[<font color="red">size</font>(sd.A, 1)];
    Real x[<font color="red">size</font>(sd.A, 1)]=x0;

  <font color="blue">algorithm </font>
    <font color="blue">for </font>i<font color="blue"> in </font>1:samples<font color="blue"> loop</font>
      new_x := sd.A*x + sd.B*u[i, :];
      y[i, :] := sd.C*x + sd.D*u[i, :];
      x_continuous[i, :] := x + sd.B2*u[i, :];
      x := new_x;
    <font color="blue">end for</font>;
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>timeResponse</textblock>;

  <textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace.initialResponse"><font color="blue">encapsulated </font><font color="blue">function</font> initialResponse <font color="darkgreen">
    &quot;Compute initial response of DiscreteStateSpace system&quot;</font>
    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace"
>Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace"
>DiscreteStateSpace</A> sd <font color="darkgreen">&quot;Linear system in discrete state space form&quot;</font>;
    <font color="blue">input </font>Real x0[<font color="red">size</font>(sd.A, 1)]=<font color="red">zeros</font>(<font color="red">size</font>(sd.A, 1)) <font color="darkgreen">&quot;Initial system state&quot;</font>;
    <font color="blue">input </font>Integer samples <font color="darkgreen">&quot;Number of samples&quot;</font>;
    <font color="blue">output </font>Real y[samples,<font color="red">size</font>(sd.C, 1)] <font color="darkgreen">
      &quot;System response (dimension: (input samples) x (number of outputs))&quot;</font>;
    <font color="blue">output </font>Real x_continuous[samples,<font color="red">size</font>(sd.A, 1)] <font color="darkgreen">
      &quot;State trajectories (dimension: (input samples) x (number of states)&quot;</font>;

  <font color="blue">protected </font>
    Integer i;
    Real new_x[<font color="red">size</font>(sd.A, 1)];
    Real x[<font color="red">size</font>(sd.A, 1)]=x0;

  <font color="blue">algorithm </font>
    <font color="blue">for </font>i<font color="blue"> in </font>1:samples<font color="blue"> loop</font>
      new_x := sd.A*x;
      y[i, :] := sd.C*x;
      x_continuous[i, :] := x;
      x := new_x;
    <font color="blue">end for</font>;
<textblock type="annotcomp" expanded="false">  <font color="blue">end </font>initialResponse</textblock>;

<textblock type="packagesmall" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace.Conversion"><font color="blue">encapsulated </font><font color="blue">package</font> Conversion <font color="darkgreen">
    &quot;Conversion functions from DiscreteStateSpace into DiscreteTransferFunction&quot;</font>
<textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace.Conversion.toDiscreteTransferFunction"><font color="blue">function</font> toDiscreteTransferFunction <font color="darkgreen">
      &quot;Generate a transfer function from a SISO state space representation&quot;</font>

      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.TransferFunction"
>Modelica_LinearSystems2.TransferFunction</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction"
>Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace"
>Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace</A>;

  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace"
>DiscreteStateSpace</A> dss <font color="darkgreen">&quot;DiscreteStateSpace object&quot;</font>;

  <font color="blue">output </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction"
>Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction</A> dtf <font color="darkgreen">
        &quot;DiscreteTransferFunction object&quot;</font>;

    <font color="blue">protected </font>
  <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>StateSpace</A> ss =<font color="red"> StateSpace</font>(dss.A,dss.B,dss.C,dss.D);
  <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.TransferFunction"
>TransferFunction</A> tf =<font color="red"> StateSpace.Conversion.toTransferFunction</font>(ss);

<font color="blue">algorithm </font>
  dtf :=<font color="red"> DiscreteTransferFunction</font>(n=tf.n, d=tf.d, Ts=dss.Ts, method=dss.method);

<textblock type="annotcomp" expanded="false"><font color="blue">end </font>toDiscreteTransferFunction</textblock>;
<font color="blue">end </font>Conversion</textblock>;

<textblock type="packagesmall" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace.Plot"><font color="blue">encapsulated </font><font color="blue">package</font> Plot <font color="darkgreen">
    &quot;Functions to plot discrete state space system responses&quot;</font>
<textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace.Plot.bodeSISO"><font color="blue">encapsulated </font><font color="blue">function</font> bodeSISO <font color="darkgreen">
      &quot;Plot bode plot of the corresponding discrete transfer function&quot;</font>
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace"
>Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction"
>Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction</A>;

  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace"
>DiscreteStateSpace</A> dss <font color="darkgreen">&quot;discrete state space system&quot;</font>;
  <font color="blue">input </font>Integer iu=1 <font color="darkgreen">&quot;index of input&quot;</font>;
  <font color="blue">input </font>Integer iy=1 <font color="darkgreen">&quot;index of output&quot;</font>;
  <font color="blue">input </font>Integer nPoints(min=2) = 200 <font color="darkgreen">&quot;Number of points&quot;</font>;
  <font color="blue">input </font>Boolean autoRange=true <font color="darkgreen">
        &quot;= true, if abszissa range is automatically determined&quot;</font>;
  <font color="blue">input </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Frequency"
>Modelica.SIunits.Frequency</A> f_min=0.1 <font color="darkgreen">
        &quot;Minimum frequency value, if autoRange = false&quot;</font>;
  <font color="blue">input </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Frequency"
>Modelica.SIunits.Frequency</A> f_max=10 <font color="darkgreen">
        &quot;Maximum frequency value, if autoRange = false&quot;</font>;

  <font color="blue">input </font>Boolean magnitude=true <font color="darkgreen">&quot;= true, to plot the magnitude of dtf&quot;</font>;
  <font color="blue">input </font>Boolean phase=true <font color="darkgreen">&quot;= true, to plot the pase of tf&quot;</font>;

  <font color="blue">extends </font><A HREF="Modelica_LinearSystems2_Internal.html#Modelica_LinearSystems2.Internal.PartialPlotFunction"
>Modelica_LinearSystems2.Internal.PartialPlotFunction</A>(defaultDiagram=
        <font color="red">Modelica_LinearSystems2.Internal.DefaultDiagramBodePlot</font>());

    <font color="blue">protected </font>
  <A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction"
>Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction</A> dtf <font color="darkgreen">
        &quot;Transfer functions to be plotted&quot;</font>;
  <A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace"
>DiscreteStateSpace</A> dss_siso(
    <font color="blue">redeclare </font>Real A[<font color="red">size</font>(dss.A, 1),<font color="red">size</font>(dss.A, 2)],
    <font color="blue">redeclare </font>Real B[<font color="red">size</font>(dss.B, 1),1],
    <font color="blue">redeclare </font>Real C[1,<font color="red">size</font>(dss.C, 2)],
    <font color="blue">redeclare </font>Real D[1,1],
    <font color="blue">redeclare </font>Real B2[<font color="red">size</font>(dss.B, 1),1]);

<font color="blue">algorithm </font>
  <font color="red">assert</font>(iu &lt;=<font color="red"> size</font>(dss.B, 2)<font color="blue"> and </font>iu &gt; 0, &quot;index for input is &quot; +<font color="red"> String</font>(iu) + &quot; which is not in [1, &quot;
     +<font color="red"> String</font>(<font color="red">size</font>(dss.B, 2)) + &quot;].&quot;);
  <font color="red">assert</font>(iy &lt;=<font color="red"> size</font>(dss.C, 1)<font color="blue"> and </font>iy &gt; 0, &quot;index for output is &quot; +<font color="red"> String</font>(iy) + &quot; which is not in [1, &quot;
     +<font color="red"> String</font>(<font color="red">size</font>(dss.C, 1)) + &quot;].&quot;);
  dss_siso :=<font color="red"> DiscreteStateSpace</font>(
    A=dss.A,
    B=<font color="red">matrix</font>(dss.B[:, iu]),
    C=<font color="red">transpose</font>(<font color="red">matrix</font>(dss.C[iy, :])),
    D=<font color="red">matrix</font>(dss.D[iy, iu]),
    B2=<font color="red">matrix</font>(dss.B2[:, iu]),
    Ts=dss.Ts,
    method=dss.method);
  dtf :=<font color="red"> DiscreteStateSpace.Conversion.toDiscreteTransferFunction</font>(dss_siso);

  <font color="red">DiscreteTransferFunction.Plot.bode</font>(
    dtf,
    nPoints,
    autoRange,
    f_min,
    f_max,
    magnitude,
    phase,
    defaultDiagram=defaultDiagram,
    device=device);

<textblock type="annotcomp" expanded="false"><font color="blue">end </font>bodeSISO</textblock>;

<font color="blue">end </font>Plot</textblock>;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>DiscreteStateSpace;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE DiscreteTransferFunction<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_LinearSystems2.WorkInProgress.StateSpace2I.png" ALT="Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction"></A><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress"
>Modelica_LinearSystems2.WorkInProgress</A>.DiscreteTransferFunction</H2>
<B>Discrete transfer function description of a single input, single output system (data + operations)</B><p>
<P><H3>Information</H3></P>
Extends from <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Icons.html#Modelica.Icons.Record"
>Modelica.Icons.Record</A> (Icon for a record).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>y = n*{s^m, ... , s, 1} / (d*{s^r, ... , s, 1}) * u</TD></TR>
<TR><TD>Real</TD><TD>n[:]</TD><TD>&nbsp;</TD><TD>Coefficients of numerator polynomial (in descending order)</TD></TR>
<TR><TD>Real</TD><TD>d[:]</TD><TD>&nbsp;</TD><TD>Coefficients of denominator polynomial (in descending order)</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Data used to construct discrete from continuous system</TD></TR>
<TR><TD><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>Ts</TD><TD>&nbsp;</TD><TD>Sample time [s]</TD></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Types.html#Modelica_LinearSystems2.Types.Method"
>Method</A></TD><TD>method</TD><TD>Modelica_LinearSystems2.Type...</TD><TD>Discretization method</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Signal names</TD></TR>
<TR><TD>String</TD><TD>uName</TD><TD>&quot;u&quot;</TD><TD>Name of input signal</TD></TR>
<TR><TD>String</TD><TD>yName</TD><TD>&quot;y&quot;</TD><TD>Name of output signal</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">record</font> DiscreteTransferFunction <font color="darkgreen">
  &quot;Discrete transfer function description of a single input, single output system (data + operations)&quot;</font>

  <font color="blue">extends </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Icons.html#Modelica.Icons.Record"
>Modelica.Icons.Record</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;

  Real n[:] <font color="darkgreen">&quot;Coefficients of numerator polynomial (in descending order)&quot;</font>;
  Real d[:] <font color="darkgreen">&quot;Coefficients of denominator polynomial (in descending order)&quot;</font>;

  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> Ts <font color="darkgreen">&quot;Sample time&quot;</font>;

  <A HREF="Modelica_LinearSystems2_Types.html#Modelica_LinearSystems2.Types.Method"
>Modelica_LinearSystems2.Types.Method</A> method=Modelica_LinearSystems2.Types.Method.Trapezoidal <font color="darkgreen">
    &quot;Discretization method&quot;</font>;

  String uName=&quot;u&quot; <font color="darkgreen">&quot;Name of input signal&quot;</font>;
  String yName=&quot;y&quot; <font color="darkgreen">&quot;Name of output signal&quot;</font>;

<font color="darkgreen">/* If the numerator polynomial has no coefficients, the transfer function
   is zero. The denominator polynomial must always have at
   least one coefficient, such as {1}
*/</font>

  <textblock type="packagesmall" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction.'constructor'"><font color="blue">encapsulated </font><font color="blue">operator</font> &#39;constructor&#39; <font color="darkgreen">
    &quot;Default constructor for a transfer function&quot;</font>
    <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.TransferFunction"
>Modelica_LinearSystems2.TransferFunction</A>;

    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction.'constructor'.fromReal"><font color="blue">function</font> fromReal <font color="darkgreen">
      &quot;Generate a DiscreteTransferFunction data record from a Real value&quot;</font>
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction"
>Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction</A>;

      <font color="blue">input </font>Real r <font color="darkgreen">&quot;Value of Real variable&quot;</font>;
      <font color="blue">input </font>String uName=&quot;&quot; <font color="darkgreen">&quot;input name&quot;</font>;
      <font color="blue">input </font>String yName=&quot;&quot; <font color="darkgreen">&quot;output name&quot;</font>;
      <font color="blue">output </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction"
>DiscreteTransferFunction</A> dtf(n={r}, d={1});

    <font color="blue">algorithm </font>
      dtf.uName := uName;
      dtf.yName := yName;
<textblock type="annotcomp" expanded="false">    <font color="blue">end </font>fromReal</textblock>;

      <textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction.'constructor'.fromArrays"><font color="blue">encapsulated </font><font color="blue">function</font> fromArrays <font color="darkgreen">
      &quot;Generate a DiscreteTransferFunction data record from numerator and denominator array&quot;</font>
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction"
>Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;

           <font color="blue">input </font>Real n[:] <font color="darkgreen">&quot;Coefficients of numerator polynomial&quot;</font>;
           <font color="blue">input </font>Real d[:] <font color="darkgreen">&quot;Coefficients of denominator polynomial&quot;</font>;
           <font color="blue">input </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> Ts <font color="darkgreen">&quot;Sample time&quot;</font>;
           <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Types.html#Modelica_LinearSystems2.Types.Method"
>Modelica_LinearSystems2.Types.Method</A> method=Modelica_LinearSystems2.Types.Method.Trapezoidal <font color="darkgreen">
        &quot;Discretization method&quot;</font>;

           <font color="blue">input </font>String uName = &quot;&quot; <font color="darkgreen">&quot;input name&quot;</font>;
           <font color="blue">input </font>String yName = &quot;&quot; <font color="darkgreen">&quot;output name&quot;</font>;

           <font color="blue">output </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction"
>DiscreteTransferFunction</A> dtf(<font color="blue">redeclare </font>Real n[<font color="red">size</font>(n, 1)], <font color="blue">redeclare </font>
          Real d[<font color="red">                                                                             size</font>(d, 1)]) <font color="darkgreen">
        &quot;Transfer function&quot;</font>;

      <font color="blue">algorithm </font>
      <font color="darkgreen">           //this is the constructor algorithm</font>
           <font color="red">assert</font>(<font color="red">size</font>(d, 1) &gt; 0, &quot;Input denominator d must have at least one element, however\n&quot;
              + &quot;d is an empty vector&quot;);
           dtf.n := n;
           dtf.d := d;
           dtf.Ts := Ts;
           dtf.method := method;
           dtf.uName := uName;
           dtf.yName := yName;
      <font color="blue">end </font>fromArrays</textblock>;

    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction.'constructor'.fromPolynomials"><font color="blue">function</font> fromPolynomials <font color="darkgreen">
      &quot;Generate a DiscreteTransferFunction data record from a numerator and denominator polynomial&quot;</font>
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction"
>Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;

      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> n <font color="darkgreen">&quot;Numerator polynomial&quot;</font>;
      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Polynomial</A> d <font color="darkgreen">&quot;Denominator polynomial&quot;</font>;
      <font color="blue">input </font>String uName=&quot;&quot; <font color="darkgreen">&quot;input name&quot;</font>;
      <font color="blue">input </font>String yName=&quot;&quot; <font color="darkgreen">&quot;output name&quot;</font>;
      <font color="blue">output </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction"
>DiscreteTransferFunction</A> dtf(n=n.c, d=d.c,uName=uName, yName=yName);

    <font color="blue">algorithm </font>

<textblock type="annotcomp" expanded="false">    <font color="blue">end </font>fromPolynomials</textblock>;

    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction.'constructor'.fromTransferFunction"><font color="blue">function</font> fromTransferFunction <font color="darkgreen">
      &quot;Generate a DiscreteTransferFunction data record from a continuous Transfer function&quot;</font>
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction"
>Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.TransferFunction"
>Modelica_LinearSystems2.TransferFunction</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace"
>Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace</A>;

      <font color="blue">input </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.TransferFunction"
>TransferFunction</A> tf <font color="darkgreen">&quot;continuous transfer function&quot;</font>;
      <font color="blue">input </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> Ts <font color="darkgreen">&quot;Sample time&quot;</font>;

      <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Types.html#Modelica_LinearSystems2.Types.Method"
>Modelica_LinearSystems2.Types.Method</A> method=Modelica_LinearSystems2.Types.Method.Trapezoidal <font color="darkgreen">
        &quot;Discretization method&quot;</font>;

      <font color="blue">output </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction"
>DiscreteTransferFunction</A> dtf;
    <font color="blue">protected </font>
      <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>StateSpace</A> ss = <font color="red">StateSpace</font>(tf);
      <A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace"
>Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace</A> dss=
                               <font color="red">Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace</font>(
                                                  ss,Ts,method);

    <font color="blue">algorithm </font>
      dtf := <font color="red">DiscreteStateSpace.Conversion.toDiscreteTransferFunction</font>(dss);
<textblock type="annotcomp" expanded="false">    <font color="blue">end </font>fromTransferFunction</textblock>;
  <font color="blue">end </font>&#39;constructor&#39;</textblock>;

    <textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction.'String'"><font color="blue">encapsulated </font><font color="blue">operator function</font> &#39;String&#39; <font color="darkgreen">
    &quot;Transform TransferFunction into a String representation&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Polynomial"
>Modelica_LinearSystems2.Math.Polynomial</A>;
    <font color="blue">import </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction"
>Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction</A>;

    <font color="blue">input </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction"
>DiscreteTransferFunction</A> dtf <font color="darkgreen">
      &quot;Discrete transfer function to be transformed in a String representation&quot;</font>;
    <font color="blue">input </font>Integer significantDigits=6 <font color="darkgreen">
      &quot;Number of significant digits that are shown&quot;</font>;
    <font color="blue">input </font>String name=&quot;z&quot; <font color="darkgreen">&quot;Independent variable name used for printing&quot;</font>;
    <font color="blue">output </font>String z=&quot;&quot;;
  <font color="blue">protected </font>
    Integer n_num=<font color="red">size</font>(dtf.n, 1) - 1;
    Integer n_den=<font color="red">size</font>(dtf.d, 1) - 1;
    Boolean numParenthesis;
    <font color="blue">algorithm </font>
    <font color="blue">if </font>n_num == -1<font color="blue"> then</font>
      z := &quot;0&quot;;
    <font color="blue">else</font>
      numParenthesis := n_num &gt; 0<font color="blue"> and </font><font color="blue">not </font>(n_den == 0<font color="blue"> and </font>dtf.d[1] == 1);
      <font color="blue">if </font>numParenthesis<font color="blue"> then</font>
        z := &quot;(&quot;;
      <font color="blue">end if</font>;
       z := z + <font color="red">String</font>(
            <font color="red">Polynomial</font>(dtf.n),
            significantDigits,
            name);

      <font color="blue">if </font>numParenthesis<font color="blue"> then</font>
        z := z + &quot;)&quot;;
      <font color="blue">end if</font>;
    <font color="blue">if </font>n_den &gt; 0<font color="blue"> or </font>dtf.d[1] &lt;&gt; 1<font color="blue"> then</font>
        <font color="blue">if </font>n_den &gt; 0<font color="blue"> then</font>
          z := z + &quot;/(&quot;;
        <font color="blue">else</font>
          z := z + &quot;/&quot;;
        <font color="blue">end if</font>;

        z := z + <font color="red">String</font>(
              <font color="red">Polynomial</font>(dtf.d),
              significantDigits,
              name);

        <font color="blue">if </font>n_den &gt; 0<font color="blue"> then</font>
          z := z + &quot;)&quot;;
        <font color="blue">end if</font>;
      <font color="blue">end if</font>;
    <font color="blue">end if</font>;
    <font color="blue">end </font>&#39;String&#39;</textblock>;

<textblock type="packagesmall" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction.Plot"><font color="blue">encapsulated </font><font color="blue">package</font> Plot <font color="darkgreen">
    &quot;Functions to plot state space system responses&quot;</font>

<textblock type="model" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction.Plot.bode"><font color="blue">encapsulated </font><font color="blue">function</font> bode <font color="darkgreen">&quot;Plot transfer function as bode plot&quot;</font>
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
      <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Utilities_Strings.html#Modelica.Utilities.Strings"
>Modelica.Utilities.Strings</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Internal.html#Modelica_LinearSystems2.Internal"
>Modelica_LinearSystems2.Internal</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.TransferFunction"
>Modelica_LinearSystems2.TransferFunction</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction"
>Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction</A>;
      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;

      <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Utilities_Plot.html#Modelica_LinearSystems2.Utilities.Plot"
>Modelica_LinearSystems2.Utilities.Plot</A>;

      <font color="blue">import </font>SI = <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits"
>Modelica.SIunits</A>;

  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction"
>DiscreteTransferFunction</A> dtf <font color="darkgreen">&quot;DiscreteTransfer function to be plotted&quot;</font>;
  <font color="blue">input </font>Integer nPoints(min=2) = 200 <font color="darkgreen">&quot;Number of points&quot;</font>;
  <font color="blue">input </font>Boolean autoRange=true <font color="darkgreen">
        &quot;= true, if abszissa range is automatically determined&quot;</font>;
  <font color="blue">input </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Frequency"
>Modelica.SIunits.Frequency</A> f_min(min=0) = 0.1 <font color="darkgreen">
        &quot;Minimum frequency value, if autoRange = false&quot;</font>;
  <font color="blue">input </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Frequency"
>Modelica.SIunits.Frequency</A> f_max(min=0) = 10 <font color="darkgreen">
        &quot;Maximum frequency value, if autoRange = false&quot;</font>;

  <font color="blue">input </font>Boolean magnitude=true <font color="darkgreen">&quot;= true, to plot the magnitude of tf&quot;</font>;
  <font color="blue">input </font>Boolean phase=true <font color="darkgreen">&quot;= true, to plot the pase of tf&quot;</font>;

  <font color="blue">extends </font><A HREF="Modelica_LinearSystems2_Internal.html#Modelica_LinearSystems2.Internal.PartialPlotFunction"
>Modelica_LinearSystems2.Internal.PartialPlotFunction</A>(defaultDiagram=
        <font color="red">Modelica_LinearSystems2.Internal.DefaultDiagramBodePlot</font>(heading=&quot;Bode plot of  dtf = &quot;
         +<font color="red"> String</font>(dtf)));

    <font color="blue">protected </font>
  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.AngularVelocity"
>SI.AngularVelocity</A> w[nPoints];
  <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> z[nPoints];
  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Frequency"
>SI.Frequency</A> f[nPoints];
  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits_Conversions_NonSIunits.html#Modelica.SIunits.Conversions.NonSIunits.Angle_deg"
>Modelica.SIunits.Conversions.NonSIunits.Angle_deg</A> phi[nPoints];
  Real A[nPoints];
  Boolean OK;
  <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> c;
  <A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>Modelica.SIunits.Angle</A> phi_old;
  <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> numZeros[:];
  <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> denZeros[:];
  <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> numZerosZ[:];
  <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> denZerosZ[:];
  <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.TransferFunction"
>TransferFunction</A> tf=<font color="red">TransferFunction</font>(n=dtf.n, d=dtf.d);

  <A HREF="Modelica_LinearSystems2_Utilities_Plot_Records.html#Modelica_LinearSystems2.Utilities.Plot.Records.Curve"
>Plot.Records.Curve</A> curves[2];
  Integer i;
  <A HREF="Modelica_LinearSystems2_Utilities_Plot_Records.html#Modelica_LinearSystems2.Utilities.Plot.Records.Diagram"
>Plot.Records.Diagram</A> diagram2[2];

<font color="blue">algorithm </font>
      <font color="darkgreen">  // Determine frequency vector f</font>
  <font color="blue">if </font>autoRange<font color="blue"> then</font>
    (numZerosZ,denZerosZ) :=<font color="red"> TransferFunction.Analysis.zerosAndPoles</font>(tf);
  <font color="blue">else</font>
    numZerosZ :=<font color="red"> fill</font>(<font color="red">Complex</font>(0), 0);
    denZerosZ :=<font color="red"> fill</font>(<font color="red">Complex</font>(0), 0);
  <font color="blue">end if</font>;

  numZeros :=<font color="red"> fill</font>(<font color="red">Complex</font>(0),0);
 <font color="darkgreen">// numZeros := fill(Complex(0),size(numZerosZ,1));</font>
  <font color="darkgreen">// for i in 1:size(numZerosZ,1) loop</font>
  <font color="darkgreen">//   numZeros[i] := Complex.log(numZerosZ[i])/dtf.Ts;</font>
  <font color="darkgreen">// end for;</font>

  denZeros :=<font color="red"> fill</font>(<font color="red">Complex</font>(0),<font color="red">size</font>(denZerosZ,1));
  <font color="blue">for </font>i<font color="blue"> in </font>1:<font color="red">size</font>(denZerosZ,1)<font color="blue"> loop</font>
    denZeros[i] :=<font color="red"> Complex.log</font>(denZerosZ[i])/dtf.Ts;
  <font color="blue">end for</font>;

  f :=<font color="red"> Internal.frequencyVector</font>(
        nPoints,
        autoRange,
        f_min,
        f_max,
        numZeros,
        denZeros);

  <font color="darkgreen">// Compute magnitude/phase at the frequency points</font>
  phi_old := 0.0;
  <font color="blue">for </font>i<font color="blue"> in </font>1:nPoints<font color="blue"> loop</font>
    w[i] :=<font color="red"> Modelica.SIunits.Conversions.from_Hz</font>(f[i]);
    z[i] :=<font color="red"> Complex.exp</font>(<font color="red">Complex</font>(0,w[i]*dtf.Ts));
    c :=<font color="red"> TransferFunction.Analysis.evaluate</font>(
          tf,
          z[i],
          1e-10);
    A[i] :=<font color="red"> Complex.&#39;abs&#39;</font>(c);
    phi_old :=<font color="red"> Complex.arg</font>(c, phi_old);
    phi[i] :=<font color="red"> Modelica.SIunits.Conversions.to_deg</font>(phi_old);

  <font color="blue">end for</font>;

 <font color="darkgreen">// Plot computed frequency response</font>
 diagram2 :=<font color="red"> fill</font>(defaultDiagram, 2);
  i := 0;
  <font color="blue">if </font>magnitude<font color="blue"> then</font>
    i := i + 1;
    curves[i] :=<font color="red"> Plot.Records.Curve</font>(
          x=f,
          y=A,
          autoLine=true);
    diagram2[i].curve := {curves[i]};
    diagram2[i].yLabel := &quot;magnitude&quot;;
    <font color="blue">if </font>phase<font color="blue"> then</font>
       diagram2[i].xLabel:=&quot;&quot;;
    <font color="blue">end if</font>;
  <font color="blue">end if</font>;

  <font color="blue">if </font>phase<font color="blue"> then</font>
    i := i + 1;
    curves[i] :=<font color="red"> Plot.Records.Curve</font>(
          x=f,
          y=phi,
          autoLine=true);
    diagram2[i].curve := {curves[i]};
    diagram2[i].yLabel := &quot;phase [deg]&quot;;
    diagram2[i].logY := false;
    <font color="blue">if </font>magnitude<font color="blue"> then</font>
      diagram2[i].heading:=&quot;&quot;;
   <font color="blue">end if</font>;
  <font color="blue">end if</font>;

    <font color="blue">if </font>magnitude<font color="blue"> and </font>phase<font color="blue"> then</font>
      <font color="red">Plot.diagramVector</font>(diagram2, device);
    <font color="blue">else</font>
      <font color="red">Plot.diagram</font>(diagram2[1], device);
    <font color="blue">end if</font>;

<textblock type="annotcomp" expanded="false"><font color="blue">end </font>bode</textblock>;

<font color="blue">end </font>Plot</textblock>;

<textblock type="packagesmall" expanded="false" path="Modelica_LinearSystems2.WorkInProgress.DiscreteTransferFunction.Analysis"><font color="blue">encapsulated </font><font color="blue">package</font> Analysis

<font color="blue">end </font>Analysis</textblock>;

<font color="blue">end </font>DiscreteTransferFunction;
</PRE>
<HR>
<address>HTML-documentation generated by <a href="http://www.Dymola.com/">Dymola</a> Fri Jan 15 12:29:01 2010.
</address></BODY>
</HTML>
