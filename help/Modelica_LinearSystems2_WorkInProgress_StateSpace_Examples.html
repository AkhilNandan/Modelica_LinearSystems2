<HTML>
<HEAD>
<TITLE>Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples</TITLE>
<META name="HTML-Generator" content="Dymola">
<style type="text/css">
*       { font-size: 10pt; font-family: Arial,sans-serif; }
pre     { font-size:  9pt; font-family: Courier,monospace;}
h4      { font-size: 10pt; font-weight: bold; color: green; }
h3      { font-size: 11pt; font-weight: bold; color: green; }
h2      { font-size: 13pt; font-weight: bold; color: green; }
address {                  font-weight: normal} 
td      { solid #000; vertical-align:top; }
th      { solid #000; vertical-align:top; font-weight: bold; }
table   { solid #000; border-collapse: collapse;}
</style>
</HEAD>
<BODY><P>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Examples<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples"></A><A HREF="Modelica_LinearSystems2_WorkInProgress_StateSpace.html#Modelica_LinearSystems2.WorkInProgress.StateSpace"
>Modelica_LinearSystems2.WorkInProgress.StateSpace</A>.Examples</H2>
<P><H3>Package Content</H3><p>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2 >
<TR><TH >Name</TH><TH>Description</TH></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.WorkInProgress.StateSpace.Internal.xBaseS.png" ALT="Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.designCraneController" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_WorkInProgress_StateSpace_Examples.html#Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.designCraneController"
>designCraneController</A>
</TD><TD>Design pole assignment and LQ controller for an overhead crane</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.WorkInProgress.StateSpace.Internal.xBaseS.png" ALT="Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.designCraneControllerWithObserver" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_WorkInProgress_StateSpace_Examples.html#Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.designCraneControllerWithObserver"
>designCraneControllerWithObserver</A>
</TD><TD>Design pole assignment controller and observer for an overhead crane</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.WorkInProgress.StateSpace.Internal.xBaseS.png" ALT="Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.designInverseDoublePendulumController" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_WorkInProgress_StateSpace_Examples.html#Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.designInverseDoublePendulumController"
>designInverseDoublePendulumController</A>
</TD><TD>Design pole assignment for an inverse double pedulum</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.WorkInProgress.StateSpace.Internal.xBaseS.png" ALT="Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.designInverseDoublePendulumControllerWithObserver" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_WorkInProgress_StateSpace_Examples.html#Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.designInverseDoublePendulumControllerWithObserver"
>designInverseDoublePendulumControllerWithObserver</A>
</TD><TD>Design pole assignment for an inverse double pedulum</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.WorkInProgress.StateSpace.Internal.xBaseS.png" ALT="Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.designInversePendulumController" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_WorkInProgress_StateSpace_Examples.html#Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.designInversePendulumController"
>designInversePendulumController</A>
</TD><TD>Design pole assignment for an inverse pedulum</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.WorkInProgress.StateSpace.Internal.xBaseS.png" ALT="Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.designStateSpaceController" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_WorkInProgress_StateSpace_Examples.html#Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.designStateSpaceController"
>designStateSpaceController</A>
</TD><TD>Demonstration of controller design for a state space system</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.WorkInProgress.StateSpace.Internal.xBaseS.png" ALT="Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.analysis2" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_WorkInProgress_StateSpace_Examples.html#Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.analysis2"
>analysis2</A>
</TD><TD>Example to check controllability of a state space system</TD></TR>
<TR><TD><IMG SRC="Modelica_LinearSystems2.WorkInProgress.StateSpace.Internal.xBaseS.png" ALT="Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.plotBodeSISODiscrete" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_LinearSystems2_WorkInProgress_StateSpace_Examples.html#Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.plotBodeSISODiscrete"
>plotBodeSISODiscrete</A>
</TD><TD>Plots the Bode diagram of continuous state space system and the corresponding discrete state space system and  with automatic determination of the frequency range to plot </TD></TR>
</TABLE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE designCraneController<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.designCraneController"></A><A HREF="Modelica_LinearSystems2_WorkInProgress_StateSpace_Examples.html#Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples"
>Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples</A>.designCraneController</H2>
<B>Design pole assignment and LQ controller for an overhead crane</B><p>
<P><H3>Information</H3></P>
<PRE></pre>
This example demonstrates how to design a lq-controller or a pole placement controller respectively. Compared with example <b>craneController</b>,
the plant is smaller to achieve suitable dynamics for animation.
The feedback matrices and a simple pre filter for tracking are save to MATLAB files which can be used in
ModelicaController library.<br>
It is also shown how to linearize a model of a crane trolley system [1]. The linear model is used as a base for control design
 <p>
<A name="References"><B><FONT SIZE="+1">References</FONT></B></A>
<PRE>
  [1] Föllinger, O. "Regelungstechnik", Hüthig-Verlag
</PRE>
<pre></PRE><P>

<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>String</TD><TD>modelName</TD><TD>&quot;Modelica_Controller.Example...</TD><TD>name of the model to linearize</TD></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A></TD><TD>pa[4]</TD><TD>{-3.5 + 0*j,-3.5 + 0*j,-3.5 ...</TD><TD>assigned poles</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>K_lq[:, :]</TD><TD>feedback matrix LQ controller</TD></TR>
<TR><TD>Real</TD><TD>K_pa[:, :]</TD><TD>feedback matrix pole assigment controller</TD></TR>
<TR><TD>Real</TD><TD>M_lq[:, :]</TD><TD>pre filter LQ controller</TD></TR>
<TR><TD>Real</TD><TD>M_pa[:, :]</TD><TD>pre filter pole assignment controller</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">function</font> designCraneController <font color="darkgreen">
  &quot;Design pole assignment and LQ controller for an overhead crane&quot;</font>
  <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Utilities_Streams.html#Modelica.Utilities.Streams.print"
>Modelica.Utilities.Streams.print</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math_Matrices.html#Modelica_LinearSystems2.Math.Matrices"
>Modelica_LinearSystems2.Math.Matrices</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.TransferFunction"
>Modelica_LinearSystems2.TransferFunction</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.ZerosAndPoles"
>Modelica_LinearSystems2.ZerosAndPoles</A>;

  <font color="blue">input </font>String modelName=
      &quot;Modelica_Controller.Examples.Components.Pendulum_small&quot; <font color="darkgreen">
    &quot;name of the model to linearize&quot;</font>;

  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> pa[4]={-3.5 + 0*j,-3.5 + 0*j,-3.5 - 0.5*j,-3.5 + 0.5*j} <font color="darkgreen">
    &quot;assigned poles&quot;</font>;

  <font color="blue">output </font>Real K_lq[:,:] <font color="darkgreen">&quot;feedback matrix LQ controller&quot;</font>;
  <font color="blue">output </font>Real K_pa[:,:] <font color="darkgreen">&quot;feedback matrix pole assigment controller&quot;</font>;
  <font color="blue">output </font>Real M_lq[:,:] <font color="darkgreen">&quot;pre filter LQ controller&quot;</font>;
  <font color="blue">output </font>Real M_pa[:,:] <font color="darkgreen">&quot;pre filter pole assignment controller&quot;</font>;
<font color="blue">protected </font>
  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> j=<font color="red">Modelica_LinearSystems2.Math.Complex.j</font>();

<font color="blue">protected </font>
  Real Q[:,:];
  Real R[:,:];

<font color="darkgreen">// Determine linear System from Modelica_Controller.Examples.Pendulum.mo</font>
  <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A> ss=
      <font color="red">Modelica_LinearSystems2.StateSpace.Import.fromModel</font>(modelName);
<font color="darkgreen">//Modelica_LinearSystems2.StateSpace ss=Modelica_LinearSystems2.StateSpace(A= [0,1,0,0;0,0,39.24,0;0,0,0,1;0,0,-4.904,0], B=[0;1e-3;0;-1e-4], C=[1,0,1,0], D=[0]);</font>

  <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> p[:]=<font color="red">Modelica_LinearSystems2.Math.Complex.eigenValues</font>(ss.A);
  <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A> ss_lq=ss;
  <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A> ss_pa=ss;

<font color="blue">algorithm </font>
  <font color="red">print</font>(&quot;The linearized state space system is determined to:\n&quot; +<font color="red"> String</font>(ss));

<font color="darkgreen">// ####### LQ CONTROLLER #######</font>

<font color="darkgreen">// eigenvalues of open loop system</font>
  p :=<font color="red"> Modelica_LinearSystems2.Math.Complex.eigenValues</font>(ss.A);
  <font color="red">print</font>(&quot;eigenvalues of the open loop system are:\n&quot;);
  <font color="red">Modelica_LinearSystems2.Math.Complex.Vectors.print</font>(&quot;ev&quot;, p);

<font color="darkgreen">// Calculate feesback matrix of a lq controller (Riccati) with weighting matrices Q and R</font>
  Q := [1,0,300,1000; 0,100,0,3000; 0,0,1000,0; 0,10,0,1];
  Q := Q*<font color="red">transpose</font>(Q);
  R :=<font color="red"> identity</font>(<font color="red">size</font>(ss.B, 2));
  (K_lq) :=<font color="red"> Modelica_LinearSystems2.StateSpace.Design.lqr</font>(
    ss,
    Q,
    R);

<font color="red">print</font>(&quot;\nXXXXXXXXXXX:\n&quot;);

  ss_lq.A := ss.A - ss.B*K_lq;
  <font color="red">print</font>(&quot;The feedback matrix of the lq controller is:\n&quot; +
    <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(
    K_lq,
    6,
    &quot;K_lq&quot;));
  <font color="red">writeMatrix</font>(
    DataDir + &quot;craneController_small.mat&quot;,
    &quot;K_lq&quot;,
    K_lq);

<font color="darkgreen">// eigenvalues of closed loop system</font>
  p :=<font color="red"> Modelica_LinearSystems2.Math.Complex.eigenValues</font>(ss_lq.A);
  <font color="red">print</font>(&quot;eigenvalues of the closed loop system are:\n&quot;);
  <font color="red">Modelica_LinearSystems2.Math.Complex.Vectors.print</font>(&quot;ev_lq&quot;, p);

<font color="darkgreen">// Pre filter calculation</font>
  M_lq := -<font color="red">Modelica.Math.Matrices.inv</font>([1,0,0,0]*<font color="red">Matrices.solve2</font>(ss_lq.A, ss_lq.B));
  <font color="red">print</font>(&quot;Gain for pre filtering:\n&quot; +
    <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(
    M_lq,
    6,
    &quot;M_lq&quot;));
  <font color="red">writeMatrix</font>(
    DataDir + &quot;craneController_small.mat&quot;,
    &quot;M_lq&quot;,
    M_lq,
    true);

<font color="darkgreen">//####### POLE ASSIGNMENT ##########</font>

<font color="darkgreen">// feedback matrix of a pole assignment controller with assigned eigenvalues pa</font>
  (K_pa,,p) :=<font color="red"> Modelica_LinearSystems2.StateSpace.Design.assignPolesMI</font>(ss, pa);
  ss_pa.A := ss.A - ss.B*K_pa;
  <font color="red">print</font>(&quot;The feedback matrix of the pole assignment controller is:\n&quot; +
    <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(
    K_pa,
    6,
    &quot;K_pa&quot;));
  <font color="red">print</font>(&quot;eigenvalues of the closed loop system are:\n&quot;);
  <font color="red">Modelica_LinearSystems2.Math.Complex.Vectors.print</font>(&quot;ev_pa&quot;, p);

  <font color="red">writeMatrix</font>(
    DataDir + &quot;craneController_small.mat&quot;,
    &quot;K_pa&quot;,
    K_pa,
    true);

<font color="darkgreen">// Pre filter calculation</font>
  M_pa := -<font color="red">Modelica.Math.Matrices.inv</font>([1,0,0,0]*<font color="red">Matrices.solve2</font>(ss_pa.A, ss_pa.B));
  <font color="red">print</font>(&quot;Gain for pre filtering:\n&quot; +
    <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(
    M_pa,
    6,
    &quot;M_pa&quot;));
  <font color="red">writeMatrix</font>(
    DataDir + &quot;craneController_small.mat&quot;,
    &quot;M_pa&quot;,
    M_pa,
    true);

  <font color="red">print</font>(&quot;\nok!&quot;);
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>designCraneController;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE designCraneControllerWithObserver<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.designCraneControllerWithObserver"></A><A HREF="Modelica_LinearSystems2_WorkInProgress_StateSpace_Examples.html#Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples"
>Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples</A>.designCraneControllerWithObserver</H2>
<B>Design pole assignment controller and observer for an overhead crane</B><p>
<P><H3>Information</H3></P>
<PRE></pre>
This example demonstrates how to use pole placement function assignPolesMI to design a pole placement controller and an observer also using assignPolesMI as well.
Function assignPoles is based on the Schur form of the state space matrix an also allows partial poles shifting [1].
<br>
An observer can be designed by applying assignPolesMI to the dual system (A', C', B').
<br>
The results, which are controller feedback matrix, observer feedback matrix, system model for usage in observer and a simple pre filter for tracking are saved to MATLAB files which can be used in ModelicaController library.<br>
It is also shown how to linearize a model of a crane trolley system [1]. The linear model is then used as a base for controller design.
<p>
 
<A name="References"><B><FONT SIZE="+1">References</FONT></B></A> <PRE>
  [1] Varga A., "A Schur method for pole assignment",
      IEEE Trans. Autom. Control, Vol. AC-26, pp. 517-519, 1981.
</PRE>
<pre></PRE><P>

<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>String</TD><TD>modelName</TD><TD>&quot;Modelica_Controller.Example...</TD><TD>name of the model to linearize</TD></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A></TD><TD>pa[4]</TD><TD>{-3.5 + 0*j,-3.5 + 0*j,-3.5 ...</TD><TD>assigned system poles</TD></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A></TD><TD>pob[4]</TD><TD>{-10 + 0*j,-10 + 0*j,-10 + 0...</TD><TD>assigned observer poles</TD></TR>
<TR><TD>String</TD><TD>fileName</TD><TD>DataDir + &quot;craneController_s...</TD><TD>file name for results</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>K_ob[:, :]</TD><TD>feedback matrix pole assigment controller</TD></TR>
<TR><TD>Real</TD><TD>K_pa[:, :]</TD><TD>feedback matrix pole assigment controller</TD></TR>
<TR><TD>Real</TD><TD>M_pa[:, :]</TD><TD>pre filter LQ controller</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">function</font> designCraneControllerWithObserver <font color="darkgreen">
  &quot;Design pole assignment controller and observer for an overhead crane&quot;</font>
  <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Utilities_Streams.html#Modelica.Utilities.Streams.print"
>Modelica.Utilities.Streams.print</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math_Matrices.html#Modelica_LinearSystems2.Math.Matrices"
>Modelica_LinearSystems2.Math.Matrices</A>;

  <font color="blue">input </font>String modelName=&quot;Modelica_Controller.Examples.Components.Pendulum_small&quot; <font color="darkgreen">
    &quot;name of the model to linearize&quot;</font>;

  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> pa[4]={-3.5+0*j,-3.5+0*j, -3.5-0.5*j, -3.5+0.5*j} <font color="darkgreen">
    &quot;assigned system poles&quot;</font>;

  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> pob[4]={-10+0*j,-10+0*j,-10+0*j,-10+0*j} <font color="darkgreen">
    &quot;assigned observer poles&quot;</font>;
 <font color="blue">input </font>String fileName=DataDir + &quot;craneController_small.mat&quot; <font color="darkgreen">
    &quot;file name for results&quot;</font>;

<font color="blue">protected </font>
 <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> j =<font color="red"> Modelica_LinearSystems2.Math.Complex.j</font>();
<font color="blue">public </font>
  <font color="blue">output </font>Real K_ob[:,:] <font color="darkgreen">&quot;feedback matrix pole assigment controller&quot;</font>;
  <font color="blue">output </font>Real K_pa[:,:] <font color="darkgreen">&quot;feedback matrix pole assigment controller&quot;</font>;
  <font color="blue">output </font>Real M_pa[:,:] <font color="darkgreen">&quot;pre filter LQ controller&quot;</font>;

<font color="darkgreen">// Determine linear System from Modelica_Controller.Examples.Pendulum.mo</font>
<font color="blue">protected </font>
  <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A> ss=
  <font color="red">Modelica_LinearSystems2.StateSpace.Import.fromModel</font>(modelName);

  <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> p[:];<font color="darkgreen">//=Modelica_LinearSystems2.Math.Complex.eigenValues(ss.A);</font>
  <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A> ss_pa=ss;
  <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A> ss_ob=<font color="red">StateSpace</font>(A=<font color="red">transpose</font>(ss.A), B=[1,0;0,1;0,0;0,0], C=<font color="red">transpose</font>(ss.B), D=[0,0]);
  <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A> ssPlant=<font color="red">StateSpace</font>(A=ss.A, B=ss.B,C=[1,0,0,0;0,1,0,0], D=[0;0]);

<font color="blue">algorithm </font>
  <font color="red">print</font>(&quot;The linearized state space system is determined to:\n&quot; +<font color="red"> String</font>(ssPlant));

 <font color="darkgreen">// eigenvalues of open loop system</font>
  p :=<font color="red"> Modelica_LinearSystems2.Math.Complex.eigenValues</font>(ss.A);
  <font color="red">print</font>(&quot;eigenvalues of the open loop system are:\n&quot;);
  <font color="red">Modelica_LinearSystems2.Math.Complex.Vectors.print</font>(&quot;ev&quot;, p);

<font color="darkgreen">//####### POLE ASSIGNMENT ##########</font>

<font color="darkgreen">// feedback matrix of a pole assignment controller with assigned eigenvalues pa</font>
  (K_pa,,p) :=<font color="red"> Modelica_LinearSystems2.StateSpace.Design.assignPolesMI</font>(ss, pa);
  ss_pa.A := ss.A - ss.B*K_pa;
  <font color="red">print</font>(&quot;The feedback matrix of the pole assignment controller is:\n&quot; +
    <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(
    K_pa,
    6,
    &quot;K_pa&quot;));
  <font color="red">print</font>(&quot;eigenvalues of the closed loop system are:\n&quot;);
  <font color="red">Modelica_LinearSystems2.Math.Complex.Vectors.print</font>(&quot;ev_pa&quot;, p);

  <font color="red">writeMatrix</font>(
    fileName,
    &quot;K_pa&quot;,
    K_pa,
    false);

<font color="darkgreen">// Pre filter calculation</font>
  M_pa := -<font color="red">Modelica.Math.Matrices.inv</font>([1,0,0,0]*<font color="red">Matrices.solve2</font>(ss_pa.A, ss_pa.B));
  <font color="red">print</font>(&quot;Gain for pre filtering:\n&quot; +
    <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(
    M_pa,
    6,
    &quot;M_pa&quot;));
  <font color="red">writeMatrix</font>(
    fileName,
    &quot;M_pa&quot;,
    M_pa,
    true);

<font color="darkgreen">// observer feedback</font>
  (K_ob,,p) :=<font color="red"> Modelica_LinearSystems2.StateSpace.Design.assignPolesMI</font>(ss_ob, pob);
  K_ob :=<font color="red"> transpose</font>(K_ob);

  <font color="red">writeMatrix</font>(
    fileName,
    &quot;stateSpace&quot;,
    [ssPlant.A,ssPlant.B; ssPlant.C,ssPlant.D],
    true);
<font color="darkgreen">// write matrix dimension nx</font>
  <font color="red">writeMatrix</font>(
    fileName,
    &quot;nx&quot;,
    [<font color="red">size</font>(ssPlant.A,1)],
    true);
  <font color="red">print</font>(&quot;The feedback matrix of the observer system is:\n&quot; +
    <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(
    K_ob,
    6,
    &quot;K_ob&quot;));
  ss_ob.A := ss.A - K_ob*ssPlant.C;

  <font color="red">print</font>(&quot;eigenvalues of the observer system are:\n&quot;);
  <font color="red">Modelica_LinearSystems2.Math.Complex.Vectors.print</font>(&quot;ev_pob&quot;, pob);
  <font color="red">writeMatrix</font>(
    fileName,
    &quot;K_ob&quot;,
    K_ob,
    true);

  <font color="red">print</font>(&quot;\nok!&quot;);
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>designCraneControllerWithObserver;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE designInverseDoublePendulumController<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.designInverseDoublePendulumController"></A><A HREF="Modelica_LinearSystems2_WorkInProgress_StateSpace_Examples.html#Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples"
>Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples</A>.designInverseDoublePendulumController</H2>
<B>Design pole assignment for an inverse double pedulum</B><p>
<P><H3>Information</H3></P>
<PRE></pre>
This example demonstrates how to design pole placement controller to balance an inverted double pendulum. For controller design a linearized model of a (simple) physical system model is used.
The controller is applied to the physical model in Moldelica_Controller library.
<br>
It is also shown how to linearize a modelica model. The linear model is used as a base for control design
 
<pre></PRE><P>

<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>String</TD><TD>modelName</TD><TD>&quot;Modelica_Controller.Example...</TD><TD>name of the model to linearize</TD></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A></TD><TD>pa[6]</TD><TD>{Complex(-2, 0),Complex(-2, ...</TD><TD>assigned poles</TD></TR>
<TR><TD>String</TD><TD>fileName</TD><TD>DataDir + &quot;inverseDoublePend...</TD><TD>file name for results</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>K_pa[:, :]</TD><TD>feedback matrix pole assigment controller</TD></TR>
<TR><TD>Real</TD><TD>M_pa[:, :]</TD><TD>pre filter LQ controller</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">function</font> designInverseDoublePendulumController <font color="darkgreen">
  &quot;Design pole assignment for an inverse double pedulum&quot;</font>

  <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Utilities_Streams.html#Modelica.Utilities.Streams.print"
>Modelica.Utilities.Streams.print</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math_Matrices.html#Modelica_LinearSystems2.Math.Matrices"
>Modelica_LinearSystems2.Math.Matrices</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A>;

 <font color="blue">input </font>String modelName=&quot;Modelica_Controller.Examples.Components.InverseDoublePendulum&quot; <font color="darkgreen">
    &quot;name of the model to linearize&quot;</font>;

<font color="darkgreen">//   input Complex pa[6]={Complex(-2), -2+0*j, -6-0.2*j,-6+0.2*j,-6-0.2*j,-6+0.2*j}</font>
<font color="darkgreen">//      &quot;assigned poles&quot;;</font>

<font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> pa[6]={<font color="red">Complex</font>(-2,0),<font color="red"> Complex</font>(-2,0),<font color="red"> Complex</font>(-15,-0.2),<font color="red">Complex</font>(-15,0.2),<font color="red">Complex</font>(-20,-0),<font color="red">Complex</font>(-20,0)} <font color="darkgreen">
    &quot;assigned poles&quot;</font>;

<font color="darkgreen">//  input Complex pob[6]=fill(-10+0*j,6) &quot;assigned observer poles&quot;;</font>

 <font color="blue">input </font>String fileName=DataDir + &quot;inverseDoublePendulumController.mat&quot; <font color="darkgreen">
    &quot;file name for results&quot;</font>;

 <font color="blue">output </font>Real K_pa[:,:] <font color="darkgreen">&quot;feedback matrix pole assigment controller&quot;</font>;
 <font color="blue">output </font>Real M_pa[:,:] <font color="darkgreen">&quot;pre filter LQ controller&quot;</font>;

<font color="darkgreen">// output Real K_ob[:,:] &quot;feedback matrix pole assigment controller&quot;;</font>

<font color="blue">protected </font>
 <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> j =<font color="red"> Modelica_LinearSystems2.Math.Complex.j</font>();
<font color="blue">protected </font>
 Real Q[:,:];
 Real R[:,:];
 Boolean isControllable;
 Boolean isObservable;

  <font color="darkgreen">// Determine linear System from Modelica_Controller.Examples.Components.InverseDoublePendulum.mo</font>
 <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A> ss =<font color="red"> Modelica_LinearSystems2.StateSpace.Import.fromModel</font>(modelName);

 <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> p[:]=<font color="red">Modelica_LinearSystems2.Math.Complex.eigenValues</font>(ss.A);
 <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A> ss_pa=ss;
<font color="darkgreen">//  Modelica_LinearSystems2.StateSpace ss_ob=StateSpace(A=transpose(ss.A), B=transpose([1,0,0,0,0,0;0,0,1,0,0,0;0,0,0,0,1,0]), C=transpose(ss.B), D=fill(0,size(ss.B,2),3));</font>
  <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A> ssPlant=<font color="red">Modelica_LinearSystems2.StateSpace</font>(A=ss.A, B=ss.B,C=[1,0,0,0,0,0;0,0,1,0,0,0;0,0,0,0,1,0],D=<font color="red">zeros</font>(3,<font color="red">size</font>(ss.B,2)));

<font color="blue">algorithm </font>
 ss.C:=<font color="red">identity</font>(6);
<font color="red">print</font>(&quot;The linearized state space system is determined to:\n&quot; +<font color="red"> String</font>(ss));
  <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(ss.C,6,&quot;C&quot;);
 <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(ss.D,6,&quot;D&quot;);

<font color="red">StateSpace.Analysis.analysis</font>(ssPlant,fileName=&quot;inverseDoublePendulum.html&quot;);

isControllable :=<font color="red"> StateSpace.Analysis.isControllable</font>(ssPlant);

  <font color="blue">if </font>isControllable<font color="blue"> then</font>
    <font color="red">  Modelica.Utilities.Streams.print</font>(&quot;ssPlant is controllable&quot;);
    <font color="blue">else</font>
    <font color="red">  Modelica.Utilities.Streams.print</font>(&quot;ssPlant is not controllable&quot;);
    <font color="blue">end if</font>;
isObservable :=<font color="red"> StateSpace.Analysis.isObservable</font>(ssPlant);
  <font color="blue">if </font>isObservable<font color="blue"> then</font>
    <font color="red">  Modelica.Utilities.Streams.print</font>(&quot;ssPlant is observable&quot;);
    <font color="blue">else</font>
    <font color="red">  Modelica.Utilities.Streams.print</font>(&quot;ssPlant is not observable&quot;);
    <font color="blue">end if</font>;

 <font color="red">print</font>(&quot;The eigenvalues are:\n&quot;);
<font color="red">Complex.Vectors.print</font>(&quot;p&quot;,p);

  <font color="darkgreen">//####### POLE ASSIGNMENT ##########</font>

  <font color="darkgreen">// feedback matrix of a pole assignment controller with assigned eigenvalues pa</font>
  (K_pa,,p) :=<font color="red"> Modelica_LinearSystems2.StateSpace.Design.assignPolesMI</font>(ss, pa);
  ss_pa.A := ss.A - ss.B*K_pa;

  <font color="red">print</font>(&quot;The feedback matrix of the pole assignment controller is:\n&quot; +
    <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(
    K_pa,
    6,
    &quot;K_pa&quot;));
  <font color="red">print</font>(&quot;eigenvalues of the closed loop system are:\n&quot;);
  <font color="red">Modelica_LinearSystems2.Math.Complex.Vectors.print</font>(&quot;ev_pa&quot;, p);

  <font color="red">writeMatrix</font>(
    fileName,
    &quot;K_pa&quot;,
    K_pa,
    true);

  <font color="darkgreen">// Pre filter calculation</font>
  M_pa := -<font color="red">Modelica.Math.Matrices.inv</font>([1,0,0,0,0,0]*<font color="red">Matrices.solve2</font>(ss_pa.A,
    ss_pa.B));
  <font color="red">print</font>(&quot;Gain for pre filtering:\n&quot; +
    <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(
    M_pa,
    6,
    &quot;M_pa&quot;));
  <font color="red">writeMatrix</font>(
    fileName,
    &quot;M_pa&quot;,
    M_pa,
    true);

<font color="darkgreen">//   K_ob := Modelica_LinearSystems2.StateSpace.Design.assignPolesMI(ss_ob, pob);</font>
<font color="darkgreen">//   K_ob := transpose(K_ob);</font>
<font color="darkgreen">//</font>
<font color="darkgreen">//   writeMatrix(</font>
<font color="darkgreen">//     fileName,</font>
<font color="darkgreen">//     &quot;nx&quot;,</font>
<font color="darkgreen">//     [size(ssPlant.A,1)],</font>
<font color="darkgreen">//     true);</font>
<font color="darkgreen">//  writeMatrix(</font>
<font color="darkgreen">//     fileName,</font>
<font color="darkgreen">//     &quot;stateSpace&quot;,</font>
<font color="darkgreen">//     [ssPlant.A,ssPlant.B; ssPlant.C,ssPlant.D],</font>
<font color="darkgreen">//     true);</font>
<font color="darkgreen">//</font>
<font color="darkgreen">//   writeMatrix(</font>
<font color="darkgreen">//     fileName,</font>
<font color="darkgreen">//     &quot;K_ob&quot;,</font>
<font color="darkgreen">//     K_ob,</font>
<font color="darkgreen">//     true);</font>

<font color="darkgreen">//StateSpace.Analysis.analysis(ss_pa,fileName=&quot;inverseDoublePendulumControlled.html&quot;);</font>

  <font color="red">print</font>(&quot;\nok!&quot;);
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>designInverseDoublePendulumController;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE designInverseDoublePendulumControllerWithObserver<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.designInverseDoublePendulumControllerWithObserver"></A><A HREF="Modelica_LinearSystems2_WorkInProgress_StateSpace_Examples.html#Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples"
>Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples</A>.designInverseDoublePendulumControllerWithObserver</H2>
<B>Design pole assignment for an inverse double pedulum</B><p>
<P><H3>Information</H3></P>
<PRE></pre>
This example demonstrates how to design pole placement controller to balance an inverted double pendulum. For controller design a linearized model of a (simple) physical system model is used.
The controller is applied to the physical model in Moldelica_Controller library.
<br>
It is also shown how to linearize a modelica model. The linear model is used as a base for control design
 
<pre></PRE><P>

<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>String</TD><TD>modelName</TD><TD>&quot;Modelica_Controller.Example...</TD><TD>name of the model to linearize</TD></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A></TD><TD>pa[6]</TD><TD>{Complex(-1, 0),Complex(-1, ...</TD><TD>assigned poles</TD></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A></TD><TD>pob[6]</TD><TD>cat(1, fill(-15 + 0*j, 4), f...</TD><TD>assigned observer poles</TD></TR>
<TR><TD>String</TD><TD>fileName</TD><TD>DataDir + &quot;inverseDoublePend...</TD><TD>file name for results</TD></TR>
<TR><TD>Boolean</TD><TD>makeAnalysis</TD><TD>false</TD><TD>&nbsp;</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>K_pa[:, :]</TD><TD>feedback matrix pole assigment controller</TD></TR>
<TR><TD>Real</TD><TD>M_pa[:, :]</TD><TD>pre filter LQ controller</TD></TR>
<TR><TD>Real</TD><TD>K_ob[:, :]</TD><TD>feedback matrix pole assigment controller</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">function</font> designInverseDoublePendulumControllerWithObserver <font color="darkgreen">
  &quot;Design pole assignment for an inverse double pedulum&quot;</font>

  <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Utilities_Streams.html#Modelica.Utilities.Streams.print"
>Modelica.Utilities.Streams.print</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math_Matrices.html#Modelica_LinearSystems2.Math.Matrices"
>Modelica_LinearSystems2.Math.Matrices</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A>;

 <font color="blue">input </font>String modelName=&quot;Modelica_Controller.Examples.Components.InverseDoublePendulum&quot; <font color="darkgreen">
    &quot;name of the model to linearize&quot;</font>;

<font color="darkgreen">//input Complex pa[6]={-1+0*j, -1+0*j, -6-0.2*j,-6+0.2*j,-6-0.2*j,-6+0.2*j}     &quot;assigned poles&quot;;</font>
<font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> pa[6]={<font color="red">Complex</font>(-1,0),<font color="red"> Complex</font>(-1,0),<font color="red"> Complex</font>(-12,-0.2),<font color="red">Complex</font>(-12,0.2),<font color="red">Complex</font>(-15,-0),<font color="red">Complex</font>(-15,0)} <font color="darkgreen">
    &quot;assigned poles&quot;</font>;
  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> pob[6]=<font color="red">cat</font>(1,<font color="red">fill</font>(-15+0*j,4),<font color="red">fill</font>(-20+0*j,2)) <font color="darkgreen">
    &quot;assigned observer poles&quot;</font>;

 <font color="blue">input </font>String fileName=DataDir + &quot;inverseDoublePendulumControllerO.mat&quot; <font color="darkgreen">
    &quot;file name for results&quot;</font>;

  <font color="blue">input </font>Boolean makeAnalysis=false;

 <font color="blue">output </font>Real K_pa[:,:] <font color="darkgreen">&quot;feedback matrix pole assigment controller&quot;</font>;
 <font color="blue">output </font>Real M_pa[:,:] <font color="darkgreen">&quot;pre filter LQ controller&quot;</font>;
 <font color="blue">output </font>Real K_ob[:,:] <font color="darkgreen">&quot;feedback matrix pole assigment controller&quot;</font>;

<font color="blue">protected </font>
 <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> j =<font color="red"> Modelica_LinearSystems2.Math.Complex.j</font>();
<font color="blue">protected </font>
 Real Q[:,:];
 Real R[:,:];
 Boolean isControllable;
 Boolean isObservable;

  <font color="darkgreen">// Determine linear System from Modelica_Controller.Examples.Components.InverseDoublePendulum.mo</font>
 <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A> ss =<font color="red"> Modelica_LinearSystems2.StateSpace.Import.fromModel</font>(modelName);

 <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> p[:]=<font color="red">Modelica_LinearSystems2.Math.Complex.eigenValues</font>(ss.A);
 <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A> ss_pa=ss;
<font color="darkgreen">// Modelica_LinearSystems2.StateSpace ss_ob=StateSpace(A=transpose(ss.A), B=transpose([1,0,0,0,0,0;0,0,1,0,0,0]), C=transpose(ss.B), D=fill(0,size(ss.B,2),2));</font>
<font color="darkgreen">// Modelica_LinearSystems2.StateSpace ssPlant=Modelica_LinearSystems2.StateSpace(A=ss.A, B=ss.B,C=[1,0,0,0,0,0;0,0,1,0,0,0],D=zeros(2,size(ss.B,2)));</font>

<font color="darkgreen">// Observer with 3 meassurements</font>
<font color="darkgreen">//   Modelica_LinearSystems2.StateSpace ss_ob=StateSpace(A=transpose(ss.A), B=transpose([1,0,0,0,0,0;0,0,1,0,0,0;0,0,0,0,1,0]), C=transpose(ss.B), D=fill(0,size(ss.B,2),3));</font>
<font color="darkgreen">//   Modelica_LinearSystems2.StateSpace ssPlant=Modelica_LinearSystems2.StateSpace(A=ss.A, B=ss.B,C=[1,0,0,0,0,0;0,0,1,0,0,0;0,0,0,0,1,0],D=zeros(3,size(ss.B,2)));</font>

<font color="darkgreen">// Observer with 2 meassurements</font>
  <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A> ss_ob=<font color="red">StateSpace</font>(A=<font color="red">transpose</font>(ss.A), B=<font color="red">transpose</font>([1,0,0,0,0,0;0,0,1,0,0,0]), C=<font color="red">transpose</font>(ss.B), D=<font color="red">fill</font>(0,<font color="red">size</font>(ss.B,2),2));
  <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A> ssPlant=<font color="red">Modelica_LinearSystems2.StateSpace</font>(A=ss.A, B=ss.B,C=[1,0,0,0,0,0;0,0,1,0,0,0],D=<font color="red">zeros</font>(2,<font color="red">size</font>(ss.B,2)), yNames={&quot;s&quot;,&quot;phi1&quot;}, xNames=ss.xNames, uNames=ss.uNames);

<font color="blue">algorithm </font>
 ss.C:=<font color="red">identity</font>(6);
<font color="red">print</font>(&quot;The linearized state space system is determined to:\n&quot; +<font color="red"> String</font>(ss));
  <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(ss.C,6,&quot;C&quot;);
 <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(ss.D,6,&quot;D&quot;);

<font color="blue">if </font>makeAnalysis<font color="blue"> then</font>
<font color="red">StateSpace.Analysis.analysis</font>(ssPlant,fileName=&quot;inverseDoublePendulum.html&quot;);
<font color="blue">end if</font>;

isControllable :=<font color="red"> StateSpace.Analysis.isControllable</font>(ssPlant);

  <font color="blue">if </font>isControllable<font color="blue"> then</font>
    <font color="red">  Modelica.Utilities.Streams.print</font>(&quot;ssPlant is controllable&quot;);
    <font color="blue">else</font>
    <font color="red">  Modelica.Utilities.Streams.print</font>(&quot;ssPlant is not controllable&quot;);
    <font color="blue">end if</font>;
isObservable :=<font color="red"> StateSpace.Analysis.isObservable</font>(ssPlant);
  <font color="blue">if </font>isObservable<font color="blue"> then</font>
    <font color="red">  Modelica.Utilities.Streams.print</font>(&quot;ssPlant is observable&quot;);
    <font color="blue">else</font>
    <font color="red">  Modelica.Utilities.Streams.print</font>(&quot;ssPlant is not observable&quot;);
    <font color="blue">end if</font>;

 <font color="red">print</font>(&quot;The eigenvalues are:\n&quot;);
<font color="red">Complex.Vectors.print</font>(&quot;p&quot;,p);

  <font color="darkgreen">//####### POLE ASSIGNMENT ##########</font>

  <font color="darkgreen">// feedback matrix of a pole assignment controller with assigned eigenvalues pa</font>
  (K_pa,,p) :=<font color="red"> Modelica_LinearSystems2.StateSpace.Design.assignPolesMI</font>(ss, pa);
  ss_pa.A := ss.A - ss.B*K_pa;

  <font color="red">print</font>(&quot;The feedback matrix of the pole assignment controller is:\n&quot; +
    <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(
    K_pa,
    6,
    &quot;K_pa&quot;));
  <font color="red">print</font>(&quot;eigenvalues of the closed loop system are:\n&quot;);
  <font color="red">Modelica_LinearSystems2.Math.Complex.Vectors.print</font>(&quot;ev_pa&quot;, p);

  <font color="red">writeMatrix</font>(
    fileName,
    &quot;K_pa&quot;,
    K_pa,
    true);

  <font color="darkgreen">// Pre filter calculation</font>
  M_pa := -<font color="red">Modelica.Math.Matrices.inv</font>([1,0,0,0,0,0]*<font color="red">Matrices.solve2</font>(ss_pa.A,
    ss_pa.B));
  <font color="red">print</font>(&quot;Gain for pre filtering:\n&quot; +
    <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(
    M_pa,
    6,
    &quot;M_pa&quot;));
  <font color="red">writeMatrix</font>(
    fileName,
    &quot;M_pa&quot;,
    M_pa,
    true);

  K_ob :=<font color="red"> Modelica_LinearSystems2.StateSpace.Design.assignPolesMI</font>(ss_ob, pob);
  K_ob :=<font color="red"> transpose</font>(K_ob);

  <font color="red">writeMatrix</font>(
    fileName,
    &quot;nx&quot;,
    [<font color="red">size</font>(ssPlant.A,1)],
    true);
 <font color="red">writeMatrix</font>(
    fileName,
    &quot;stateSpace&quot;,
    [ssPlant.A,ssPlant.B; ssPlant.C,ssPlant.D],
    true);

  <font color="red">writeMatrix</font>(
    fileName,
    &quot;K_ob2&quot;,
    K_ob,
    true);

<font color="blue">if </font>makeAnalysis<font color="blue"> then</font>
<font color="red">StateSpace.Analysis.analysis</font>(ss_pa,fileName=&quot;inverseDoublePendulumControlled.html&quot;);
<font color="blue">end if</font>;
  <font color="red">print</font>(&quot;\nok!&quot;);
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>designInverseDoublePendulumControllerWithObserver;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE designInversePendulumController<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.designInversePendulumController"></A><A HREF="Modelica_LinearSystems2_WorkInProgress_StateSpace_Examples.html#Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples"
>Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples</A>.designInversePendulumController</H2>
<B>Design pole assignment for an inverse pedulum</B><p>
<P><H3>Information</H3></P>
<PRE></pre>
This example demonstrates how to design pole placement controller to balance an inverted pendulum. For controller design a linearized model of a (simple) physical system model is used.
The controller is applied to the physical model in Moldelica_Controller library.
<br>
It is also shown how to linearize a modelica model. The linear model is used as a base for control design
 
<pre></PRE><P>

<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>String</TD><TD>modelName</TD><TD>&quot;Modelica_Controller.Example...</TD><TD>name of the model to linearize</TD></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A></TD><TD>pa[4]</TD><TD>{-5 + 0*j,-5 + 0*j,-5.0 - 0....</TD><TD>assigned poles</TD></TR>
<TR><TD>String</TD><TD>fileName</TD><TD>DataDir + &quot;inversePendulumCo...</TD><TD>file name for results</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>K_pa[:, :]</TD><TD>feedback matrix pole assigment controller</TD></TR>
<TR><TD>Real</TD><TD>M_pa[:, :]</TD><TD>pre filter LQ controller</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">function</font> designInversePendulumController <font color="darkgreen">
  &quot;Design pole assignment for an inverse pedulum&quot;</font>

  <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Utilities_Streams.html#Modelica.Utilities.Streams.print"
>Modelica.Utilities.Streams.print</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math_Matrices.html#Modelica_LinearSystems2.Math.Matrices"
>Modelica_LinearSystems2.Math.Matrices</A>;

  <font color="blue">input </font>String modelName=&quot;Modelica_Controller.Examples.Components.InversePendulum_small&quot; <font color="darkgreen">
    &quot;name of the model to linearize&quot;</font>;
   <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> pa[4]={-5+0*j,-5+0*j,-5.0-0.25*j,-5.0+0.25*j} <font color="darkgreen">&quot;assigned poles&quot;</font>;

  <font color="blue">input </font>String fileName=DataDir + &quot;inversePendulumController_small.mat&quot; <font color="darkgreen">
    &quot;file name for results&quot;</font>;
<font color="blue">protected </font>
   <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> j =<font color="red"> Modelica_LinearSystems2.Math.Complex.j</font>();
<font color="blue">public </font>
  <font color="blue">output </font>Real K_pa[:,:] <font color="darkgreen">&quot;feedback matrix pole assigment controller&quot;</font>;
  <font color="blue">output </font>Real M_pa[:,:] <font color="darkgreen">&quot;pre filter LQ controller&quot;</font>;
<font color="darkgreen">// Determine linear System from Modelica_Controller.Examples.Pendulum.mo</font>
<font color="blue">protected </font>
  <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A> ss =<font color="red"> Modelica_LinearSystems2.StateSpace.Import.fromModel</font>(modelName);

  <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> p[:]=<font color="red">Modelica_LinearSystems2.Math.Complex.eigenValues</font>(ss.A);

  <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A> ss_pa=ss;

<font color="blue">algorithm </font>
  <font color="red">print</font>(&quot;The linearized state space system is determined to:\n&quot; +<font color="red">String</font>(ss));

<font color="darkgreen">//####### POLE ASSIGNMENT ##########</font>

<font color="darkgreen">// feedback matrix of a pole assignment controller with assigned eigenvalues pa</font>
  (K_pa,,p) :=<font color="red"> Modelica_LinearSystems2.StateSpace.Design.assignPolesMI</font>(ss, pa);
  ss_pa.A := ss.A - ss.B*K_pa;

  <font color="red">print</font>(&quot;The feedback matrix of the pole assignment controller is:\n&quot; +
    <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(
    K_pa,
    6,
    &quot;K_pa&quot;));
  <font color="red">print</font>(&quot;eigenvalues of the closed loop system are:\n&quot;);
  <font color="red">Modelica_LinearSystems2.Math.Complex.Vectors.print</font>(&quot;ev_pa&quot;, p);
  <font color="red">writeMatrix</font>(
   fileName,
    &quot;K_pa&quot;,
    K_pa,
    true);

<font color="darkgreen">// Pre filter calculation</font>
  M_pa := -<font color="red">Modelica.Math.Matrices.inv</font>([1,0,0,0]*<font color="red">Matrices.solve2</font>(ss_pa.A, ss_pa.B));
  <font color="red">print</font>(&quot;Gain for pre filtering:\n&quot; +
    <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(
    M_pa,
    6,
    &quot;M_pa&quot;));
  <font color="red">writeMatrix</font>(
   fileName,
    &quot;M_pa&quot;,
    M_pa,
    true);

  <font color="red">print</font>(&quot;\nok!&quot;);
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>designInversePendulumController;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE designStateSpaceController<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.designStateSpaceController"></A><A HREF="Modelica_LinearSystems2_WorkInProgress_StateSpace_Examples.html#Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples"
>Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples</A>.designStateSpaceController</H2>
<B>Demonstration of controller design for a state space system</B><p>
<P><H3>Information</H3></P>
<PRE></pre>
This example demonstrates how to design a lq-controller or a pole placement controller respectively. Compared with example <b>craneController</b>,
the plant is smaller to achieve suitable dynamics for animation.
The feedback matrices and a simple pre filter for tracking are save to MATLAB files which can be used in
ModelicaController library.<br>
It is also shown how to linearize a model of a crane trolley system [1]. The linear model is used as a base for control design
 <p>
<A name="References"><B><FONT SIZE="+1">References</FONT></B></A>
<PRE>
  [1] Föllinger, O. "Regelungstechnik", Hüthig-Verlag
</PRE>
<pre></PRE><P>

<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>StateSpace</A></TD><TD>ss</TD><TD>StateSpace(A=[0, 1, 0, 0; 0,...</TD><TD>&nbsp;</TD></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A></TD><TD>pa[:]</TD><TD>{Complex(-1, 0),Complex(-2, ...</TD><TD>assigned poles</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>K_pa[:, :]</TD><TD>feedback matrix pole assigment controller</TD></TR>
<TR><TD>Real</TD><TD>M_pa[:, :]</TD><TD>pre filter pole assignment controller</TD></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A></TD><TD>po[size(ss.A, 1)]</TD><TD>&nbsp;</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">function</font> designStateSpaceController <font color="darkgreen">
  &quot;Demonstration of controller design for a state space system&quot;</font>
  <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_Utilities_Streams.html#Modelica.Utilities.Streams.print"
>Modelica.Utilities.Streams.print</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math_Matrices.html#Modelica_LinearSystems2.Math.Matrices"
>Modelica_LinearSystems2.Math.Matrices</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.TransferFunction"
>Modelica_LinearSystems2.TransferFunction</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.ZerosAndPoles"
>Modelica_LinearSystems2.ZerosAndPoles</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A>;

  <font color="blue">input </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>StateSpace</A> ss=<font color="red">StateSpace</font>(
      A=[0,1,0,0; 0,0,39.2,0; 0,0,0,1; 0,0,-49.0,0],
      B=[1,1,0,0;0,1,1,0;0,0,1,1;1,1,1,1],
      C=<font color="red">identity</font>(4),
      D=<font color="red">zeros</font>(4,4),
      yNames={&quot;s&quot;,&quot;v&quot;,&quot;phi&quot;,&quot;w&quot;},
      uNames={&quot;f&quot;,&quot;u2&quot;,&quot;u3&quot;,&quot;u4&quot;},
      xNames={&quot;s&quot;,&quot;v&quot;,&quot;phi&quot;,&quot;w&quot;});

   <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> pa[:]={<font color="red">Complex</font>(-1,0),<font color="red">Complex</font>(-2,0),<font color="red">Complex</font>(-2, -0.2),<font color="red">Complex</font>(-2,0.2)} <font color="darkgreen">
    &quot;assigned poles&quot;</font>;

  <font color="blue">output </font>Real K_pa[:,:] <font color="darkgreen">&quot;feedback matrix pole assigment controller&quot;</font>;
  <font color="blue">output </font>Real M_pa[:,:] <font color="darkgreen">&quot;pre filter pole assignment controller&quot;</font>;
  <font color="blue">output </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> po[<font color="red">size</font>(ss.A,1)];

<font color="blue">protected </font>
  <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> assignedPoles[:]=pa;
  <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>StateSpace</A> ss_pa=ss;

<font color="blue">algorithm </font>
<font color="darkgreen">//####### POLE ASSIGNMENT ##########</font>
<font color="darkgreen">// return the Schur form representation</font>
  (,,po) :=<font color="red"> StateSpace.Design.assignPolesMI2</font>(ss,assignedPoles,<font color="red">size</font>(assignedPoles,1),true);
  <font color="red">Complex.Vectors.print</font>(&quot;poSchur&quot;, po);
  <font color="red">StateSpace.Analysis.analysis</font>(ss,fileName=&quot;openloopSystem.html&quot;);

<font color="darkgreen">// feedback matrix of a pole assignment controller with assigned eigenvalues pa</font>
  (K_pa,,po) :=<font color="red"> StateSpace.Design.assignPolesMI2</font>(ss, assignedPoles);
  ss_pa.A := ss.A - ss.B*K_pa;
  <font color="red">StateSpace.Analysis.analysis</font>(ss_pa,fileName=&quot;closedloopSystem.html&quot;);
  <font color="red">print</font>(&quot;The feedback matrix of the pole assignment controller is:\n&quot; +
    <font color="red">Matrices.printMatrix</font>(K_pa, 6, &quot;K_pa&quot;));
  <font color="red">print</font>(&quot;eigenvalues of the closed loop system are:\n&quot;);
  <font color="red">Complex.Vectors.print</font>(&quot;ev_pa&quot;, po);
<font color="darkgreen">// Pre filter calculation</font>
<font color="darkgreen">//   M_pa := -Modelica.Math.Matrices.inv([1,0,0,0;0,0,1,0]*Matrices.solve2(ss_pa.A, ss_pa.B));</font>
<font color="darkgreen">//   print(&quot;Gain for pre filtering:\n&quot; +</font>
<font color="darkgreen">//     Matrices.printMatrix(M_pa, 6, &quot;M_pa&quot;));</font>

  assignedPoles :=<font color="red"> Complex.Vectors.reverse</font>(assignedPoles);
  assignedPoles[3]:=<font color="red">Complex</font>(-1);
  assignedPoles[4]:=<font color="red">Complex</font>(-2);
<font color="darkgreen">// feedback matrix of a pole assignment controller with assigned eigenvalues pa</font>
  (K_pa,,po) :=<font color="red"> StateSpace.Design.assignPolesMI2</font>(ss, assignedPoles);
  ss_pa.A := ss.A - ss.B*K_pa;
  <font color="red">StateSpace.Analysis.analysis</font>(ss_pa,fileName=&quot;closedloopSystem2.html&quot;);
  <font color="red">print</font>(&quot;The feedback matrix of the pole assignment controller is:\n&quot; +
    <font color="red">Matrices.printMatrix</font>(K_pa, 6, &quot;K_pa&quot;));
  <font color="red">print</font>(&quot;eigenvalues of the closed loop system are:\n&quot;);
  <font color="red">Complex.Vectors.print</font>(&quot;ev_pa&quot;, po);
<font color="darkgreen">// Pre filter calculation</font>
<font color="darkgreen">//   M_pa := -Modelica.Math.Matrices.inv([1,0,0,0;0,0,1,0]*Matrices.solve2(ss_pa.A, ss_pa.B));</font>
<font color="darkgreen">//   print(&quot;Gain for pre filtering:\n&quot; +</font>
<font color="darkgreen">//     Matrices.printMatrix(M_pa, 6, &quot;M_pa&quot;));</font>

  <font color="red">print</font>(&quot;\nok!&quot;);
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>designStateSpaceController;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE analysis2<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.analysis2"></A><A HREF="Modelica_LinearSystems2_WorkInProgress_StateSpace_Examples.html#Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples"
>Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples</A>.analysis2</H2>
<B>Example to check controllability of a state space system</B><p>
<P><H3>Information</H3></P>
<PRE></pre>
This example shows the usage of <b>function Modelica_LinearSystems2.StateSpace.Analysis.isControllable</b> which is 
to check whether a system is controllable or not.
<pre></PRE><P>

<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>StateSpace</A></TD><TD>ssi</TD><TD>Modelica_LinearSystems2.Stat...</TD><TD>&nbsp;</TD></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Internal.html#Modelica_LinearSystems2.Internal.AnalyseOptions"
>AnalyseOptions</A></TD><TD>analyseOptions</TD><TD>Modelica_LinearSystems2.Inte...</TD><TD>&nbsp;</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>system data definition</TD></TR>
<TR><TD>Boolean</TD><TD>systemOnFile</TD><TD>false</TD><TD>true, if state space system is defined on file</TD></TR>
<TR><TD>String</TD><TD>fileName</TD><TD>&quot;NoName&quot;</TD><TD>file where matrix [A, B; C, D] is stored</TD></TR>
<TR><TD>String</TD><TD>matrixName</TD><TD>&quot;ABCD&quot;</TD><TD>Name of the state space system matrix</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Boolean</TD><TD>ok</TD><TD>&nbsp;</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">function</font> analysis2 <font color="darkgreen">
  &quot;Example to check controllability of a state space system&quot;</font>
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2"
>Modelica_LinearSystems2</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Modelica_LinearSystems2.Math.Complex</A>;
  <font color="blue">import </font>Re = <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex.real"
>Modelica_LinearSystems2.Math.Complex.real</A>;
  <font color="blue">import </font>Im = <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex.imag"
>Modelica_LinearSystems2.Math.Complex.imag</A>;

  <font color="blue">input </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>StateSpace</A> ssi=<font color="red">Modelica_LinearSystems2.StateSpace</font>(
      A=[-6.0,0,2,-13.0; -9.0,-12.0,-3.25,19.25; 0,0,1,34.0; 0,0,-34.0,-31.0]/6,
      B=[1; 1; 1; 1],
      C=<font color="red">identity</font>(4),
      D=<font color="red">zeros</font>(4, 1),
      xNames={&quot;x1&quot;,&quot;x2&quot;,&quot;x3&quot;,&quot;x4&quot;},
      uNames={&quot;u&quot;},
      yNames={&quot;y1&quot;,&quot;y2&quot;,&quot;y3&quot;,&quot;y4&quot;});
  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Internal.html#Modelica_LinearSystems2.Internal.AnalyseOptions"
>Modelica_LinearSystems2.Internal.AnalyseOptions</A> analyseOptions=
      <font color="red">Modelica_LinearSystems2.Internal.AnalyseOptions</font>(
      plotEigenValues=true,
      plotInvariantZeros=true,
      plotStepResponse=true,
      plotFrequencyResponse=false,
      printEigenValues=true,
      printEigenValueProperties=true,
      printInvariantZeros=true,
      printControllability=false,
      printObservability=false,
      headingEigenValues=&quot;Eigenvalues&quot;,
      headingInvariantzeros=&quot;Invariant zeros&quot;,
      headingStepResponse=&quot;Step response&quot;,
      headingFrequencyResponse=&quot;Frequency response&quot;);

  <font color="blue">input </font>Boolean systemOnFile=false <font color="darkgreen">
    &quot;true, if state space system is defined on file&quot;</font>;
  <font color="blue">input </font>String fileName=&quot;NoName&quot; <font color="darkgreen">&quot;file where matrix [A, B; C, D] is stored&quot;</font>;
  <font color="blue">input </font>String matrixName=&quot;ABCD&quot; <font color="darkgreen">&quot;Name of the state space system matrix&quot;</font>;

  <font color="blue">output </font>Boolean ok;

<font color="blue">protected </font>
  <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>StateSpace</A> ss=<font color="blue">if </font>systemOnFile<font color="blue"> then </font><font color="red">Modelica_LinearSystems2.StateSpace.Import.fromFile</font>(fileName)<font color="blue"> else </font>ssi;
  <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>StateSpace</A> ssModal=ss;
  <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> ceigvec[4,4] <font color="darkgreen">&quot;complex eigen values of the system&quot;</font>;

  <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> T[4,4]=<font color="red">fill</font>(<font color="red">Complex</font>(0),4,4);
  <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> Vs[4,4];
  Real VsRe[4,4];
  Real Lambda[4,4];
  Real eigvec[4,4] <font color="darkgreen">&quot;eigen values of the system&quot;</font>;
  Real eigvecRe[4,4]=<font color="red">fill</font>(0, 4, 4) <font color="darkgreen">&quot;eigen values of the system&quot;</font>;
  Real eigvecIm[4,4]=<font color="red">fill</font>(0, 4, 4) <font color="darkgreen">&quot;eigen values of the system&quot;</font>;
  <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> eigval[4]=<font color="red">fill</font>(<font color="red">Complex</font>(0), 4);
  <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> j=<font color="red"> Modelica_LinearSystems2.Math.Complex.j</font>();
  <A HREF="Modelica_LinearSystems2_Math.html#Modelica_LinearSystems2.Math.Complex"
>Complex</A> Tp[2,2]=<font color="red">sqrt</font>(0.5)*[1+0*j, -j; 1+0*j, j];
  Integer i;

  Real x0[<font color="red">size</font>(ss.A, 1)]=<font color="red">ones</font>(<font color="red">size</font>(ss.A, 1)) <font color="darkgreen">&quot;Initial state vector&quot;</font>;
  Real z0[<font color="red">size</font>(ss.A, 1)]=<font color="red">ones</font>(<font color="red">size</font>(ss.A, 1)) <font color="darkgreen">&quot;Initial state vector&quot;</font>;

<font color="blue">algorithm </font>
  ok := false;
  <font color="red">StateSpace.Analysis.analysis</font>(ss, fileName=&quot;analysis.html&quot;, analyseOptions=analyseOptions, description=&quot;Description of the system&quot;);
  (eigvec,eigval) :=<font color="red"> Modelica_LinearSystems2.StateSpace.Analysis.eigenVectors</font>(ss, false);
  <font color="red">Complex.Vectors.print</font>(&quot;eval&quot;,eigval);
  <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(eigvec, 6, &quot;leftEigenVectors&quot;);

  i := 1;
  <font color="blue">while </font>i &lt;= 4<font color="blue"> loop</font>
    <font color="blue">if </font><font color="red">abs</font>(<font color="red">Im</font>(eigval[i])) &gt; 1e-12<font color="blue"> then</font>
      eigvecRe[:, i] := eigvec[:, i];
      eigvecIm[:, i] := eigvec[:, i + 1];
      eigvecRe[:, i + 1] := eigvec[:, i];
      eigvecIm[:, i + 1] := -eigvec[:, i + 1];
      T[i,i] := Tp[1,1];
      T[i,i+1] := Tp[1,2];
      T[i+1,i] := Tp[2,1];
      T[i+1,i+1] := Tp[2,2];
      i := i + 2;
    <font color="blue">else</font>
      eigvecRe[:, i] := eigvec[:, i];
      eigvecIm[:, i] :=<font color="red"> fill</font>(0, 4);
      T[i,i] :=<font color="red"> Complex</font>(1);
      i := i + 1;
    <font color="blue">end if</font>;
  <font color="blue">end while</font>;
  ceigvec :=<font color="red"> Complex</font>(1)*eigvecRe + j*eigvecIm;
  Vs := ceigvec*T;
  VsRe :=<font color="red"> Re</font>(Vs);
  Lambda:=<font color="red"> Modelica.Math.Matrices.inv</font>(VsRe)*ss.A*VsRe;

  ssModal.A := Lambda;
  ssModal.B :=<font color="red"> Modelica.Math.Matrices.solve2</font>(VsRe,ss.B);
<font color="darkgreen">//  ssModal.C := ss.C*VsRe;</font>
  ssModal.C := ss.C;
  ssModal.D := ss.D;
  z0 := x0;<font color="darkgreen">//Modelica.Math.Matrices.solve(VsRe,x0);</font>

  <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(<font color="red">Re</font>(ceigvec), 6, &quot;cevRe&quot;);
  <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(<font color="red">Im</font>(ceigvec), 6, &quot;cevIm&quot;);
  <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(<font color="red">Re</font>(T), 6, &quot;TRe&quot;);
  <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(<font color="red">Im</font>(T), 6, &quot;TIm&quot;);
  <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(<font color="red">Re</font>(Vs), 6, &quot;VsRe&quot;);
  <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(<font color="red">Im</font>(Vs), 6, &quot;VsIm&quot;);
  <font color="red">Modelica_LinearSystems2.Math.Matrices.printMatrix</font>(Lambda, 6, &quot;Lam&quot;);

  <font color="red">Modelica_LinearSystems2.StateSpace.Plot.initialResponse</font>(ss=ss, tSpan=4, x0=x0, defaultDiagram=<font color="red">Modelica_LinearSystems2.Internal.DefaultDiagramTimeResponse</font>(
        heading=&quot;Initial response system states&quot;),subPlots=false);
  <font color="red">Modelica_LinearSystems2.StateSpace.Plot.initialResponse</font>(ss=ssModal, tSpan=4, x0=z0, defaultDiagram=<font color="red">Modelica_LinearSystems2.Internal.DefaultDiagramTimeResponse</font>(
        heading=&quot;Initial response modal states&quot;),subPlots=false);

  ok := true;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>analysis2;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE plotBodeSISODiscrete<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples.plotBodeSISODiscrete"></A><A HREF="Modelica_LinearSystems2_WorkInProgress_StateSpace_Examples.html#Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples"
>Modelica_LinearSystems2.WorkInProgress.StateSpace.Examples</A>.plotBodeSISODiscrete</H2>
<B>Plots the Bode diagram of continuous state space system and the corresponding discrete state space system and  with automatic determination of the frequency range to plot </B><p>
<P><H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Boolean</TD><TD>systemOnFile</TD><TD>false</TD><TD>true, if state space system is defined on file</TD></TR>
<TR><TD>String</TD><TD>fileName</TD><TD>&quot;NoName&quot;</TD><TD>file where matrix [A, B; C, D] is stored</TD></TR>
<TR><TD>Real</TD><TD>A[:, size(A, 1)]</TD><TD>[-1.0, 0.0, 0.0; 0.0, -2.0, ...</TD><TD>&nbsp;</TD></TR>
<TR><TD>Real</TD><TD>B[size(A, 2), :]</TD><TD>[0.0, 1.0; 1.0, 1.0; -1.0, 0...</TD><TD>&nbsp;</TD></TR>
<TR><TD>Real</TD><TD>C[:, size(A, 1)]</TD><TD>[0.0, 1.0, 1.0; 1.0, 1.0, 1.0]</TD><TD>&nbsp;</TD></TR>
<TR><TD>Real</TD><TD>D[size(C, 1), size(B, 2)]</TD><TD>[1.0, 0.0; 0.0, 1.0]</TD><TD>&nbsp;</TD></TR>
<TR><TD><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>Ts</TD><TD>0.1</TD><TD>Sample time [s]</TD></TR>
<TR><TD><A HREF="Modelica_LinearSystems2_Types.html#Modelica_LinearSystems2.Types.Method"
>Method</A></TD><TD>method</TD><TD>Modelica_LinearSystems2.Type...</TD><TD>Discretization method</TD></TR>
<TR><TD>Integer</TD><TD>iu</TD><TD>1</TD><TD>index of inout</TD></TR>
<TR><TD>Integer</TD><TD>iy</TD><TD>1</TD><TD>index of output</TD></TR>
</TABLE>
<P><H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Boolean</TD><TD>ok</TD><TD>&nbsp;</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">function</font> plotBodeSISODiscrete <font color="darkgreen">
  &quot;Plots the Bode diagram of continuous state space system and the corresponding discrete state space system and  with automatic determination of the frequency range to plot &quot;</font>

  <font color="blue">import </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica.html#Modelica"
>Modelica</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace"
>Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace</A>;
  <font color="blue">import </font><A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.TransferFunction"
>Modelica_LinearSystems2.TransferFunction</A>;

  <font color="blue">input </font>Boolean systemOnFile=false <font color="darkgreen">
    &quot;true, if state space system is defined on file&quot;</font>;
  <font color="blue">input </font>String fileName=&quot;NoName&quot; <font color="darkgreen">&quot;file where matrix [A, B; C, D] is stored&quot;</font>;

  <font color="blue">input </font>Real A[:,<font color="red">size</font>(A, 1)]=[-1.0,0.0,0.0; 0.0,-2.0,0.0; 0.0,0.0,-3.0];
  <font color="blue">input </font>Real B[<font color="red">size</font>(A, 2),:]=[0.0,1.0; 1.0,1.0; -1.0,0.0];
  <font color="blue">input </font>Real C[:,<font color="red">size</font>(A, 1)]=[0.0,1.0,1.0; 1.0,1.0,1.0];
  <font color="blue">input </font>Real D[<font color="red">size</font>(C, 1),<font color="red">size</font>(B, 2)]=[1.0,0.0; 0.0,1.0];

  <font color="blue">input </font><A HREF="file:///C:/Programme/Dymola 7.4 Alpha/Modelica/Library/Modelica 3.1/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> Ts = 0.1 <font color="darkgreen">&quot;Sample time&quot;</font>;
  <font color="blue">input </font><A HREF="Modelica_LinearSystems2_Types.html#Modelica_LinearSystems2.Types.Method"
>Modelica_LinearSystems2.Types.Method</A> method=Modelica_LinearSystems2.Types.Method.StepExact <font color="darkgreen">
    &quot;Discretization method&quot;</font>;

  <font color="blue">input </font>Integer iu=1 <font color="darkgreen">&quot;index of inout&quot;</font>;
  <font color="blue">input </font>Integer iy=1 <font color="darkgreen">&quot;index of output&quot;</font>;
  <font color="blue">output </font>Boolean ok;

<font color="blue">protected </font>
  <A HREF="Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>StateSpace</A> ss=<font color="blue">if </font>systemOnFile<font color="blue"> then </font><font color="red">Modelica_LinearSystems2.StateSpace.Import.fromFile</font>(fileName)<font color="blue"> else </font>
      <font color="red">StateSpace</font>(A=A, B=B, C=C, D=D);

 <A HREF="Modelica_LinearSystems2_WorkInProgress.html#Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace"
>Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace</A> dss=
                        <font color="red">Modelica_LinearSystems2.WorkInProgress.DiscreteStateSpace</font>(
                                           ss,Ts,method);

<font color="blue">algorithm </font>
  <font color="red">assert</font>(iu &lt;=<font color="red"> size</font>(ss.B, 2)<font color="blue"> and </font>iu &gt; 0, &quot;index for input is &quot; +<font color="red"> String</font>(iu) +
    &quot; which is not in [1, &quot; +<font color="red"> String</font>(<font color="red">size</font>(ss.B, 2)) + &quot;].&quot;);
  <font color="red">assert</font>(iy &lt;=<font color="red"> size</font>(ss.C, 1)<font color="blue"> and </font>iy &gt; 0, &quot;index for output is &quot; +<font color="red"> String</font>(iy) +
    &quot; which is not in [1, &quot; +<font color="red"> String</font>(<font color="red">size</font>(ss.C, 1)) + &quot;].&quot;);

  <font color="red">Modelica_LinearSystems2.StateSpace.Plot.bodeSISO</font>(
    ss,
    iu,
    iy);
  <font color="red">Modelica_LinearSystems2.DiscreteStateSpace.Plot.bodeSISO</font>(
    dss,
    iu,
    iy);
  ok := true;

<textblock type="annotcomp" expanded="false"><font color="blue">end </font>plotBodeSISODiscrete;
</PRE>
<HR>
<address>HTML-documentation generated by <a href="http://www.Dymola.com/">Dymola</a> Fri Jan 15 12:29:02 2010.
</address></BODY>
</HTML>
